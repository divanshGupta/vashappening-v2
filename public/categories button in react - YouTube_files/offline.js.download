(function(g){var window=this;'use strict';var jsA=function(L){var W=new g.mi("und",new g.jl("Default","und",!0));W.captionTracks=L.captionTracks;return W},tsC=function(L){return new g.T1(function(W,f){var I=L.length,U=[];
if(I)for(var e=function(v,r){I--;U[v]=r;I==0&&W(U)},b=function(v){f(v)},E,d=0;d<L.length;d++)E=L[d],g.pSd(E,g.hG(e,d),b);
else W(U)})},F1=function(L){this.W=L},at=function(){F1.apply(this,arguments)},PMW=function(){at.apply(this,arguments)},JvA=function(){at.apply(this,arguments)},Y0L=function(){at.apply(this,arguments)},F_L=function(){at.apply(this,arguments)},adD=function(){at.apply(this,arguments)},CMc=function(){at.apply(this,arguments)},pnc=function(){at.apply(this,arguments)},RWt=function(){F1.apply(this,arguments)},N4O=function(){at.apply(this,arguments)},GVX=function(){at.apply(this,arguments)},cvO=function(){at.apply(this,
arguments)},ssn=function(){at.apply(this,arguments)},q0v=function(){at.apply(this,arguments)},iV5=function(){at.apply(this,arguments)},xBO=function(){at.apply(this,arguments)},kVO=function(){at.apply(this,arguments)},HVc=function(){at.apply(this,arguments)},ldv=function(){at.apply(this,arguments)},OVc=function(){at.apply(this,arguments)},LY5=function(){at.apply(this,arguments)},WYO=function(){F1.apply(this,arguments)},$gn=function(){at.apply(this,arguments)},f6O=function(){at.apply(this,arguments)},
I6A=function(){at.apply(this,arguments)},Ug5=function(){at.apply(this,arguments)},eAA=function(){at.apply(this,arguments)},oEG=function(){at.apply(this,arguments)},bxc=function(){at.apply(this,arguments)},hAX=function(){at.apply(this,arguments)},EEA=function(){at.apply(this,arguments)},dgi=function(){F1.apply(this,arguments)},vEO=function(){F1.apply(this,arguments)},rSO=function(){F1.apply(this,arguments)},BUt=function(){at.apply(this,arguments)},ASc=function(){at.apply(this,arguments)},SKn=function(){at.apply(this,
arguments)},ZxW=function(){at.apply(this,arguments)},Dgn=function(){at.apply(this,arguments)},wBc=function(){at.apply(this,arguments)},zA5=function(){at.apply(this,arguments)},MTc=function(){at.apply(this,arguments)},nEi=function(){at.apply(this,arguments)},XBi=function(){at.apply(this,arguments)},VTn=function(){at.apply(this,arguments)},mgO=function(){at.apply(this,arguments)},umQ=function(){at.apply(this,arguments)},KYc=function(){at.apply(this,arguments)},TUL=function(){at.apply(this,arguments)},
ySO=function(){at.apply(this,arguments)},gEi=function(){at.apply(this,arguments)},QYC=function(){at.apply(this,arguments)},jYD=function(){at.apply(this,arguments)},tTi=function(){at.apply(this,arguments)},PsC=function(){at.apply(this,arguments)},JSt=function(){at.apply(this,arguments)},YKW=function(){at.apply(this,arguments)},FYn=function(){at.apply(this,arguments)},a6i=function(){at.apply(this,arguments)},Csn=function(){at.apply(this,arguments)},pBc=function(){at.apply(this,arguments)},RAc=function(){F1.apply(this,
arguments)},NUL=function(){at.apply(this,arguments)},G1c=function(){at.apply(this,arguments)},cS5=function(){at.apply(this,arguments)},sYL=function(){at.apply(this,arguments)},qKi=function(){at.apply(this,arguments)},ixt=function(){at.apply(this,arguments)},xgA=function(){at.apply(this,arguments)},k1G=function(){at.apply(this,arguments)},Hxt=function(){at.apply(this,arguments)},l6n=function(){at.apply(this,arguments)},Oxv=function(){at.apply(this,arguments)},LNn=function(){at.apply(this,arguments)},
WNL=function(){at.apply(this,arguments)},$lW=function(){at.apply(this,arguments)},fvG=function(){at.apply(this,arguments)},IvO=function(){at.apply(this,arguments)},Uln=function(){at.apply(this,arguments)},eiQ=function(){at.apply(this,arguments)},ozC=function(){at.apply(this,arguments)},bet=function(){at.apply(this,arguments)},hit=function(){at.apply(this,arguments)},EzG=function(){at.apply(this,arguments)},dlA=function(){at.apply(this,arguments)},vzc=function(){at.apply(this,arguments)},rCc=function(){at.apply(this,
arguments)},BXQ=function(){at.apply(this,arguments)},ACL=function(){at.apply(this,arguments)},SQC=function(){at.apply(this,arguments)},Zei=function(){at.apply(this,arguments)},DlL=function(){at.apply(this,arguments)},wID=function(){at.apply(this,arguments)},zin=function(){at.apply(this,arguments)},MMt=function(){at.apply(this,arguments)},nzv=function(){at.apply(this,arguments)},XIA=function(L){L=L.key||L.id;
if(!L)throw Error("Entity key is missing");return L},VMc=function(){if(CK)return CK();
var L={};CK=g.lz("PersistentEntityStoreDb",{qd:(L.EntityStore={n8:1},L.EntityAssociationStore={n8:2},L),shared:!1,upgrade:function(W,f){f(1)&&g.tX(g.Kq(W,"EntityStore",{keyPath:"key"}),"entityType","entityType");f(2)&&(W=g.Kq(W,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.tX(W,"byParentEntityKey","parentEntityKey"),g.tX(W,"byChildEntityKey","childEntityKey"))},
version:3});return CK()},mlX=function(L){return g.RL(VMc(),L)},uQO=function(L){return g.RL((0,g.foG)(),L)},pK=function(L){this.token=L},Rt=function(L,W){W=W===void 0?{}:W;
g.NT.call(this,g.Iov[L],Object.assign({},{name:"PESEncoderError",type:L},W));this.type=L;this.level="WARNING";Object.setPrototypeOf(this,Rt.prototype)},KNQ=function(L){return new Rt("WRONG_DATA_TYPE",{r4:L})},TXC=function(L){return L instanceof Error?new Rt("UNKNOWN_ENCODE_ERROR",{originalMessage:L.message}):new Rt("UNKNOWN_ENCODE_ERROR")},yCO=function(L){return L instanceof Error?new Rt("UNKNOWN_DECODE_ERROR",{originalMessage:L.message}):new Rt("UNKNOWN_DECODE_ERROR")},gzC=function(L,W){L=L instanceof
Rt?L:W(L);
g.T5(L);throw L;},QQG=function(){},jQv=function(L,W,f){try{return L.N(W,f)}catch(I){gzC(I,TXC)}},tMO=function(L){L=(new TextEncoder).encode(L).subarray(0,16);
var W=new Uint8Array(16);W.set(L);return W},Nt=function(L){this.W=L},JCO=function(L){var W=PoO[L];
if(W)return W;g.yH(new g.NT("Entity model not found.",{entityType:L}))},YQW=function(L,W){this.W=L;
this.K=W;this.N={}},avA=function(L,W){a:{L=FNc(L.K,W.version);
try{var f=L.K(W.data,W.key);break a}catch(I){gzC(I,yCO)}f=void 0}return f},Go=function(L,W,f){return L.W.objectStore("EntityStore").get(W).then(function(I){if(I){if(f&&I.entityType!==f)throw Error("Incorrect entity type");
return avA(L,I)}})},cF=function(L,W,f){return f?(f=f.map(function(I){return Go(L,I,W)}),g.w5.all(f)):L.W.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(W)).then(function(I){return I.map(function(U){return avA(L,U)})})},qt=function(L,W,f){var I=XIA(W),U=FNc(L.K,1),e=Object.assign({},W);
return L.W.objectStore("EntityStore").get(I).then(function(b){if(b){if(b.entityType!==f)throw Error("Incorrect entity type");e.entityMetadata||(b=avA(L,b),e.entityMetadata=b.entityMetadata)}}).then(function(){var b={key:I,
entityType:f,data:jQv(U,e,I),version:1};return g.w5.all([g.g5(L.W.objectStore("EntityStore"),b),CoG(L,e,f)])}).then(function(){sk(L,I,f);
return I})},pI5=function(L,W,f){W=W.map(function(I){return qt(L,I,f)});
return g.w5.all(W)},iv=function(L,W,f){if(f==null?0:f.PK){var I=new Set;
return RiL(L,W,I).then(function(){for(var e=[],b=g.n(I),E=b.next();!E.done;E=b.next())e.push(iv(L,E.value));return g.w5.all(e).then(function(){})})}var U=g.xB(W).entityType;
return g.w5.all([L.W.objectStore("EntityStore").delete(W),NXO(L,W)]).then(function(){sk(L,W,U)})},GDv=function(L,W){return g.FR(L.W.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(W)},function(f){return g.w5.all([f.delete(),
NXO(L,f.cursor.primaryKey)]).then(function(){sk(L,f.cursor.primaryKey,W);return g.JX(f)})})},cCc=function(L,W,f,I){var U=FNc(L.K,1);
return Go(L,W,I).then(function(e){if(e){e=g.fD(e,f);var b={key:W,entityType:I,data:jQv(U,e,W),version:1};return g.w5.all([g.g5(L.W.objectStore("EntityStore"),b),CoG(L,e,I)])}}).then(function(){sk(L,W,I);
return W})},sk=function(L,W,f){var I=L.N[f];
I||(I=new Set,L.N[f]=I);I.add(W)},sQC=function(L,W,f){var I=XIA(W);
f=JCO(f);if(!f)return g.w5.resolve([]);f=new f(W);L=L.W.objectStore("EntityAssociationStore");W=[];f=g.n(f.K());for(var U=f.next();!U.done;U=f.next())W.push(g.g5(L,{parentEntityKey:I,childEntityKey:U.value}));return g.w5.all(W).then(function(e){return e.map(function(b){return b[1]})})},NXO=function(L,W){return L.W.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(W))},CoG=function(L,W,f){var I=XIA(W);
return NXO(L,I).then(function(){return sQC(L,W,f)})},RiL=function(L,W,f){if(f.has(W))return g.w5.resolve(void 0);
f.add(W);return qQW(L,W).then(function(I){return L.W.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(W)).then(function(){return I})}).then(function(I){var U=g.w5.resolve(void 0);
I=g.n(I);for(var e=I.next(),b={};!e.done;b={tp:void 0},e=I.next())b.tp=e.value,U=U.then(function(E){return function(){return RiL(L,E.tp,f)}}(b));
return U}).then(function(){})},qQW=function(L,W){var f=L.W.objectStore("EntityAssociationStore");
return f.index("byParentEntityKey").getAll(IDBKeyRange.only(W)).then(function(I){var U=[];I=g.n(I);for(var e=I.next();!e.done;e=I.next())e=e.value,U.push(f.index("byChildEntityKey").getAll(e.childEntityKey));return g.w5.all(U)}).then(function(I){var U=[];
I=g.n(I);for(var e=I.next();!e.done;e=I.next())e=e.value,e.length===1&&U.push(e[0].childEntityKey);return U})},xl=function(){},ieX=function(){this.W={};
this.W[0]=new xl;if(!g.Dq("aes_pes_encoder_killswitch")){var L=this.W;try{var W=g.G4();var f=tMO(W);var I=new Nt(new g.EH(f),new g.dK(f))}catch(U){throw L=U instanceof Error?new Rt("KEY_CREATION_FAILED",{originalMessage:U.message}):new Rt("KEY_CREATION_FAILED"),g.T5(L),L;}L[1]=I}},FNc=function(L,W){W=W===void 0?0:W;
L=L.W[W];if(!L)throw W=new Rt("INVALID_ENCODER_VERSION",{r4:W}),g.T5(W),W;return L},kl=function(L,W){g.a.call(this);
this.token=L;this.W=W;this.observers=[];L=new g.lp.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.G4());L.onmessage=this.K.bind(this);this.channel=L},HF=function(L,W,f){var I,U,e,b;
return g.t(function(E){if(E.W==1)return g.Q(E,mlX(L.token),2);if(E.W!=3)return I=E.K,g.Q(E,g.y4(I,["EntityStore","EntityAssociationStore"],W,function(d){U=new YQW(d,L.W);return f(U)}),3);
e=E.K;U&&(b=U.N,Object.keys(b).length>0&&(L.channel.postMessage(b),xlC(L,b)));return E.return(e)})},lv=function(L,W,f){return HF(L,{mode:"readwrite",
Jg:!0},function(I){return qt(I,W,f)})},kDX=function(L,W){return HF(L,{mode:"readwrite",
Jg:!0},function(f){return pI5(f,W,"offlineOrchestrationActionWrapperEntity")})},HeL=function(L,W){return HF(L,{mode:"readwrite",
Jg:!0},function(f){return iv(f,W)})},lvi=function(L){return HF(L,{mode:"readwrite",
Jg:!0},function(W){return GDv(W,"videoPlaybackPositionEntity")})},Ok=function(L,W,f){return HF(L,{mode:"readonly",
Jg:!0},function(I){return Go(I,W,f)})},Lt=function(L,W,f){return HF(L,{mode:"readonly",
Jg:!0},function(I){return cF(I,W,f)})},xlC=function(L,W){L=g.n(L.observers);
for(var f=L.next();!f.done;f=L.next())f=f.value,f(W)},OeX=function(){var L,W,f;
return g.t(function(I){if(I.W==1)return g.XK(I,2),g.Q(I,g.kf(),4);if(I.W!=2){L=I.K;if(!L||!g.c3()||typeof g.lp.BroadcastChannel==="undefined")return I.return();W=new ieX;return I.return(new kl(L,W))}f=g.y7(I);f instanceof Error&&g.T5(f);return I.return()})},Wo=function(){LZv||(LZv=OeX());
return LZv},WZC=function(L){var W;
L=(W=L.options)==null?void 0:W.persistenceOption;return L==="ENTITY_PERSISTENCE_OPTION_PERSIST"||L==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},$fG=function(L){var W;
return g.t(function(f){return f.W==1?g.Q(f,Wo(),2):(W=f.K)?g.Q(f,HF(W,"readwrite",function(I){for(var U={},e=g.n(L),b=e.next(),E={};!b.done;E={AC:void 0,mV:void 0},b=e.next())E.AC=b.value,E.AC.entityKey&&WZC(E.AC)&&(E.mV=g.$m(E.AC.payload),b=void 0,E.AC.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(b=function(d){return function(){return qt(I,d.AC.payload[d.mV],d.mV)}}(E)),E.AC.type==="ENTITY_MUTATION_TYPE_DELETE"&&(b=function(d){return function(){return iv(I,d.AC.entityKey)}}(E)),E.AC.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(b=function(d){return function(){return cCc(I,d.AC.entityKey,d.AC.payload[d.mV],d.mV)}}(E)),b&&(U[E.AC.entityKey]=U[E.AC.entityKey]?U[E.AC.entityKey].then(b):b()));
return g.w5.all(Object.values(U))}),0):f.return()})},fBL=function(L){var W;
return g.t(function(f){if(f.W==1){W=L.mutations;if(!W||W.length<=0)return f.return();if(g.KF){var I={type:"ENTITY_LOADED"};W!==void 0&&(I.payload=W);g.KF.dispatch(I)}return g.Q(f,$fG(W),2)}W.length=0;g.n0(f)})},IBX=function(L){return L!==void 0},UfA=function(L){var W=g.fF();
W=Object.assign({},W);L=Object.assign({},L);for(var f in W)L[f]?(W[f]!==4&&(W[f]=L[f]),delete L[f]):W[f]!==2&&(W[f]=4);Object.assign(W,L);g.qm7(W);JSON.stringify(W);return W},ekQ=function(L){var W,f;
return g.t(function(I){if(I.W==1)return g.Q(I,g.kf(),2);if(I.W!=3)return(W=I.K)?g.Q(I,g.eg(W),3):I.return();f=I.K;return I.return(g.y4(f,["index","media","captions"],{mode:"readwrite",Jg:!0},function(U){var e=IDBKeyRange.bound(L+"|",L+"~");U=[U.objectStore("index").delete(e),U.objectStore("media").delete(e),U.objectStore("captions").delete(e)];return g.w5.all(U).then(function(){})}))})},oFA=function(){var L,W;
return g.t(function(f){if(f.W==1)return g.Q(f,g.kf(),2);if(f.W!=3){L=f.K;if(!L)throw g.Zt("rvdfd");return g.Q(f,g.eg(L),3)}W=f.K;return f.return(g.y4(W,["index","media"],{mode:"readwrite",Jg:!0},function(I){var U={};return g.Pm(I.objectStore("index"),{},function(e){var b=e.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),E=g.w5.resolve(void 0);if(b){var d=b[1];b=b[2];U[d]=U[d]||{};var v;U[d][b]=g.l_K((v=e.getValue())==null?void 0:v.fmts)}else E=e.delete().then(function(){});
return g.w5.all([g.JX(e),E]).then(function(r){return g.n(r).next().value})}).then(function(){for(var e={},b=g.n(Object.keys(U)),E=b.next();!E.done;E=b.next()){E=E.value;
var d=U[E].v;e[E]=U[E].a&&d?1:2}var v=UfA(e);return g.mfd(I.objectStore("media"),{},function(r){var B=r.cursor.key.match(g.$H0);B&&e[B[1]]||I.objectStore("media").delete(r.cursor.key);return g.Sn7(r)}).then(function(){return v})})}))})},bNL=function(L,W){var f,I;
return g.t(function(U){if(U.W==1)return g.Q(U,g.kf(),2);if(U.W!=3){f=U.K;if(!f)throw g.Zt("wct");return g.Q(U,g.eg(f),3)}I=U.K;return g.Q(U,g.y4(I,["captions"],{mode:"readwrite",Jg:!0},function(e){var b=[];e=e.objectStore("captions");for(var E=0;E<W.length;E++){var d=g.g5(e,W[E],L+"|"+W[E].metadata.vss_id);b.push(d)}return g.w5.all(b)}),0)})},hk5=function(L){var W,f,I;
return g.t(function(U){if(U.W==1)return W=IDBKeyRange.bound(L+"|",L+"~"),g.Q(U,g.kf(),2);if(U.W!=3){f=U.K;if(!f)throw g.Zt("gactfv");return g.Q(U,g.eg(f),3)}I=U.K;return U.return(I.getAll("captions",W))})},EFv=function(L){return g.t(function(W){g.Us(L,0);
return W.return(ekQ(L))})},df5=function(L){return{context:g.x3(),
videoIds:L}},vFC=function(L){return{context:g.x3(),
playlistIds:L}},r05=function(L){return{context:g.x3(),
offlinePlaylistSyncChecks:L}},BZO=function(){this.W=new Map},SnW=function(){A0W||(A0W=new BZO);
return A0W},ZNL=function(L,W){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:L},metadata:W,statusCode:void 0,csn:void 0,can:void 0}},Dfc=function(L,W,f){if(!f){var I=I===void 0?!1:I;
f=L.W.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!f||I)f=g.Z0(16),L.W.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",f)}L={flowNonce:f,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:W.eventType};W.metadata&&(L.flowMetadata=W.metadata);W.statusCode!==void 0&&(L.flowEventStatus=W.statusCode);W.csn&&(L.csn=W.csn);W.can&&(L.can=W.can);g.UV("flowEvent",L,void 0)},wHn=function(L){var W,f,I,U,e,b,E,d,v,r,B,A,S,Z,M,m,T,K,P,F,p,H,q,hj,Ey,IR,rF,$r,gF,xr,vA,Ei,qz,jx,eA,Y5,Gv,o6,y,QN;
return g.t(function(mc){if(mc.W==1)return g.Q(mc,HF(L,{mode:"readonly",Jg:!0},function(f0){return cF(f0,"playbackData").then(function(uc){var X=uc.map(function(CQ){return CQ.transfer}).filter(function(CQ){return!!CQ}),WK=uc.map(function(CQ){return CQ.offlineVideoPolicy}).filter(function(CQ){return!!CQ}),KC=uc.filter(function(CQ){return!!CQ.key}).map(function(CQ){return g.kB(g.xB(CQ.key).entityId,"downloadStatusEntity")});
X=cF(f0,"transfer",X);WK=cF(f0,"offlineVideoPolicy",WK);KC=cF(f0,"downloadStatusEntity",KC);var i8=X.then(function(CQ){CQ=CQ.reduce(function(ip,WA){(WA==null?0:WA.offlineVideoStreams)&&ip.push.apply(ip,g.Aj(WA.offlineVideoStreams));return ip},[]).filter(function(ip){return!!ip});
return cF(f0,"offlineVideoStreams",CQ)});
return g.w5.all([X,WK,i8,KC]).then(function(CQ){var ip=g.n(CQ);CQ=ip.next().value;var WA=ip.next().value;var fb=ip.next().value;ip=ip.next().value;return[uc,CQ,WA,fb,ip]})})}),2);
if(mc.W!=3)return W=mc.K,g.Q(mc,HF(L,{mode:"readonly",Jg:!0},function(f0){return cF(f0,"mainDownloadsListEntity").then(function(uc){var X,WK;return(WK=(X=uc[0])==null?void 0:X.downloads)!=null?WK:[]})}),3);
f=mc.K;I=g.n(W);U=I.next().value;e=I.next().value;b=I.next().value;E=I.next().value;d=I.next().value;v=U;r=e;B=b;A=E;S=d;Z={};M={};m={};T={};K={};P=[];F=g.n(r);for(p=F.next();!p.done;p=F.next())(H=p.value)&&(Z[H.key]=H);q=g.n(B);for(hj=q.next();!hj.done;hj=q.next())(Ey=hj.value)&&(M[Ey.key]=Ey);IR=g.n(S);for(rF=IR.next();!rF.done;rF=IR.next())($r=rF.value)&&(m[$r.key]=$r);gF=g.n(A);for(xr=gF.next();!xr.done;xr=gF.next())(vA=xr.value)&&(T[vA.key]=vA);Ei=g.n(f);for(qz=Ei.next();!qz.done;qz=Ei.next())jx=
qz.value,eA=void 0,K[(eA=jx.videoItem)!=null?eA:""]=!0,jx.videoItem&&(Gv=Y5=void 0,o6=(Gv=(Y5=g.xB(jx.videoItem))==null?void 0:Y5.entityId)!=null?Gv:"",P.push({externalVideoId:o6}));y=v.filter(function(f0){if(!f0||!f0.key||!f0.offlineVideoPolicy)return!1;f0=g.xB(f0.key).entityId;f0=g.kB(f0,"downloadStatusEntity");var uc;return!(f0&&((uc=m[f0])==null?void 0:uc.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
QN=y.map(function(f0){var uc=Z[f0.transfer],X=[];if(uc==null?0:uc.offlineVideoStreams)for(var WK=g.n(uc.offlineVideoStreams),KC=WK.next();!KC.done;KC=WK.next())(KC=T[KC.value])&&X.push(KC);WK=M[f0.offlineVideoPolicy];KC=K;var i8=f0==null?void 0:f0.playerResponseTimestamp,CQ=g.xB(WK.key).entityId;f0=g.kB(CQ,"mainVideoEntity");if(WK.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var ip="OFFLINE_VIDEO_STATE_DISABLED";WK.expirationTimestamp&&Number(WK.expirationTimestamp)<Date.now()/1E3&&(ip="OFFLINE_VIDEO_STATE_EXPIRED")}else if(WK.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")ip="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(uc==null?void 0:uc.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":ip="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":ip="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":ip="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":ip="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":ip="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":ip="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:ip="OFFLINE_VIDEO_STATE_UNKNOWN"}if(ip==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(uc==null?void 0:uc.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":ip="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":ip="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":ip=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}CQ={id:CQ,videoState:ip};if(uc==null?0:uc.cotn)CQ.cotn=uc.cotn;if(uc==null?0:uc.maximumDownloadQuality)CQ.selectedVideoQuality=uc==null?void 0:uc.maximumDownloadQuality;if(uc==null?0:uc.lastProgressTimeMs)CQ.lastProgressTimeMs=uc.lastProgressTimeMs;i8&&(CQ.playerResponseSavedTimeMs=String(Number(i8)*1E3));uc=String;i8=0;X=g.n(X);for(ip=X.next();!ip.done;ip=X.next())if(ip=ip.value,ip.streamsProgress){ip=g.n(ip.streamsProgress);for(var WA=ip.next();!WA.done;WA=ip.next()){var fb=
void 0;i8+=Number((fb=WA.value.numBytesDownloaded)!=null?fb:0)}}CQ.downloadedBytes=uc(i8);CQ.selectedOfflineMode=KC[f0]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";WK.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(CQ.offlinePlaybackDisabledReason=WK.offlinePlaybackDisabledReason);return CQ});
return mc.return({offlineVideos:QN,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:P}}})})},zkL=function(){this.locks=navigator.locks},M8i=function(){try{var L=g.LQ("ytglobal.locks_");
if(L)return L;var W;if(W=navigator){var f=navigator;W="locks"in f&&!!f.locks}if(W)return g.lp.localStorage&&g.lp.localStorage.getItem("noop"),L=new zkL,g.Oy("ytglobal.locks_",L),L}catch(I){}},$0=function(){},nFc=function(){},XHi=function(L){if(L.includes(":"))throw Error("Invalid user cache name: "+L);
return L+":"+g.G4("CacheStorage get")},V8c=function(){return g.t(function(L){if(ft!==void 0)return L.return(ft);
ft=new Promise(function(W){var f;return g.t(function(I){switch(I.W){case 1:return g.XK(I,2),g.Q(I,Io.open("test-only"),4);case 4:return g.Q(I,Io.delete("test-only"),5);case 5:g.TM(I,3);break;case 2:if(f=g.y7(I),f instanceof Error&&f.name==="SecurityError")return W(!1),I.return();case 3:W("caches"in window),g.n0(I)}})});
return L.return(ft)})},uhO=function(){return g.t(function(L){if(L.W==1)return g.Q(L,V8c(),2);
if(!L.K)return L.return(void 0);mfc||(mfc=new nFc);return L.return(mfc)})},Uj=function(L,W,f){g.yH(new g.NT("Woffle: "+L,f?{cotn:f}:""));
W instanceof Error&&g.yH(W)},KZi=function(L){var W;
return g.t(function(f){if(f.W==1)return g.Q(f,wHn(L),2);W=f.K;g.UV("offlineStateSnapshot",W);g.n0(f)})},eX=function(L){g.a.call(this);
var W=this;this.api=L;this.Kw={kze:function(){return W.W},
ddw:function(){return W.K}};
typeof g.lp.BroadcastChannel!=="undefined"&&(this.W=new g.lp.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.G4()),this.W.onmessage=this.N.bind(this),this.K=new g.lp.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.G4()),this.K.onmessage=this.T.bind(this))},oo=function(L,W){L.api.xp("onOfflineOperationFailure",W);
var f;(f=L.W)==null||f.postMessage(W)},TZW=function(L,W,f){var I=this;
this.U=L;this.X=W;this.visibility=f;this.G=this.V=this.J=this.N=this.W=!1;this.T=new g.sn(function(){I.c6()});
this.Kw={QE:function(){return I.K},
c6:function(){I.c6()},
Fg1:function(){return I.T}};
this.visibility.subscribe("visibilitystatechange",function(){I.A4()})},y0O=function(L){if(!L.N&&!L.W){var W=M8i();
if(W){L.N=!0;var f=g.G4("OfflineLockManager");W.request("woffle_orchestration_leader:"+f,{},function(){var I,U;return g.t(function(e){switch(e.W){case 1:return g.XK(e,2),L.K=new g.vI,L.W=!0,L.N=!1,g.Q(e,L.U(),4);case 4:return g.Q(e,L.K.promise,5);case 5:g.TM(e,0);break;case 2:I=g.y7(e),L.c6(),I instanceof Error&&(U=I,U.args=[{name:"WoLockManagerError",fU:I.name}],g.T5(U)),g.n0(e)}})})}}},gFD=function(L){L.W&&(L.G=!0,bO(L))},QHO=function(L,W){L.W&&(L.J=W,bO(L))},jHG=function(L,W){L.W&&(L.V=W,bO(L))},
bO=function(L){L.V&&L.J&&L.G&&L.visibility.isBackground()?g.qf(L.T,6E4):L.T.stop()},hD=function(L){var W;
L.offlineDeleteReason=(W=L.offlineDeleteReason)!=null?W:"OFFLINE_DELETE_REASON_UNKNOWN";var f;L.offlineModeType=(f=L.offlineModeType)!=null?f:"OFFLINE_NOW";g.UV("offlineDeleteEvent",L)},Ej=function(L,W){var f=W.videoId;
var I=W.Xj;W=W.offlineModeType;L.encryptedVideoId=f;L.cotn=I==null?void 0:I.cotn;L.offlineabilityFormatType=I==null?void 0:I.maximumDownloadQuality;var U;L.isRefresh=(U=I==null?void 0:I.isRefresh)!=null?U:!1;var e;L.softErrorCount=(e=I==null?void 0:I.transferRetryCount)!=null?e:0;L.offlineModeType=W!=null?W:"OFFLINE_NOW";(L.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&L.statusType==="UNKNOWN_STATUS_TYPE"||!L.transferStatusType&&!L.statusType)&&g.yH(Error("Woffle unknown transfer status"));
g.UV("offlineTransferStatusChanged",L)},t8O=function(L){Ej({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},L)},P$n=function(L,W,f,I){I={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!I};W&&f&&(W=Math.floor(W/1024).toFixed(),f=Math.floor(f/1024).toFixed(),I.alreadyDownloadedKbytes=W,I.totalFetchedKbytes=W,I.totalContentKbytes=f);Ej(I,L)},J0n=function(L){Ej({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},L)},YnC=function(L){Ej({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},L)},FZD=function(L){switch(L){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
d_=function(L){var W,f,I;
return((I=(W=L.actionMetadata)==null?void 0:(f=W.retryScheduleIntervalsInSeconds)==null?void 0:f.length)!=null?I:0)>0},vo=function(L){return L.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!L.entityKey},r_=function(L){return L.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!L.entityKey},Bo=function(L){return L.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!L.entityKey},aBc=function(L){return L.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!L.entityKey},
AD=function(L,W,f,I,U){U=U===void 0?!1:U;
var e,b,E,d,v,r;return g.t(function(B){if(B.W==1)return e=g.kB(L,W),b=g.kB(L,"downloadStatusEntity"),g.Q(B,HF(f,{mode:"readonly",Jg:!0},function(A){return g.w5.all([Go(A,e,W),Go(A,b,"downloadStatusEntity")])}),2);
E=B.K;d=E.length?E[0]:void 0;if(!d)return B.G1(0);v=C$i;if(r=E.length>1?E[1]:void 0){if(r.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!U)return B.return();r.downloadState=I}else r={key:b,downloadState:I};g.Pd(d,v,r);return g.Q(B,HF(f,{mode:"readwrite",Jg:!0},function(A){return g.w5.all([qt(A,d,W),qt(A,r,"downloadStatusEntity")])}),0)})},SX=function(L,W){return L.actionType===W.actionType&&L.entityKey===W.entityKey},ZV=function(L,W){if(L&&L.transferState!=="TRANSFER_STATE_COMPLETE"&&L.transferState!==
"TRANSFER_STATE_FAILED"){var f=g.xB(L.key).entityId;
Ej({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:f,Xj:L,offlineModeType:W})}},DV=function(L){if(!L||!L.thumbnails)return[];
var W=[];L=g.n(L.thumbnails);for(var f=L.next();!f.done;f=L.next())f=f.value,f.url&&W.push(f.url);return W},pHt=function(L,W,f){f=f===void 0?[]:f;
var I,U,e,b,E,d,v,r,B,A,S,Z,M;return g.t(function(m){if(m.W==1)return f.length?g.Q(m,Lt(L,W),2):m.return([]);I=m.K;U=new Set;e=g.n(I);for(b=e.next();!b.done;b=e.next())if(E=b.value,d=E.id||E.key)v=g.xB(d).entityId,U.add(v);r=[];B=g.n(f);for(A=B.next();!A.done;A=B.next())S=A.value,Z=S.offlineVideoData,M=void 0,((M=Z)==null?0:M.videoId)&&!U.has(Z.videoId)&&r.push(S);return m.return(r)})},RkA=function(L,W,f){return new g.Di(L,{cotn:W,
raw_player_response:f,download_media:!0,start:Infinity,disable_watch_next:!0})},NZG=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},w_=function(L,W,f,I,U,e,b,E,d,v,r){this.entityType=L;
this.actionId=W;this.action=f;this.parentActionId=I;this.rootActionId=U===void 0?W:U;this.childActionIds=e;this.prereqActionId=b;this.postreqActionIds=E;this.hasChildActionFailed=v;this.retryScheduleIndex=0;this.W=r||Date.now();this.retryScheduleIndex=d||0},zI=function(L){if(!L.key)throw Error("Entity key is required.");
if(!L.actionProto)throw Error("OfflineOrchestrationAction is required.");var W=g.xB(L.key),f=g.xB(L.actionProto.entityKey);return new w_(f.entityType,W.entityId,L.actionProto,L.parentActionId,L.rootActionId,L.childActionIds,L.prereqActionId,L.postreqActionIds,L.retryScheduleIndex,L.hasChildActionFailed,Number(L.enqueueTimeSec)*1E3)},Mj=function(L){return{key:g.kB(L.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:L.action,parentActionId:L.parentActionId,rootActionId:L.rootActionId,childActionIds:L.childActionIds,prereqActionId:L.prereqActionId,postreqActionIds:L.postreqActionIds,retryScheduleIndex:L.retryScheduleIndex,hasChildActionFailed:L.hasChildActionFailed,enqueueTimeSec:(L.W/1E3).toFixed()}},GhX=function(){var L;
return g.t(function(W){return W.W==1?g.Q(W,uhO(),2):(L=W.K)?W.return(L.delete("yt-player-local-img")):W.return(!0)})},nt=function(L){var W,f;
return g.t(function(I){if(I.W==1)return g.Q(I,uhO(),2);if(I.W!=3){W=I.K;if(!W)throw Error("Cache API not supported");return L.length?g.Q(I,W.open("yt-player-local-img"),3):I.return()}f=I.K;return g.Q(I,Promise.all(L.map(function(U){return f.delete(U)})),0)})},XJ=function(L){var W,f;
return g.t(function(I){if(I.W==1)return g.Q(I,uhO(),2);if(I.W!=3){W=I.K;if(!W)throw Error("Cache API not supported");return L.length?g.Q(I,W.open("yt-player-local-img"),3):I.return()}f=I.K;return g.Q(I,f.addAll(L),0)})},Vg=function(L,W,f,I,U){var e,b,E,d,v,r,B,A,S,Z,M,m,T,K,P,F,p,H,q,hj,Ey,IR,rF,$r,gF,xr,vA,Ei,qz,jx,eA;
return g.t(function(Y5){switch(Y5.W){case 1:return e=g.kB(L,"mainVideoEntity"),b=g.kB(L,"ytMainChannelEntity"),E=g.kB(L,"transfer"),d=g.kB(L,"videoDownloadContextEntity"),g.Q(Y5,HF(W,{mode:"readonly",Jg:!0},function(Gv){return g.w5.all([Go(Gv,e,"mainVideoEntity"),Go(Gv,b,"ytMainChannelEntity"),Go(Gv,E,"transfer"),Go(Gv,d,"videoDownloadContextEntity"),cF(Gv,"ytMainChannelEntity"),cF(Gv,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:v=Y5.K;r=g.n(v);B=r.next().value;A=r.next().value;S=r.next().value;Z=r.next().value;M=r.next().value;m=r.next().value;T=B;K=A;P=S;F=Z;p=M;H=m;if(!T&&!K){Y5.G1(3);break}q=T?DV(T.thumbnail):[];if(!K){hj=[];Y5.G1(4);break}return g.Q(Y5,c0v(K,p),5);case 5:hj=Y5.K;case 4:return Ey=hj,g.Q(Y5,nt(q.concat(Ey)),3);case 3:IR=[];rF=g.kB(L,"downloadStatusEntity");$r=g.n(H);for(gF=$r.next();!gF.done;gF=$r.next())xr=gF.value,vA=g.xB(xr.key).entityId,Ei=zI(xr),qz=g.xB(Ei.action.entityKey).entityId,vA!==L&&
qz!==L||SX(f,xr.actionProto)||IR.push(xr.key);return g.Q(Y5,HF(W,{mode:"readwrite",Jg:!0},function(Gv){var o6=IR.map(function(y){return iv(Gv,y)});
o6.push(iv(Gv,e,{PK:!0}));o6.push(iv(Gv,rF,{PK:!0}));return g.w5.all(o6)}),7);
case 7:eA=(jx=F)==null?void 0:jx.offlineModeType,U&&(hD(U),U.offlineModeType&&(eA=U.offlineModeType)),ZV(P,eA),oo(I,{entityKey:e,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.n0(Y5)}})},iNc=function(L,W,f,I){var U,e,b,E,d,v,r,B,A,S,Z,M,m,T,K,P,F,p,H,q,hj,Ey,IR,rF,$r,gF,xr,vA,Ei,qz,jx,eA,Y5,Gv,o6,y,QN,mc,f0,uc,X,WK,KC,i8,CQ,ip,WA,fb,No,V;
return g.t(function(z){switch(z.W){case 1:return U=g.kB(L,"mainPlaylistEntity"),e=g.kB(L,"ytMainChannelEntity"),g.Q(z,HF(W,{mode:"readonly",Jg:!0},function(u){return g.w5.all([Go(u,U,"mainPlaylistEntity"),Go(u,e,"ytMainChannelEntity"),cF(u,"mainPlaylistEntity"),cF(u,"mainDownloadsListEntity"),cF(u,"ytMainChannelEntity"),cF(u,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:b=z.K;E=g.n(b);d=E.next().value;v=E.next().value;r=E.next().value;B=E.next().value;A=E.next().value;S=E.next().value;Z=d;M=v;m=r;T=B;K=A;P=S;if(!Z&&!M){z.G1(3);break}F=Z?sHO(Z):[];if(!M){p=[];z.G1(4);break}return g.Q(z,c0v(M,K),5);case 5:p=z.K;case 4:return H=p,g.Q(z,nt(F.concat(H)),3);case 3:q=[];hj=new Map;if(!Z){z.G1(7);break}return g.Q(z,qnG(Z,m,T),8);case 8:q=z.K;Ey=g.n(q);for(IR=Ey.next();!IR.done;IR=Ey.next())rF=IR.value,hj.set(rF,{videoId:rF,playlistId:L,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.Q(z,HF(W,{mode:"readonly",Jg:!0},function(u){return g.w5.all([cF(u,"transfer"),cF(u,"videoDownloadContextEntity")])}),9);
case 9:$r=z.K;gF=g.n($r);xr=gF.next().value;vA=gF.next().value;Ei=xr;qz=vA;jx=g.n(Ei);for(eA=jx.next();!eA.done;eA=jx.next())Y5=eA.value,Gv=g.xB(Y5.key).entityId,(o6=hj.get(Gv))&&Y5&&(o6.cotn=Y5.cotn);y=g.n(qz);for(QN=y.next();!QN.done;QN=y.next())mc=QN.value,f0=g.xB(mc.key).entityId,(uc=hj.get(f0))&&mc&&(uc.offlineModeType=mc.offlineModeType);case 7:X=[];WK=g.n(P);for(KC=WK.next();!KC.done;KC=WK.next())i8=KC.value,CQ=g.xB(i8.key).entityId,ip=zI(i8),CQ!==L&&ip.rootActionId!==L||SX(f,i8.actionProto)||
X.push(i8.key);WA=g.kB(L,"mainPlaylistEntity");return g.Q(z,HF(W,{mode:"readwrite",Jg:!0},function(u){var J=X.map(function(c){return iv(u,c)});
J.push(iv(u,WA,{PK:!0}));return g.w5.all(J)}),10);
case 10:if(!Z){z.G1(0);break}q.reverse();if(!q){z.G1(0);break}fb=g.n(q);No=fb.next();case 13:if(No.done){z.G1(0);break}V=No.value;return g.Q(z,Vg(V,W,f,I,hj.get(V)),14);case 14:No=fb.next(),z.G1(13)}})},khc=function(L,W,f,I){var U,e,b,E,d,v,r,B,A;
return g.t(function(S){if(S.W==1)return U=g.kB("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),e=new Map,g.Q(S,HF(L,{mode:"readwrite",Jg:!0},function(Z){var M=cF(Z,"transfer"),m=cF(Z,"offlineOrchestrationActionWrapperEntity"),T=cF(Z,"videoDownloadContextEntity"),K=Go(Z,U,"mainDownloadsListEntity");return g.w5.all([M,m,T,K]).then(function(P){P=g.n(P);var F=P.next().value;var p=P.next().value;var H=P.next().value;var q=P.next().value;P=xfc.map(function(Ey){return GDv(Z,Ey)});
p=g.n(p);for(var hj=p.next();!hj.done;hj=p.next())hj=hj.value,SX(W,hj.actionProto)||P.push(iv(Z,hj.key,{PK:!0}));q&&(q.downloads=[],P.push(qt(Z,q,"mainDownloadsListEntity")));if(H)for(H=g.n(H),q=H.next();!q.done;q=H.next())q=q.value,p=g.xB(q.key).entityId,p=g.kB(p,"transfer"),e.set(p,q.offlineModeType);return g.w5.all(P).then(function(){return F})})}),2);
b=S.K;E=g.n(b);for(d=E.next();!d.done;d=E.next())v=d.value,ZV(v,e.get(v.key)),r=g.xB(v.key).entityId,B={videoId:r,offlineDeleteReason:I,cotn:v.cotn,offlineModeType:e.get(v.key)},hD(B),A=g.kB(r,"mainVideoEntity"),oo(f,{entityKey:A,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.Q(S,GhX(),0)})},sHO=function(L,W){var f=[];
if(L.thumbnailStyleData){L=g.n(L.thumbnailStyleData);for(var I=L.next();!I.done;I=L.next()){var U=void 0,e=void 0,b=void 0;f=f.concat(DV((U=I.value)==null?void 0:(e=U.value)==null?void 0:(b=e.collageThumbnail)==null?void 0:b.coverThumbnail))}}W=DV(W);return f.concat(W)},qnG=function(L,W,f){var I,U,e,b,E,d,v,r,B,A,S,Z,M,m,T,K,P,F,p,H,q,hj,Ey;
return g.t(function(IR){I=[];U=new Set;if(f.length)for(e=g.n(f),b=e.next();!b.done;b=e.next())if(E=b.value,d=void 0,(d=E.downloads)==null?0:d.length)for(v=g.n(E.downloads),r=v.next();!r.done;r=v.next())B=r.value,B.videoItem&&(A=g.xB(B.videoItem).entityId,U.add(A));if(L.videos){S=g.n(L.videos);for(Z=S.next();!Z.done;Z=S.next())M=Z.value,m=JSON.parse(g.xB(M).entityId),m.videoId&&!U.has(m.videoId)&&I.push(m.videoId);T=g.n(W);for(K=T.next();!K.done;K=T.next())if(P=K.value,P.key!==L.key&&(F=P.videos))for(p=
g.n(F),H=p.next();!H.done;H=p.next())q=H.value,hj=JSON.parse(g.xB(q).entityId),hj.videoId&&(Ey=I.indexOf(hj.videoId),Ey!==-1&&I.splice(Ey,1))}return IR.return(I)})},c0v=function(L,W){var f,I,U,e,b,E,d,v;
return g.t(function(r){f=DV(L.avatar);I=g.n(W);for(U=I.next();!U.done;U=I.next())if(e=U.value,e.id!==L.id)for(b=g.n(DV(e.avatar)),E=b.next();!E.done;E=b.next())d=E.value,v=f.indexOf(d),v!==-1&&f.splice(v,1);return r.return(f)})},HNA=function(L){var W;
return g.t(function(f){W=g.R(L.frameworkUpdates,m0);return L.frameworkUpdates&&W?g.Q(f,fBL(W),0):f.return()})},ONL=function(L){var W;
if((W=L.onResponseReceivedActions)!=null&&W.length){var f;L=(f=g.R(g.R(L.onResponseReceivedActions[0],lBt),g.lEv))==null?void 0:f.actions;if(L!=null&&L.length)return L}},Lbi=function(L){var W,f,I;
return g.t(function(U){if(U.W==1)return L?g.Q(U,Ok(L,g.aP,"mainDownloadsListEntity"),2):U.return([]);W=U.K;return((f=W)==null?0:(I=f.downloads)==null?0:I.length)?U.return(W.downloads.map(function(e){var b;return(b=e.videoItem)!=null?b:""})):U.return([])})},$mD=function(L,W){var f;
return g.t(function(I){return I.W==1?g.Q(I,WbC(L,W),2):(f=I.K)?g.Q(I,HF(L,{mode:"readwrite",Jg:!0},function(U){var e=[qt(U,f.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];f.mainDownloadsListEntity&&e.push(qt(U,f.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.w5.all(e)}),0):I.G1(0)})},WbC=function(L,W){var f,I,U,e,b,E,d,v,r,B,A,S,Z,M,m,T,K,P;
return g.t(function(F){if(F.W==1)return f=g.kB("main_downloads_library_id","mainDownloadsLibraryEntity"),I=g.kB("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.Q(F,HF(L,{mode:"readonly",Jg:!0},function(p){return g.w5.all([Go(p,f,"mainDownloadsLibraryEntity"),Go(p,I,"mainDownloadsListEntity")])}),2);
U=F.K;e=g.n(U);b=e.next().value;E=e.next().value;d=b;v=E;d||(d={id:f});r=g.n(W);for(B=r.next();!B.done;B=r.next())if(A=B.value,A===g.aP){if(d.smartDownloadsList)return F.return();d.smartDownloadsList=A}else if(S=g.xB(A).entityType,Z={},S==="mainPlaylistEntity"?Z.playlistItem=A:S==="mainVideoEntity"&&(Z.videoItem=A),!g.vc(Z)){M=void 0;if((M=v)==null?0:M.downloads){m=!1;T=g.n(v.downloads);for(K=T.next();!K.done;K=T.next())if(P=K.value,P.playlistItem===A||P.videoItem===A){m=!0;break}m||v.downloads.push(Z)}else v=
{id:I,downloads:[Z]};d.downloadsList=I}return F.return({mainDownloadsLibraryEntity:d,mainDownloadsListEntity:v})})},fpG=function(L,W){var f,I,U,e,b,E,d,v,r,B,A,S,Z,M,m;
return g.t(function(T){if(T.W==1)return f=g.kB("main_downloads_library_id","mainDownloadsLibraryEntity"),I=g.kB("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.Q(T,HF(L,{mode:"readonly",Jg:!0},function(K){return g.w5.all([Go(K,f,"mainDownloadsLibraryEntity"),Go(K,I,"mainDownloadsListEntity"),Go(K,g.aP,"mainDownloadsListEntity")])}),2);
U=T.K;e=g.n(U);b=e.next().value;E=e.next().value;d=e.next().value;v=b;r=E;B=d;if(!v)return T.G1(0);if(W===g.aP&&((A=B)==null?0:A.downloads))B.downloads=[];else if((S=r)==null?0:S.downloads)for(Z=g.xB(W).entityType,M=0;M<r.downloads.length;M++)if(m=r.downloads[M],Z==="mainVideoEntity"&&m.videoItem===W){r.downloads.splice(M,1);break}else if(Z==="mainPlaylistEntity"&&m.playlistItem===W){r.downloads.splice(M,1);break}return g.Q(T,HF(L,{mode:"readwrite",Jg:!0},function(K){var P=[qt(K,v,"mainDownloadsLibraryEntity")];
r&&P.push(qt(K,r,"mainDownloadsListEntity"));B&&P.push(qt(K,B,"mainDownloadsListEntity"));return g.w5.all(P)}),0)})},uO=function(L,W){var f,I,U,e,b,E,d,v,r,B,A;
return g.t(function(S){if(S.W==1)return f=g.kB(W,"transfer"),I=g.kB(W,"videoDownloadContextEntity"),g.Q(S,HF(L,{mode:"readonly",Jg:!0},function(Z){return g.w5.all([Go(Z,f,"transfer"),Go(Z,I,"videoDownloadContextEntity")])}),2);
U=S.K;e=g.n(U);b=e.next().value;E=e.next().value;d=b;v=E;A={videoId:W,cotn:(r=d)==null?void 0:r.cotn,offlineModeType:(B=v)==null?void 0:B.offlineModeType};return S.return(A)})},Kt=function(L,W,f,I,U){var e,b,E,d,v,r,B,A,S,Z,M,m,T,K,P,F,p,H,q,hj;
return g.t(function(Ey){switch(Ey.W){case 1:return e=g.kB(L,"musicTrack"),b=g.kB(L,"transfer"),g.Q(Ey,HF(W,{mode:"readonly",Jg:!0},function(IR){return g.w5.all([Go(IR,e,"musicTrack"),Go(IR,b,"transfer"),cF(IR,"musicTrack"),cF(IR,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:E=Ey.K;d=g.n(E);v=d.next().value;r=d.next().value;B=d.next().value;A=d.next().value;S=v;Z=r;M=B;m=A;if(!S){Ey.G1(3);break}return g.Q(Ey,Ipn(S,M),4);case 4:return T=Ey.K,g.Q(Ey,nt(T),3);case 3:K=[];P=g.n(m);for(F=P.next();!F.done;F=P.next())p=F.value,H=g.xB(p.key).entityId,q=zI(p),hj=g.xB(q.action.entityKey).entityId,H!==L&&hj!==L||SX(f,p.actionProto)||K.push(p.key);return g.Q(Ey,HF(W,{mode:"readwrite",Jg:!0},function(IR){var rF=K.map(function($r){return iv(IR,$r)});
rF.push(iv(IR,e,{PK:!0}));return g.w5.all(rF)}),6);
case 6:ZV(Z),U&&hD(U),oo(I,{entityKey:e,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.n0(Ey)}})},TI=function(L,W,f,I,U){var e,b,E,d,v,r,B,A,S,Z,M,m,T,K,P,F,p,H,q,hj,Ey,IR,rF,$r,gF,xr,vA,Ei,qz,jx,eA,Y5,Gv,o6,y,QN;
return g.t(function(mc){switch(mc.W){case 1:return e=g.kB(L,W),b=g.kB("music_downloads_library_id","musicDownloadsLibraryEntity"),g.Q(mc,HF(f,{mode:"readonly",Jg:!0},function(f0){return g.w5.all([Go(f0,e,W),Go(f0,b,"musicDownloadsLibraryEntity"),cF(f0,W),cF(f0,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:E=mc.K;d=g.n(E);v=d.next().value;r=d.next().value;B=d.next().value;A=d.next().value;S=v;Z=r;M=B;m=A;if(!S){mc.G1(3);break}return g.Q(mc,Ipn(S,M),4);case 4:return T=mc.K,g.Q(mc,nt(T),3);case 3:K=[];P=new Map;if(!S){mc.G1(6);break}return g.Q(mc,Umc(S,M,Z),7);case 7:K=mc.K;F=g.n(K);for(p=F.next();!p.done;p=F.next())H=p.value,q=g.xB(H).entityId,P.set(q,{videoId:q,playlistId:L,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.Q(mc,Lt(f,"transfer"),8);case 8:for(hj=mc.K,Ey=
g.n(hj),IR=Ey.next();!IR.done;IR=Ey.next())rF=IR.value,$r=g.xB(rF.key).entityId,(gF=P.get($r))&&rF&&(gF.cotn=rF.cotn);case 6:xr=[];vA=g.n(m);for(Ei=vA.next();!Ei.done;Ei=vA.next())qz=Ei.value,jx=g.xB(qz.key).entityId,eA=zI(qz),jx!==L&&eA.rootActionId!==L||SX(I,qz.actionProto)||xr.push(qz.key);Y5=g.kB(L,W);return g.Q(mc,HF(f,{mode:"readwrite",Jg:!0},function(f0){var uc=xr.map(function(X){return iv(f0,X)});
uc.push(iv(f0,Y5,{PK:!0}));return g.w5.all(uc)}),9);
case 9:if(!S){mc.G1(0);break}K.reverse();if(!K.length){mc.G1(0);break}Gv=g.n(K);o6=Gv.next();case 12:if(o6.done){mc.G1(0);break}y=o6.value;QN=g.xB(y).entityId;if(!QN){mc.G1(13);break}return g.Q(mc,Kt(QN,f,I,U,P.get(QN)),13);case 13:o6=Gv.next(),mc.G1(12)}})},yg=function(L,W,f){var I,U,e,b,E,d,v;
return g.t(function(r){if(r.W==1)return g.Q(r,HF(L,{mode:"readwrite",Jg:!0},function(B){var A=cF(B,"transfer"),S=cF(B,"offlineOrchestrationActionWrapperEntity");return g.w5.all([A,S]).then(function(Z){Z=g.n(Z);var M=Z.next().value;var m=Z.next().value;Z=eji.map(function(F){return GDv(B,F)});
m=g.n(m);for(var T=m.next();!T.done;T=m.next()){T=T.value;var K=g.xB(T.actionProto.entityKey).entityType==="musicTrack",P=T.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";SX(W,T.actionProto)||K&&(!K||P)||Z.push(iv(B,T.key,{PK:!0}))}return g.w5.all(Z).then(function(){return M})})}),2);
I=r.K;U=g.n(I);for(e=U.next();!e.done;e=U.next())b=e.value,ZV(b),E=g.xB(b.key).entityId,d={videoId:E,offlineDeleteReason:void 0,cotn:b.cotn},hD(d),v=g.kB(E,"musicTrack"),oo(f,{entityKey:v,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.Q(r,GhX(),0)})},oC5=function(L){for(var W,f=g.n(L.additionalMetadatas),I=f.next();!I.done;I=f.next())I=I.value,I.offlineMusicVideoData&&(W=I.offlineMusicVideoData);
var U,e,b,E,d;return{id:g.kB(L.videoId,"musicTrack"),videoId:L.videoId,title:L.title,thumbnailDetails:L.thumbnail,lengthMs:String(Number(L.lengthSeconds)*1E3),albumTitle:(U=W)==null?void 0:U.releaseTitle,musicVideoType:(e=W)==null?void 0:e.musicVideoType,contentRating:{explicitType:(b=W)==null?void 0:b.explicitType},artistNames:((E=W)==null?void 0:E.byline)||((d=W)==null?void 0:d.channelName),downloadMetadata:g.kB(L.videoId,"musicTrackDownloadMetadataEntity")}},Umc=function(L,W,f){var I,U,e,b,E,d,
v,r,B,A,S,Z,M,m,T,K,P,F;
return g.t(function(p){I=[];U=new Set;if((e=f)==null?0:(b=e.downloadedTracks)==null?0:b.length)for(E=g.n(f.downloadedTracks),d=E.next();!d.done;d=E.next())v=d.value,U.add(v);if(L.tracks){r=g.n(L.tracks);for(B=r.next();!B.done;B=r.next())A=B.value,U.has(A)||I.push(A);S=g.n(W);for(Z=S.next();!Z.done;Z=S.next())if(M=Z.value,M.id!==L.id&&(m=M.tracks))for(T=g.n(m),K=T.next();!K.done;K=T.next())P=K.value,F=I.indexOf(P),F!==-1&&I.splice(F,1)}return p.return(I)})},Ipn=function(L,W){var f,I,U,e,b,E,d,v;
return g.t(function(r){f=DV(L.thumbnailDetails);I=g.n(W);for(U=I.next();!U.done;U=I.next())if(e=U.value,e.id!==L.id)for(b=g.n(DV(e.thumbnailDetails)),E=b.next();!E.done;E=b.next())d=E.value,v=f.indexOf(d),v!==-1&&f.splice(v,1);return r.return(f)})},bZi=function(L,W){var f,I,U,e,b,E,d,v,r;
return g.t(function(B){if(B.W==1)return f=g.kB("music_downloads_library_id","musicDownloadsLibraryEntity"),g.Q(B,Ok(L,f,"musicDownloadsLibraryEntity"),2);(I=B.K)||(I={id:f});U=g.xB(W).entityType;U==="musicTrack"?(e=I.downloadedTracks)!=null&&e.includes(W)||(I.downloadedTracks=((b=I.downloadedTracks)!=null?b:[]).concat(W)):U==="musicPlaylist"?(E=I.downloadedPlaylists)!=null&&E.includes(W)||(I.downloadedPlaylists=((d=I.downloadedPlaylists)!=null?d:[]).concat(W)):U!=="musicAlbumRelease"||(v=I.downloadedAlbumReleases)!=
null&&v.includes(W)||(I.downloadedAlbumReleases=((r=I.downloadedAlbumReleases)!=null?r:[]).concat(W));return g.Q(B,lv(L,I,"musicDownloadsLibraryEntity"),0)})},hjQ=function(L,W){var f,I,U,e,b,E,d;
return g.t(function(v){if(v.W==1)return f=g.kB("music_downloads_library_id","musicDownloadsLibraryEntity"),g.Q(v,Ok(L,f,"musicDownloadsLibraryEntity"),2);I=v.K;if(!I)return v.G1(0);U=g.xB(W).entityType;U==="musicTrack"?e=I.downloadedTracks:U==="musicPlaylist"&&(e=I.downloadedPlaylists);if((b=e)==null?0:b.length)for(E=0;E<e.length;E++)if(d=e[E],d===W){e.splice(E,1);break}return g.Q(v,lv(L,I,"musicDownloadsLibraryEntity"),0)})},ECc=function(L){var W=L.videos;
L=[];var f=[];if(W){W=g.n(W);for(var I=W.next();!I.done;I=W.next()){var U=I.value.offlineVideoData.videoId;I=g.kB(U,"musicTrack");U=g.kB(U,"musicTrackDownloadMetadataEntity");L.push(I);f.push(U)}}return{nk:L,SV:f}},g_=function(L,W,f){W={track:oC5(W)};
f&&(W.playlistId=f);if(L=g.R(L.actionMetadata,dmO))W.maximumDownloadQuality=L.maximumDownloadQuality;return{musicTrackEntityActionMetadata:W}},rID=function(L){var W,f,I,U,e,b,E,d;
return g.t(function(v){switch(v.W){case 1:return W=g.sX(),f=df5(L),I=g.ly(vCc),g.XK(v,2),e={Zy:!0},g.Q(v,g.Pg(W,f,I,void 0,e),4);case 4:U=v.K;g.TM(v,3);break;case 2:b=g.y7(v);if(b instanceof g.NS)throw E="GetOffline network manager error: "+b.message,Uj(E,b),Error(E);Uj("GetOffline fetch request error",b);throw Error("GetOffline fetch request error");case 3:d=Qg(U);if(!U)throw Uj("Network request failed"),Error("Network request failed");if(d!==void 0)jX(d);else if(!U.videos||!U.videos.length)throw Uj("No data"),
Error("No data");return v.return(U.videos.map(function(r){return r.offlineVideoData}))}})},BWW=function(L){var W,f,I,U,e,b,E,d;
return g.t(function(v){switch(v.W){case 1:return W=g.sX(),f=vFC(L),I=g.ly(vCc),g.XK(v,2),e={Zy:!0},g.Q(v,g.Pg(W,f,I,void 0,e),4);case 4:U=v.K;g.TM(v,3);break;case 2:b=g.y7(v);if(b instanceof g.NS)throw E="GetOffline network manager error for playlist: "+b.message,Uj(E,b),Error(E);Uj("GetOffline fetch request error for playlist",b);throw Error("GetOffline fetch request error for playlist");case 3:d=Qg(U);if(!U)throw Uj("Network request failed for playlist"),Error("Network request failed for playlist");
if(d!==void 0)jX(d,"playlist");else if(!U.playlists||!U.playlists.length)throw Uj("No data for playlist"),Error("No data for playlist");return v.return(U.playlists.map(function(r){return r.offlinePlaylistData}))}})},SFD=function(L,W,f,I){var U,e,b,E,d,v,r,B,A,S,Z,M,m,T,K,P,F,p,H,q,hj,Ey,IR,rF,$r,gF,xr,vA,Ei,qz;
return g.t(function(jx){switch(jx.W){case 1:return g.Q(jx,Wo(),2);case 2:U=jx.K;if(!U)return jx.return([]);e=[];if((b=I)==null?0:b.length){e=I;jx.G1(3);break}return g.Q(jx,Lt(U,"mainPlaylistEntity"),4);case 4:e=jx.K;case 3:if(!e.length)return jx.return([]);E=[];d=Date.now()/1E3;v=g.n(e);r=v.next();case 5:if(r.done)return E.length?g.Q(jx,AIC(E),10):jx.return([]);B=r.value;if(!B.downloadState){A=void 0;jx.G1(8);break}return g.Q(jx,Ok(U,B.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:A=
jx.K;case 8:S=A;Z=void 0;m=(M=(Z=B)==null?void 0:Z.entityMetadata)&&M.nextAutoRefreshIntervalSeconds?Number(M.nextAutoRefreshIntervalSeconds):NaN;T=Number.isNaN(m)?L:m;P=K=void 0;F=((K=S)==null?0:K.lastSyncedTimestampMillis)?Number((P=S)==null?void 0:P.lastSyncedTimestampMillis)/1E3:0;H=p=void 0;q=((p=S)==null?0:p.addedTimestampMillis)?Number((H=S)==null?void 0:H.addedTimestampMillis)/1E3:0;if(f||!M||F+T<=d){hj=[];Ey=void 0;if((Ey=B.videos)==null?0:Ey.length)for(IR=g.n(B.videos),rF=IR.next();!rF.done;rF=
IR.next())$r=rF.value,gF=JSON.parse(g.xB($r).entityId),gF.videoId&&hj.push(gF.videoId);xr="0";M&&(vA=void 0,xr=String(Number((vA=M.offlineLastModifiedTimestampSeconds)!=null?vA:0).toFixed()));Ei={playlistId:B.playlistId,videoIds:hj,offlineLastModifiedTimestamp:xr,autoSync:W,offlineDateAddedTimestamp:String(q.toFixed())};E.push(Ei)}r=v.next();jx.G1(5);break;case 10:return qz=jx.K,jx.return(qz)}})},ZZt=function(){var L,W,f,I,U;
return g.t(function(e){if(e.W==1)return g.Q(e,Wo(),2);if(e.W!=3)return(L=e.K)?g.Q(e,Lt(L,"refresh"),3):e.return(!1);W=e.K;if((f=W[0])==null||!f.refreshTime)return e.return(!1);I=Number(W[0].refreshTime);U=Date.now()/1E3;return e.return(isFinite(I)&&U>=I)})},wjC=function(L,W){var f,I,U;
return g.t(function(e){switch(e.W){case 1:return g.XK(e,2),g.Q(e,Dmn(L,W),4);case 4:return I=e.K,g.Q(e,HNA(I),5);case 5:f=ONL(I);g.TM(e,3);break;case 2:U=g.y7(e),Uj("getAndProcessSmartDownloadsResponse request or processing error",U);case 3:return e.return(f)}})},zjD=function(L,W,f,I){var U,e,b,E,d,v,r,B,A,S,Z,M,m,T,K,P,F,p,H,q,hj,Ey,IR,rF,$r,gF,xr,vA,Ei,qz;
return g.t(function(jx){switch(jx.W){case 1:return g.Q(jx,Wo(),2);case 2:U=jx.K;if(!U)return jx.return([]);e=[];if((b=I)==null?0:b.length){e=I;jx.G1(3);break}return g.Q(jx,Lt(U,"musicPlaylist"),4);case 4:e=jx.K;case 3:if(!e.length)return jx.return([]);E=[];d=Date.now()/1E3;v=g.n(e);r=v.next();case 5:if(r.done)return E.length?g.Q(jx,AIC(E),10):jx.return([]);B=r.value;A=void 0;Z=(S=(A=B)==null?void 0:A.entityMetadata)&&S.nextAutoRefreshIntervalSeconds?Number(S.nextAutoRefreshIntervalSeconds):NaN;M=
Number.isNaN(Z)?L:Z;T=m=0;K="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!B.downloadMetadata){jx.G1(8);break}return g.Q(jx,Ok(U,B.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:P=jx.K,p=F=void 0,m=Number((p=(F=P)==null?void 0:F.addedTimestampMillis)!=null?p:"0")/1E3,q=H=void 0,T=Number((q=(H=P)==null?void 0:H.lastModifiedTimestampMillis)!=null?q:"0")/1E3,Ey=hj=void 0,K=(Ey=(hj=P)==null?void 0:hj.syncState)!=null?Ey:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:IR=void 0;if(f||K!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!S||Number((IR=S.lastSyncedTimestampSeconds)!=null?IR:0)+M<=d){rF=[];$r=void 0;if(($r=B.tracks)==null?0:$r.length)for(gF=g.n(B.tracks),xr=gF.next();!xr.done;xr=gF.next())vA=xr.value,rF.push(g.xB(vA).entityId);Ei={playlistId:B.playlistId,videoIds:rF,offlineLastModifiedTimestamp:String(T.toFixed()),autoSync:W,offlineDateAddedTimestamp:String(m.toFixed())};E.push(Ei)}r=v.next();jx.G1(5);break;case 10:return qz=jx.K,jx.return(qz)}})},Dmn=function(L,W){var f,I,U,e,b,E,d,v,r,B;
return g.t(function(A){switch(A.W){case 1:return f=g.sX(),g.Q(A,Wo(),2);case 2:I=A.K;if(!I){A.G1(3);break}return g.Q(A,wHn(I),4);case 4:U=A.K;case 3:var S=U;e={context:g.x3(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:L},offlineClientState:S,clientStateRequestData:{preferredFormatType:W}}}};b=g.ly(M2c);g.XK(A,5);d={Zy:!0};return g.Q(A,g.Pg(f,e,b,void 0,d),7);case 7:E=A.K;g.TM(A,6);break;case 5:v=g.y7(A);if(v instanceof g.NS)throw r=
"DPS network manager error for smart downloads: "+v.message,Uj(r,v),Error(r);Uj("DPS fetch request error for smart downloads",v);throw Error("DPS fetch request error for smart downloads");case 6:B=Qg(E);if(E)B!==void 0&&jX(B,"smart downloads");else throw Uj("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return A.return(E)}})},Xjc=function(L,W){var f,I,U,e,b,E,d,v;
return g.t(function(r){switch(r.W){case 1:return f=g.sX(),I={context:g.x3(),videoPlaybackPositionEntities:L,lastSyncTimestampUsec:W},U=g.ly(nCi),g.XK(r,2),b={Zy:!0},g.Q(r,g.Pg(f,I,U,void 0,b),4);case 4:e=r.K;g.TM(r,3);break;case 2:E=g.y7(r);if(E instanceof g.NS)throw d="VPPS network manager error: "+E.message,Uj(d,E),Error(d);Uj("VPPS fetch request error",E);throw Error("VPPS fetch request error");case 3:v=Qg(e);if(e)v!==void 0&&jX(v,"position sync");else throw Uj("Network request failed for position sync"),
Error("Network request failed for position sync");return r.return(e)}})},mmL=function(L,W,f){var I,U,e,b,E,d,v,r;
return g.t(function(B){switch(B.W){case 1:I=g.sX();var A=f.refreshData,S=f.isEnqueuedForExpiredStreamUrlRefetch,Z=f.K0,M=f.offlineSourceData,m=f.mediaCapabilities,T={entityKey:L};A&&(T.refreshData=A);S&&(T.isExpiredStreamUrlRefetch=S);Z&&(T.downloadParameters=Z);M&&(T.offlineSourceData=M);A={context:g.mL(W),signatureTimestamp:20335,videos:[T]};m&&(A.mediaCapabilities=m);U=A;e=g.ly(V2c);g.XK(B,2);E={Zy:!0};return g.Q(B,g.Pg(I,U,e,void 0,E),4);case 4:b=B.K;g.TM(B,3);break;case 2:d=g.y7(B);if(d instanceof
g.NS)throw v="GetPDE network manager error: "+d.message,Uj(v,d),Error(v);Uj("GetPDE fetch request error",d);throw Error("GetPDE fetch request error");case 3:r=Qg(b);if(b)r!==void 0&&jX(r,"PDE");else throw Uj("Network request failed for PDE"),Error("Network request failed for PDE");return B.return(b)}})},Qg=function(L){var W;
return(W=L.errorMetadata)==null?void 0:W.status},jX=function(L,W){W=W?" for "+W:"";
if(L===0)throw L="Empty response body"+W,Uj(L),Error(L);L="Response with error"+W;Uj(L);throw Error(L);},AIC=function(L){var W,f,I,U,e,b,E,d;
return g.t(function(v){switch(v.W){case 1:return W=g.sX(),f=r05(L),I=g.ly(uIO),g.XK(v,2),e={Zy:!0},g.Q(v,g.Pg(W,f,I,void 0,e),4);case 4:U=v.K;g.TM(v,3);break;case 2:b=g.y7(v);if(b instanceof g.NS)throw E="offlinePlaylistSyncCheck network manager error: "+b.message,Uj(E,b),Error(E);Uj("offlinePlaylistSyncCheck fetch request error",b);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:d=Qg(U);if(!U)throw Uj("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(d!==void 0)jX(d,"playlist sync");else if(!U.offlinePlaylistSyncCheckDatas||!U.offlinePlaylistSyncCheckDatas.length)throw Uj("No data for playlist sync"),Error("No data for playlist sync");return v.return(U.offlinePlaylistSyncCheckDatas.map(function(r){return r.offlinePlaylistSyncCheckData}))}})},tD=function(L){this.W=L},Kbi=function(L,W){var f,I,U,e,b,E;
return g.t(function(d){switch(d.W){case 1:f=new Map,I=g.n(W),U=I.next();case 2:if(U.done){d.G1(4);break}e=U.value;b=f;E=b.set;return g.Q(d,L.K(e),5);case 5:E.call(b,e,d.K);U=I.next();d.G1(2);break;case 4:return d.return(f)}})},Po=function(L,W,f,I,U,e){W=g.kB(W,f);
I=Object.assign({},e,{priority:I,retryScheduleIntervalsInSeconds:U});return{actionType:L,entityKey:W,actionMetadata:I}},JD=function(L,W,f,I,U,e){this.status=L;
this.W=W;this.T=f;this.K=I;this.N=U;this.downloadState=e},TW5=function(L,W,f){this.W=L;
this.kp=W;this.N=f},QAL=function(L,W){var f,I,U,e,b,E,d,v,r;
return g.t(function(B){switch(B.W){case 1:return f=W.entityKey,U=(I=g.R(W.actionMetadata,Y0))==null?void 0:I.isEnqueuedForExpiredStreamUrlRefetch,g.XK(B,2),e=void 0,g.Q(B,yIt(L,W),4);case 4:e=B.K;g.XK(B,5);var A=(A=g.R(W.actionMetadata,Y0))?{maximumDownloadQuality:A.maximumDownloadQuality}:void 0;return g.Q(B,mmL(f,L.kp,{isEnqueuedForExpiredStreamUrlRefetch:U,K0:A,offlineSourceData:e}),7);case 7:b=B.K;g.TM(B,6,2);break;case 5:return g.y7(B,2),E=d_(W)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",Uj("PDE handleAdd error"),B.return(FJ(W,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",E,"DOWNLOAD_STATE_FAILED"));case 6:return g.Q(B,gCG(L,b,W),8);case 8:return B.return(FJ(W,!0,b.orchestrationActions));case 2:return d=g.y7(B),v="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",r="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",d instanceof g.vm&&d.type==="QUOTA_EXCEEDED"&&(v="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
r="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Uj("PDE handleAdd error"),B.return(FJ(W,!1,void 0,v,r,"DOWNLOAD_STATE_FAILED"))}})},PnD=function(L,W){var f,I,U,e,b,E,d,v,r,B,A,S,Z,M,m,T,K,P,F,p,H,q,hj,Ey;
return g.t(function(IR){switch(IR.W){case 1:return f=W.entityKey,I=g.xB(f).entityId,g.Q(IR,HF(L.W,{mode:"readonly",Jg:!0},function(rF){var $r=Go(rF,f,"playbackData"),gF=Go(rF,g.kB(I,"offlineVideoPolicy"),"offlineVideoPolicy");rF=Go(rF,g.kB(I,"transfer"),"transfer");return g.w5.all([$r,gF,rF])}),2);
case 2:U=IR.K;e=g.n(U);b=e.next().value;E=e.next().value;d=e.next().value;v=b;r=E;B=d;if(!v||!r)return IR.return(FJ(W,!0));A=[];M=((Z=v)==null?0:Z.playerResponseJson)?JSON.parse(v.playerResponseJson):null;if(!(B&&M&&L.kp.Z("html5_refresh_deprecated_downloads"))){IR.G1(3);break}S=jAc(L,M,B);return g.Q(IR,t2O(L,B),4);case 4:A=IR.K;case 3:m={lastPlayerResponseTimestampSeconds:v.playerResponseTimestamp,offlineToken:r.offlineToken,formatIds:A};T={};if((K=B)==null?0:K.maximumDownloadQuality)T.maximumDownloadQuality=
B.maximumDownloadQuality;g.XK(IR,5);P=void 0;return g.Q(IR,yIt(L,W),7);case 7:return P=IR.K,g.XK(IR,8),g.Q(IR,mmL(f,L.kp,{refreshData:m,K0:T,offlineSourceData:P,mediaCapabilities:S}),10);case 10:F=IR.K;g.TM(IR,9,5);break;case 8:return g.y7(IR,5),p=d_(W)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",Uj("PDE handleRefresh error"),IR.return(FJ(W,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",p,
"DOWNLOAD_STATE_FAILED"));case 9:return g.Q(IR,gCG(L,F,W),11);case 11:return IR.return(FJ(W,!0,F.orchestrationActions));case 5:return H=g.y7(IR),q="PDE handleRefresh error",H instanceof Error&&(q="PDE handleRefresh error: "+H.message),hj="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Ey="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",H instanceof g.vm&&H.type==="QUOTA_EXCEEDED"&&(hj="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Ey="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
Uj(q),IR.return(FJ(W,!1,void 0,hj,Ey,"DOWNLOAD_STATE_FAILED"))}})},yIt=function(L,W){var f,I,U,e;
return g.t(function(b){if(b.W==1)return f=g.xB(W.entityKey).entityId,I=g.kB(f,"videoDownloadContextEntity"),g.Q(b,Ok(L.W,I,"videoDownloadContextEntity"),2);U=b.K;return(e=U)!=null&&e.offlineModeType?b.return({offlineModeType:U.offlineModeType}):b.return(void 0)})},gCG=function(L,W,f){var I,U,e,b,E;
return g.t(function(d){if(d.W==1){if(!W.frameworkUpdates||!g.R(W.frameworkUpdates,m0))return d.return();if(!(g.R(W.frameworkUpdates,m0).mutations&&g.R(W.frameworkUpdates,m0).mutations.length>0&&g.R(W.frameworkUpdates,m0).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return d.G1(2);I=g.xB(g.R(W.frameworkUpdates,m0).mutations[0].entityKey).entityId;return g.Q(d,uO(L.W,I),3)}if(d.W!=2){U=d.K;e=g.R(f.actionMetadata,Y0);if(E=(b=e)==null?void 0:b.playlistId)U.playlistId=E;U.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.X8(L.kp)?g.Q(d,Vg(I,L.W,f,L.N,U),2):g.PQ(L.kp)?g.Q(d,Kt(I,L.W,f,L.N),2):d.G1(2)}return g.Q(d,fBL(g.R(W.frameworkUpdates,m0)),0)})},FJ=function(L,W,f,I,U,e){return new JD(W?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",d_(L),f,I,U,e)},jAc=function(L,W,f){W=RkA(L.kp,f.cotn,W);
f=g.PD(W);return g.PUj(W,f,L.kp)},t2O=function(L,W){var f,I,U,e,b,E,d,v,r,B,A;
return g.t(function(S){if(S.W==1)return f=[],g.Q(S,HF(L.W,{mode:"readonly",Jg:!0},function(Z){var M=[],m=W.offlineVideoStreams;if(m){m=g.n(m);for(var T=m.next();!T.done;T=m.next())M.push(Go(Z,T.value,"offlineVideoStreams"))}return g.w5.all(M)}),2);
if(I=S.K)for(U=g.n(I),e=U.next();!e.done;e=U.next())if(b=e.value,E=void 0,(E=b)==null?0:E.streamsProgress)for(d=b.streamsProgress,v=0;v<d.length;v++)r=d[v],B=JSON.parse(r.formatStreamBytes),A={itag:B.itag,lmt:B.lastModified,xtags:B.xtags},f.push(A);return S.return(f)})},JIv=function(L,W){this.W=L;
this.kp=W},YFL=function(L,W){var f,I,U,e,b,E,d,v,r,B,A,S;
return g.t(function(Z){switch(Z.W){case 1:return f=d_(W),g.Q(Z,Lt(L.W,"videoPlaybackPositionEntity"),2);case 2:I=Z.K;if(I.length===0)return Z.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f));g.XK(Z,3);return g.Q(Z,pK.getInstance(),5);case 5:U=Z.K;if(!U)throw Error("prefStorage is undefined");return g.Q(Z,U.get("psi"),6);case 6:return e=Z.K,d=(E=(b=e)==null?void 0:b.Mv)!=null?E:"0",g.Q(Z,Xjc(I,d),7);case 7:return v=Z.K,r={isPaused:v.watchHistoryPaused,Mv:v.syncTimestampUsec},g.Q(Z,U.set("psi",
r),8);case 8:if(r.isPaused){Z.G1(9);break}B=g.R(v.frameworkUpdates,m0);if(!v.frameworkUpdates||!B){Z.G1(9);break}return g.Q(Z,fBL(B),9);case 9:g.TM(Z,4);break;case 3:return A=g.y7(Z),S="PPE handleRefresh error: "+(A instanceof Error?A.message:"unknown error"),Uj(S),Z.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return Z.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
f))}})},apc=function(L,W){var f,I,U,e,b,E,d,v;
return g.t(function(r){switch(r.W){case 1:return f=d_(W),I=g.xB(W.entityKey).entityId,g.XK(r,2),g.Q(r,pK.getInstance(),4);case 4:U=r.K;if(!U)throw Error("prefStorage is undefined");return g.Q(r,U.get("psi"),5);case 5:e=r.K;b=g.R(W.actionMetadata,Fbv);if(((E=e)==null?void 0:E.isPaused)!==!1||(d=b)==null||!d.lastPlaybackPositionSeconds){r.G1(6);break}v={key:g.kB(I,"videoPlaybackPositionEntity"),videoId:I,lastPlaybackPositionSeconds:b.lastPlaybackPositionSeconds};return g.Q(r,lv(L.W,v,"videoPlaybackPositionEntity"),
6);case 6:g.TM(r,3);break;case 2:return g.y7(r),r.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return r.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f))}})},CnX=function(L,W){var f,I,U;
return g.t(function(e){switch(e.W){case 1:f=d_(W);g.XK(e,2);I=g.xB(W.entityKey).entityId;if(I==="!*$_ALL_ENTITIES_!*$")return g.Q(e,lvi(L.W),5);U=g.kB(I,"videoPlaybackPositionEntity");return g.Q(e,HeL(L.W,U),5);case 5:g.TM(e,3);break;case 2:return g.y7(e),e.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return e.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
f))}})},pjA=function(L,W){this.api=L;
this.W=W;this.logger=new g.zF("woffle");this.K=!1;this.Kw={Li:this.Li};this.logger.debug("Initialized OfflineMediaManager")},RjL=function(L){return g.t(function(W){return W.return(EFv(L))})},NWO=function(L){var W;
return g.t(function(f){if(f.W==1)return g.Q(f,g.O20(L),2);W=f.K;return f.return(W.filter(function(I){return!!I.url}).map(function(I){return I.url}))})},ao=function(L,W){var f=g.Iq(W);
if(f===1||f===0)return Promise.resolve();(f=GiC(L,W))&&f.stopVideo();L.N=0;return RjL(W)},Ct=function(L,W,f,I){f=f===void 0?!1:f;
I=I===void 0?!0:I;var U=typeof W==="string"?W:W.videoDetails.videoId;g.Iq(U)===2&&((W=GiC(L,U))?W.stopVideo():L.logger.info(function(){return"Corresponding player for "+U+" not found. Pausing anyway"}),g.Us(U,2),L.N=2,f?cIW(L.W):I&&sAD(L.W))},GiC=function(L,W){var f;
return((f=L.player)==null?void 0:f.getVideoData().videoId)===W?L.player:null},qFX=function(L,W,f){W.getPlayerResponse();
g.Us(W.videoId,2);L.N=2;L.K=!1;var I;(I=L.player)==null||I.dispose();L.player=L.api.qJ(W);W={};L.player.mC((W.localmediachange=L.pU,W.signatureexpired=L.Go,W.statechange=L.bQV,W),L);L.Z("html5_generate_content_po_token")&&L.player.F8();var U=L.Li(f);L.player.Jf(g.KH(U,U,!0,"m"),!1);L.logger.debug(function(){return"Starting headless playback with quality: "+U});
L.player.f4(!1)},iZc=function(L,W){this.W=L;
this.kp=W},kii=function(L,W){var f,I;
return g.t(function(U){switch(U.W){case 1:return f=d_(W),g.Q(U,Ok(L.W,W.entityKey,"transfer"),2);case 2:if(I=U.K)return U.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f));g.XK(U,3);return g.Q(U,xm5(L,W),5);case 5:g.TM(U,4);break;case 3:return g.y7(U),U.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return U.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
f))}})},HZO=function(L,W){var f,I;
return g.t(function(U){switch(U.W){case 1:return f=d_(W),g.Q(U,Ok(L.W,W.entityKey,"transfer"),2);case 2:I=U.K;if(!I||I.transferState!=="TRANSFER_STATE_COMPLETE")return U.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f));g.XK(U,3);return g.Q(U,xm5(L,W,!0),5);case 5:g.TM(U,4);break;case 3:return g.y7(U),U.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return U.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f))}})},lp5=function(L,W){var f,I,U,e,b,E,d,v,r,B;
return g.t(function(A){switch(A.W){case 1:return f=d_(W),I=g.xB(W.entityKey).entityId,g.Q(A,HF(L.W,{mode:"readonly",Jg:!0},function(S){var Z=Go(S,W.entityKey,"transfer");S=Go(S,g.kB(I,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.w5.all([Z,S])}),2);
case 2:U=A.K;e=g.n(U);b=e.next().value;E=e.next().value;d=b;v=E;if(!d||d.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return A.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f));g.XK(A,3);d.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.Q(A,lv(L.W,d,"transfer"),5);case 5:r=g.xB(d.key).entityId;J0n({videoId:r,Xj:d,offlineModeType:(B=v)==null?void 0:B.offlineModeType});g.TM(A,4);break;case 3:return g.y7(A),A.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
f,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return A.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f))}})},xm5=function(L,W,f){f=f===void 0?!1:f;
var I,U,e,b,E,d,v,r,B,A,S,Z,M,m,T;return g.t(function(K){switch(K.W){case 1:return I=g.R(W.actionMetadata,OZW),U=g.xB(W.entityKey).entityId,e=g.kB(U,"downloadStatusEntity"),g.Q(K,HF(L.W,{mode:"readonly",Jg:!0},function(P){var F=Go(P,e,"downloadStatusEntity");P=Go(P,g.kB(U,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.w5.all([F,P])}),2);
case 2:return b=K.K,E=g.n(b),d=E.next().value,v=E.next().value,r=d,B=v,A="TRANSFER_STATE_TRANSFER_IN_QUEUE",((S=r)==null?void 0:S.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(A="TRANSFER_STATE_PAUSED_BY_USER"),m={key:W.entityKey,transferState:A,cotn:g.Z0(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(Z=I)==null?void 0:Z.maximumDownloadQuality,preferredAudioTrack:(M=I)==null?void 0:M.preferredAudioTrack,transferRetryCount:0,isRefresh:f,hasLoggedFirstStarted:!1},g.Q(K,HF(L.W,
{mode:"readwrite",Jg:!0},function(P){var F=[];f&&F.push(iv(P,g.kB(U,"offlineVideoStreams")));F.push(qt(P,m,"transfer"));return g.w5.all(F)}),3);
case 3:if(!f){K.G1(4);break}return g.Q(K,RjL(U),4);case 4:t8O({videoId:U,Xj:m,offlineModeType:(T=B)==null?void 0:T.offlineModeType}),g.n0(K)}})},WKi=function(L,W,f,I){if(!L.action.entityKey)throw Error("entityKey is missing.");
var U=g.xB(L.action.entityKey);U={entityType:U.Ct,entityId:U.entityId,offlineOrchestrationActionType:L.action.actionType,orchestrationAction:{orchestrationActionId:L.actionId}};W&&(U.offlineOrchestrationActionResult=W.status,U.isRetryable=f?!1:W.W,W.N&&(U.offlineOrchestrationFailureReason=LKL(W.N,U.isRetryable)));var e,b;if((e=L.action.actionMetadata)==null?0:(b=e.offlineLoggingData)==null?0:b.offlineModeType)U.offlineModeType=L.action.actionMetadata.offlineLoggingData.offlineModeType;I&&(U.additionalOrchestrationActions=
I.map(function(E){return{orchestrationActionId:E.actionId}}));
return U},LKL=function(L,W){return L!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||W?L==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&W?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":L:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},$YW=function(L,W){var f={offlineOrchestrationContext:WKi(L)};
W=ZNL(W,f);Dfc(SnW(),W,L.rootActionId)},fYO=function(L,W,f,I){I=I===void 0?[]:I;
W={offlineOrchestrationContext:WKi(L,W,f,I)};W=ZNL(3,W);Dfc(SnW(),W,L.rootActionId)},IYG=function(){this.actions=[]},UYO=function(L,W){W=g.n(W);
for(var f=W.next();!f.done;f=W.next())f=f.value,$YW(f,1),L.actions.push(f);L.actions.sort(L.W)},eGc=function(L,W){if(W)for(var f=0;f<L.actions.length;f++)if(W==="!*$_ALL_ENTITIES_!*$"&&L.actions[f].actionId!==W||W!=="!*$_ALL_ENTITIES_!*$"&&L.actions[f].rootActionId===W&&L.actions[f].actionId!==W)L.actions.splice(f,1),f--},oIc=function(L,W){L=g.n(L.actions);
for(var f=L.next();!f.done;f=L.next())if(f.value.actionId===W)return!0;return!1},pt=function(L,W,f,I,U){g.a.call(this);
var e=this;this.K=L;this.Rh=W;this.Kl=f;this.V=I;this.kp=U;this.W=new IYG;this.J=new g.R_;this.N=new g.sn(function(){e.retry()});
this.U=NaN;this.G=!1;this.Kw={Z4a:function(){return e.W},
t6:function(){return e.J},
H4l:function(){return e.N},
retry:function(){return e.retry()}};
g.C(this,this.N);this.X=this.K.observe(this.qV.bind(this))},EIi=function(L,W,f,I,U){var e;
return g.t(function(b){if(b.W==1)return e=new pt(L,W,f,I,U),g.Q(b,bjt(e),2);hGi(e);return b.return(e)})},hGi=function(L){var W=L.W.actions[0];
return L.T?((W==null?void 0:W.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&L.T[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(L.G=!0),Promise.resolve()):dYC(L)},dYC=function(L){var W,f,I,U,e,b,E,d,v,r,B,A,S,Z,M,m,T;
return g.t(function(K){switch(K.W){case 1:if(L.T)throw Error("Already processing an action");if(L.Je())return K.return();W=L.W.actions.shift();QHO(L.Kl,!W);if(W===void 0)return K.return();W.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&W.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&eGc(L.W,W.actionId);f="";W.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&W.rootActionId===W.actionId&&(f=W.actionId);I=[W];L.T=I;if(U=L.Rh[W.entityType]){K.G1(2);break}L.T=
void 0;return g.Q(K,dYC(L),3);case 3:return K.return();case 2:e=g.n(I);for(b=e.next();!b.done;b=e.next())E=b.value,$YW(E,2);g.XK(K,4,5);return g.Q(K,Kbi(U,I.map(function(P){return P.action})),7);
case 7:d=K.K,v=g.n(I),r=v.next();case 8:if(r.done){K.G1(10);break}B=r.value;A=d.get(B.action);return g.Q(K,vIv(L,B,A),9);case 9:r=v.next();K.G1(8);break;case 10:eGc(L.W,f);case 5:g.tj(K);L.T=void 0;g.PK(K,6);break;case 4:return S=g.y7(K),Uj("Orchestration error",S),g.XK(K,12),g.Q(K,r7O(L,I),14);case 14:g.TM(K,5);break;case 12:Z=g.y7(K);Uj("Orchestration retry error",Z);M=g.n(I);for(m=M.next();!m.done;m=M.next())T=m.value,T.retryScheduleIndex<3&&UYO(L.W,[T]);K.G1(5);break;case 6:return g.Q(K,dYC(L),
0)}})},vIv=function(L,W,f){var I,U,e,b,E,d,v,r,B,A,S,Z;
return g.t(function(M){switch(M.W){case 1:I=W.retryScheduleIndex+2===3;if(f.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){M.G1(2);break}if(f.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){M.G1(0);break}fYO(W,f,I);if(f.W&&W.retryScheduleIndex+1<3)return g.Q(M,r7O(L,[W]),0);e=((U=f)==null?0:U.K)?f.K:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";b={entityKey:W.action.entityKey,failureReason:e};E=void 0;g.X8(L.kp)?E="mainVideoDownloadStateEntity":g.PQ(L.kp)&&(E="musicTrackDownloadMetadataEntity");
if(!E||!f.downloadState){M.G1(7);break}d=g.xB(W.action.entityKey).entityId;return g.Q(M,AD(d,E,L.K,f.downloadState),7);case 7:oo(L.V,b);if(f.downloadState==="DOWNLOAD_STATE_FAILED"&&L.kp.Z("html5_auto_retry_failed_pde_actions")){M.G1(0);break}Uj("Orchestration result is not retryable, deleting action");return g.Q(M,HeL(L.K,Mj(W).key),0);case 2:v=void 0;try{v=(r=f.T)==null?void 0:r.map(function(m){return L.createAction(m,W)})}catch(m){return fYO(W,f,I),B={entityKey:W.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},oo(L.V,B),Uj("Orchestration subactions creation error",m),M.return()}fYO(W,f,I,v);if(!v){M.G1(12);break}A=v.map(function(m){return Mj(m)});
S=0;case 13:if(!(S<v.length)||L.G){M.G1(15);break}return g.Q(M,HF(L.K,{mode:"readwrite",Jg:!0},function(m){var T=[];T.push(pI5(m,A.slice(S,S+10),"offlineOrchestrationActionWrapperEntity"));return g.w5.all(T)}),16);
case 16:S+=10;M.G1(13);break;case 15:if(L.G)return L.G=!1,M.return();case 12:return Z=Mj(W),g.Q(M,HeL(L.K,Z.key),17);case 17:$YW(W,4),g.n0(M)}})},ZjO=function(L,W){var f,I,U,e,b,E,d,v,r,B,A,S;
return g.t(function(Z){f=[];I=Infinity;U=4E3;e=g.n(W);for(b=e.next();!b.done;b=e.next())E=b.value,d=Number(E.enqueueTimeSec),v=BmW(d),r=E.retryScheduleIndex,B=r!=null&&r>0,v>0&&B?(I=Math.min(I,d),U=Math.min(v,U)):f.push(E);isFinite(I)&&(!L.N.isActive()||I<L.U)&&(L.U=I,L.N.start(U));L.J.Ou()||(A=f.length,f=f.filter(function(M){var m;M=((m=M.actionProto)==null?void 0:m.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!A7c.includes(M)}),S=f.length<A,!L.N.isActive()&&S&&L.N.start(1));
f.length>0&&S4n(L,f);return g.Q(Z,hGi(L),0)})},wCG=function(L){var W,f,I,U,e,b,E;
return g.t(function(d){if(d.W==1)return g.Q(d,DYt(L),2);W=d.K;f=[];I=g.n(W);for(U=I.next();!U.done;U=I.next())e=U.value,b=g.xB(e.key),E=b.entityId,oIc(L.W,E)||f.push(e);return g.Q(d,ZjO(L,f),0)})},BmW=function(L){L=L*1E3-Date.now();
return L>4E3?4E3:L},r7O=function(L,W){var f,I,U;
return g.t(function(e){f=g.n(W);for(I=f.next();!I.done;I=f.next()){U=I.value;var b=void 0,E=void 0,d=((E=U.action)==null?void 0:(b=E.actionMetadata)==null?void 0:b.retryScheduleIntervalsInSeconds)||[1,2,4];b=1;U.retryScheduleIndex<d.length&&(b=d[U.retryScheduleIndex]);U.W=b*1E3+Date.now();U.retryScheduleIndex++}return g.Q(e,zGA(L,W),0)})},bjt=function(L){var W;
return g.t(function(f){if(f.W==1)return g.Q(f,Lt(L.K,"offlineOrchestrationActionWrapperEntity"),2);W=f.K;return g.Q(f,ZjO(L,W),0)})},S4n=function(L,W){W.length!==0&&W.forEach(function(f){f=zI(f);
f.retryScheduleIndex<3&&UYO(L.W,[f])})},DYt=function(L,W){var f;
return g.t(function(I){if(I.W==1)return g.Q(I,Lt(L.K,"offlineOrchestrationActionWrapperEntity",W),2);f=I.K;return I.return(f.filter(IBX))})},zGA=function(L,W){if(W.length===0)return Promise.resolve([]);
W=W.map(function(f){return Mj(f)});
return kDX(L.K,W)},MUX=function(L){this.Ih=L;
this.W=void 0},nIL=function(L,W){var f,I,U,e;
return g.t(function(b){f=W.videoId;I=!0;if(W.captionTracks.length)U=jsA(W),L.W=new g.yv(L.Ih,W,U);else if(W.fM)e=g.oyK(W),L.W=new g.Qv(L.Ih,W.fM,f,e,W.zk,W.eventId),I=W.zk;else return b.return();return b.return(new Promise(function(E){var d;(d=L.W)==null||d.yN({L5:function(){return g.t(function(v){if(v.W==1)return g.Q(v,L.L5(f,I),2);E();g.n0(v)})},
Hq:function(){}})}))})},XCc=function(L){var W;
return g.t(function(f){if(f.W==1)return g.Q(f,hk5(L),2);W=f.K;return f.return(!!W&&W.length>0)})},Ro=function(L){g.a.call(this);
this.W=L;this.K=this.W.observe(this.N.bind(this))},VUc=function(L,W){var f,I,U,e,b,E,d;
return g.t(function(v){switch(v.W){case 1:if(W.length===0)return v.return([]);f=W.map(function(r){return g.kB(r,"transfer")});
return g.Q(v,Lt(L.W,"transfer",f),2);case 2:I=v.K;U=I.filter(IBX).map(function(r){return g.xB(r.key).entityId});
e=W.filter(function(r){return U.indexOf(r)===-1});
if(e.length===0)return v.return([]);b=g.n(e);E=b.next();case 3:if(E.done){v.G1(5);break}d=E.value;return g.Q(v,RjL(d),4);case 4:E=b.next();v.G1(3);break;case 5:return v.return(e)}})},KKQ=function(L,W,f,I,U,e){var b,E,d;
return g.t(function(v){b="STREAM_TYPE_UNKNOWN";f.video&&f.audio?(b="STREAM_TYPE_AUDIO_AND_VIDEO",Uj("unexpected stream type")):f.video&&!f.audio?b="STREAM_TYPE_VIDEO":!f.video&&f.audio&&(b="STREAM_TYPE_AUDIO");E=g.kB(W,"offlineVideoStreams");d={numBytesDownloaded:U.toFixed(),numTotalBytes:e.toFixed(),streamType:b,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(I),itag:b==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(f.itag):void 0};return g.Q(v,HF(L,{mode:"readwrite",Jg:!0},
function(r){var B=Go(r,E,"offlineVideoStreams"),A=Go(r,g.kB(W,"transfer"),"transfer");return g.w5.all([B,A]).then(function(S){S=g.n(S);var Z=S.next().value;S=S.next().value;if(!S)return iv(r,E).then(function(){});
var M=mYi(Z);Z=uoA(Z,I,d,E);var m=qt(r,Z,"offlineVideoStreams");mYi(Z)>M&&(S.lastProgressTimeMs=Date.now().toString());M=[m];S.offlineVideoStreams||(S.offlineVideoStreams=[]);S.offlineVideoStreams.indexOf(E)===-1&&(S.offlineVideoStreams.push(E),M.push(qt(r,S,"transfer")));return g.w5.all(M)})}),0)})},Tmt=function(L,W){var f,I,U,e,b;
return g.t(function(E){if(E.W==1)return f=g.kB(W,"offlineVideoStreams"),g.Q(E,Ok(L,f,"offlineVideoStreams"),2);I=E.K;if(!I||!I.streamsProgress)return E.return();U=g.n(I.streamsProgress);for(e=U.next();!e.done;e=U.next())b=e.value,b.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",b.numTotalBytes!==b.numBytesDownloaded&&(b.numBytesDownloaded=b.numTotalBytes);return g.Q(E,lv(L,I,"offlineVideoStreams"),0)})},uoA=function(L,W,f,I){if(L&&L.streamsProgress){I=L;
a:{W=W.itag+";"+W.xtags;for(var U=L.streamsProgress,e=0;e<U.length;e++){var b=JSON.parse(U[e].formatStreamBytes);if(b.itag+";"+b.xtags===W){U[e]=f;f=U;break a}}U.push(f);f=U}I.streamsProgress=f}else L={key:I,streamsProgress:[f]};return L},mYi=function(L){if(L==null?0:L.streamsProgress){var W=0;
L=L.streamsProgress;for(var f=0;f<L.length;f++){var I=L[f];isNaN(Number(I.numBytesDownloaded))?Uj("stream progress bytes number invalid"):W+=Number(I.numBytesDownloaded)}return W}return 0},y7G=function(L,W,f,I){g.a.call(this);
var U=this;this.K=L;this.api=W;this.Vs=f;this.qV=I;this.J=new g.R_;this.T=new g.sn(function(){U.W&&U.W.transferState==="TRANSFER_STATE_TRANSFERRING"&&U.J.Ou()&&((U.W.transferRetryCount||0)<3?Ct(U.V,U.G,!1,!1):ao(U.V,U.G.videoDetails.videoId),U.Ep("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.Kl=this.Yp=0;this.X=this.U=!1;this.oh=g.$M(this.api.B().experiments,"html5_transfer_processing_logs_interval");this.Hd=new g.XF(this);this.Kw={A0s:function(){return U.T},
y0P:function(){return U.qV},
t6:function(){return U.J}};
this.Rh=this.K.observe(this.tW.bind(this));this.V=new pjA(W,this);this.Cl=new MUX(W);this.ys=new Ro(this.K);this.g6=this.J.listen("publicytnetworkstatus-online",this.YM.bind(this));this.FP=this.J.listen("publicytnetworkstatus-offline",this.PXH.bind(this));this.X=this.api.B().Z("html5_less_transfer_processing_logs");g.C(this,this.Hd);this.Hd.D(W,"offlinetransferpause",this.Yvl);if(g.X8(this.api.B()))this.N="mainVideoDownloadStateEntity";else if(g.PQ(this.api.B())||g.mJ(this.api.B()))this.N="musicTrackDownloadMetadataEntity"},
gI5=function(L){return g.t(function(W){if(W.W==1)W=g.Q(W,oFA(),2);
else{var f=L.ys;var I=g.fF();I=Object.keys(I);f=VUc(f,I);W=g.Q(W,f,0)}return W})},GI=function(L,W){W=W===void 0?!1:W;
var f;return g.t(function(I){if(I.W==1){if(L.W)throw Error("Already downloading a video");L.Kl=0;L.U=!1;return g.Q(I,Q0c(L),2)}return I.W!=4?(f=I.K,jHG(L.Vs,!f),f&&L.J.Ou()?W?g.Q(I,new Promise(function(U){g.rG(U,1E3)}),4):I.G1(4):(!f&&L.W&&Nj(L),I.G1(0))):g.Q(I,j0c(L,f),0)})},tUO=function(L){return g.t(function(W){if(W.W==1)return L.G?g.Q(W,ao(L.V,L.G.videoDetails.videoId),3):W.G1(0);
Nj(L);g.n0(W)})},PK5=function(L,W){var f,I,U;
return g.t(function(e){switch(e.W){case 1:return g.XK(e,2),(f=!!W.captionTracks.length||!!W.fM)?g.Q(e,XCc(W.videoId),4):e.return();case 4:return(I=e.K)?e.return():g.Q(e,nIL(L.Cl,W),5);case 5:g.TM(e,0);break;case 2:U=g.y7(e),Uj("Caption downloading error",U,W.cotn),g.n0(e)}})},j0c=function(L,W){var f,I,U,e,b,E;
return g.t(function(d){switch(d.W){case 1:if(L.U)return d.return();L.U=!0;L.W=W;f=g.xB(L.W.key);I=f.entityId;U=void 0;if(L.W.transferState==="TRANSFER_STATE_TRANSFERRING")return g.Q(d,co(L,I),7);if(L.W.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||L.W.transferRetryCount||L.W.hasLoggedFirstStarted){d.G1(3);break}return g.Q(d,co(L,I),5);case 5:return U=d.K,L.W.hasLoggedFirstStarted=!0,g.Q(d,J7X(L),6);case 6:P$n({videoId:I,Xj:L.W,offlineModeType:U},void 0,void 0,!0);d.G1(3);break;case 7:U=d.K,
Ej({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:I,Xj:L.W,offlineModeType:U});case 3:return g.Q(d,Y4n(L),8);case 8:return e=null,g.XK(d,9),g.Q(d,FKn(L,W),11);case 11:e=d.K;L.G=e;g.TM(d,10);break;case 9:return b=g.y7(d),Uj("error getting player response",b,W.cotn),g.Q(d,L.Ep("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return d.return();case 10:return E=RkA(L.api.B(),W.cotn,e),g.Q(d,PK5(L,E),13);case 13:return g.Q(d,NWO(E.videoId),
14);case 14:E.L4=d.K,qFX(L.V,E,W.maximumDownloadQuality),L.T.start(108E5),g.n0(d)}})},Q0c=function(L){var W,f;
return g.t(function(I){if(I.W==1)return g.Q(I,Lt(L.K,"transfer"),2);W=I.K;f=W.filter(aYc).sort(CKL);return f.length===0?I.return():I.return(f[0])})},Y4n=function(L){var W,f,I;
return g.t(function(U){if(U.W==1){if(!L.W)return sj(L,"onTransferStart"),U.return();L.T.start(108E5);return g.Q(U,qj(L,"TRANSFER_STATE_TRANSFERRING"),2)}W=L.W;return(I=((f=W)==null?0:f.key)?g.xB(W.key).entityId:"")&&L.N?g.Q(U,AD(I,L.N,L.K,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):U.G1(0)})},cIW=function(L){var W,f,I,U;
g.t(function(e){switch(e.W){case 1:if(!L.W){sj(L,"onTransferPausedByUser");e.G1(2);break}W=L.W;L.T.stop();return g.Q(e,qj(L,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:I=((f=W)==null?0:f.key)?g.xB(W.key).entityId:"";if(!I||!L.N){e.G1(4);break}return g.Q(e,AD(I,L.N,L.K,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.Q(e,co(L,I),6);case 6:U=e.K,YnC({videoId:I,Xj:W,offlineModeType:U});case 2:Nj(L),GI(L),g.n0(e)}})},sAD=function(L){var W,f,I;
g.t(function(U){if(U.W==1){if(!L.W)return sj(L,"onTransferPausedByNetwork"),U.return();L.T.stop();return g.Q(U,qj(L,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(U.W!=3)return W=L.W,(I=((f=W)==null?0:f.key)?g.xB(W.key).entityId:"")&&L.N?g.Q(U,AD(I,L.N,L.K,"DOWNLOAD_STATE_PAUSED"),3):U.G1(3);Nj(L);g.n0(U)})},pCv=function(L){var W,f,I,U,e;
g.t(function(b){switch(b.W){case 1:if(!L.W)return sj(L,"onTransferComplete"),b.return();W=L.W;L.T.stop();if(!W||!L.G){b.G1(2);break}f=RkA(L.api.B(),W.cotn,L.G);return g.Q(b,PK5(L,f),2);case 2:return g.Q(b,qj(L,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:U=((I=W)==null?0:I.key)?g.xB(W.key).entityId:"";if(!U||!L.N){b.G1(5);break}return g.Q(b,AD(U,L.N,L.K,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.Q(b,Tmt(L.K,U),7);case 7:return g.Q(b,co(L,U),8);case 8:e=b.K,Ej({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:U,Xj:W,offlineModeType:e}),Nj(L),GI(L),g.n0(b)}})},RGL=function(L,W,f){var I,U;
g.t(function(e){switch(e.W){case 1:if(!L.W)return sj(L,"onTransferProgress: "+W),e.return();if(L.W.transferState==="TRANSFER_STATE_TRANSFERRING"){e.G1(2);break}return g.Q(e,Y4n(L),2);case 2:I=Date.now();if(!(I-L.Yp>1E3)){e.G1(4);break}L.Yp=I;return g.Q(e,KKQ(L.K,f.videoId,f.K,f.Fx,f.bytesDownloaded,f.W),5);case 5:if(L.X&&!(L.X&&I-L.Kl>L.oh)){e.G1(4);break}L.Kl=I;return g.Q(e,co(L,W),7);case 7:U=e.K,P$n({videoId:W,Xj:L.W,offlineModeType:U},f.bytesDownloaded,f.W);case 4:L.T.start(108E5),g.n0(e)}})},
NmQ=function(L){var W=(L.W.transferRetryCount||0)<3;
W&&(L=L.W,L.transferRetryCount=(L.transferRetryCount||0)+1);return W},GdA=function(L,W){W=W===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":W;
var f,I,U,e;return g.t(function(b){if(b.W==1)return L.W||sj(L,"setTransferToFailed: "+W),f="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",W==="TRANSFER_FAILURE_REASON_NETWORK"?f="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":W==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(f="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.Q(b,qj(L,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",W),2);if(b.W!=3)return oo(L.qV,{entityKey:(I=L.W)==null?void 0:I.key,failureReason:f}),
U=L.W?g.xB(L.W.key).entityId:"",g.Q(b,co(L,U),3);e=b.K;var E={videoId:U,Xj:L.W,offlineModeType:e},d=W,v={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};d&&(v.transferFailureReason=d,v.failureReason=FZD(d));Ej(v,E);g.n0(b)})},qj=function(L,W,f,I){var U;
return g.t(function(e){if(e.W==1){if(!L.W)return sj(L,"saveTransferState: "+W),e.return();L.W.transferState=W;L.W.failureReason=I;g.XK(e,2);return g.Q(e,J7X(L,function(b){return f?cF(b,"offlineVideoStreams",L.W.offlineVideoStreams).then(function(E){for(var d=g.n(E),v=d.next();!v.done;v=d.next())if((v=v.value)&&v.streamsProgress){v=g.n(v.streamsProgress);for(var r=v.next();!r.done;r=v.next())r.value.streamState=f}return pI5(b,E.filter(function(B){return!!B}),"offlineVideoStreams")}):g.w5.resolve(void 0)}),
4)}if(e.W!=2)return g.TM(e,0);
U=g.y7(e);return U instanceof g.vm&&U.type==="QUOTA_EXCEEDED"?g.Q(e,L.Ep("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):e.G1(0)})},J7X=function(L,W){var f;
return g.t(function(I){if(!L.W)return I.return();f=L.W;return g.Q(I,HF(L.K,{mode:"readwrite",Jg:!0},function(U){var e=[qt(U,f,"transfer")];W&&e.push(W(U));return g.w5.all(e)}),0)})},Nj=function(L){L.W=void 0;
L.G=void 0;L.T.stop()},FKn=function(L,W){var f,I,U,e,b;
return g.t(function(E){if(E.W==1)return f=g.xB(W.key),I=f.entityId,U=g.kB(I,"playbackData"),g.Q(E,Ok(L.K,U,"playbackData"),2);e=E.K;if((b=e)==null?0:b.playerResponseJson)return E.return(JSON.parse(e.playerResponseJson));throw Error("No PlayerResponse found");})},sj=function(L,W){L.api.mw("woffle",{mcte:W});
Uj("missing current transfer entity.")},co=function(L,W){var f,I,U;
return g.t(function(e){if(e.W==1)return g.Q(e,Ok(L.K,g.kB(W,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);f=e.K;return e.return((U=(I=f)==null?void 0:I.offlineModeType)!=null?U:void 0)})},aYc=function(L){return c7t[L.transferState]!==void 0},CKL=function(L,W){var f=c7t[L.transferState],I=c7t[W.transferState];
return f!==I?f-I:Number(L.enqueuedTimestampMs)-Number(W.enqueuedTimestampMs)},iO=function(L,W){var f=this;
this.kp=L;this.api=W;this.J=new g.R_;this.G=new g.vI;this.Kw={QE:function(){return f.N.Kw.QE()},
t6:function(){return f.J},
O4h:function(){return f.N},
XL:function(){return f.XL()},
Y1:function(){return f.Y1()},
Mp:function(){return f.Mp()},
FU:function(){return f.FU()},
cJ:function(){return f.cJ()},
Y9:function(I){return f.Y9(I)}};
this.N=new TZW(function(){return s0t(f)},function(){f.Mp()},this.api.H5(),this.api.Z.bind(this.api));
this.W=new eX(this.api);y0O(this.N)},s0t=function(L){return g.t(function(W){L.api.xp("onOrchestrationBecameLeader");
return g.Q(W,L.Y1(),0)})},ijn=function(L){var W,f;
return g.t(function(I){if(I.W==1)return g.Q(I,Wo(),2);if(I.W!=3){W=I.K;if(!W)return Uj("PES is undefined"),I.return();L.K=new y7G(W,L.api,L.N,L.W);f=L.tZ(W);return g.Q(I,EIi(W,f,L.N,L.W,L.kp),3)}L.V=I.K;return g.Q(I,q4t(L),0)})},q4t=function(L){var W;
return g.t(function(f){switch(f.W){case 1:if(!L.K)return Uj("transferManager is undefined"),f.return();if(L.K.W){f.G1(2);break}return g.Q(f,GI(L.K),2);case 2:if(!L.kp.Z("woffle_enable_main_downloads_library")){f.G1(4);break}return g.Q(f,L.H4(),4);case 4:if(!L.kp.Z("html5_offline_playback_position_sync")){f.G1(6);break}return g.Q(f,L.L1(),7);case 7:return g.Q(f,L.Y9(864E5),6);case 6:return g.Q(f,L.refreshAllStaleEntities(43200,!0),9);case 9:return g.Q(f,L.cA(),10);case 10:if(!L.kp.Z("html5_retry_downloads_for_expiration")){f.G1(11);
break}return g.Q(f,L.cJ(),11);case 11:return L.U=g.BR(function(){L.refreshAllStaleEntities(43200,!0);L.cA()},9E5),g.ij(g.kY(),function(){return L.FU()}),g.Q(f,Wo(),13);
case 13:return W=f.K,g.Q(f,KZi(W),14);case 14:gFD(L.N),g.n0(f)}})},xYv=function(){var L,W,f,I,U,e;
return g.t(function(b){switch(b.W){case 1:return g.Q(b,Wo(),2);case 2:L=b.K;if(!L)return b.return([]);W=Date.now()/1E3;return g.Q(b,Lt(L,"offlineVideoPolicy"),3);case 3:f=b.K,I=g.n(f),U=I.next();case 4:if(U.done){b.G1(6);break}e=U.value;if(!(e.expirationTimestamp&&Number(e.expirationTimestamp)<W)){b.G1(5);break}e.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";e.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.Q(b,lv(L,e,"offlineVideoPolicy"),5);
case 5:U=I.next();b.G1(4);break;case 6:return b.return(f.map(function(E){return E.key}))}})},x0=function(L,W,f,I,U){var e,b,E;
return g.t(function(d){if(d.W==1)return g.Q(d,Wo(),2);e=d.K;if(!e)return d.return([]);b=W.map(function(v){var r=g.kB(v,f);r={actionType:I,entityKey:r,actionMetadata:Object.assign({},NZG(),U)};I!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(r.actionMetadata.priority=0);v=new w_(f,v,r);return Mj(v)});
E=kDX(e,b);y0O(L.N);return d.return(E)})},kdL=function(L,W,f,I){var U,e,b,E,d,v,r,B;
return g.t(function(A){switch(A.W){case 1:U=[],e=g.n(W),b=e.next();case 2:if(b.done){A.G1(4);break}E=b.value;if(E.upToDate||f&&!E.shouldAutoSyncMetadata||!E.playlistId){A.G1(3);break}d={};switch(I){case "mainPlaylistEntity":v={nextAutoRefreshIntervalSeconds:E.checkInSeconds,autoSync:f};d={mainPlaylistEntityActionMetadata:v};break;case "musicPlaylist":r={autoSync:f},d={musicPlaylistEntityActionMetadata:r}}return g.Q(A,x0(L,[E.playlistId],I,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",d),6);case 6:(B=
A.K)&&U.push.apply(U,g.Aj(B));case 3:b=e.next();A.G1(2);break;case 4:return A.return(U)}})},HjG=function(L,W){var f;
return g.t(function(I){return W.length?(f=NZG(),g.Pd(f,Y0,{isEnqueuedForExpiredStreamUrlRefetch:!0}),L.api.mw("qrd",{v:W.length}),I.return(x0(L,W,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",f))):I.return([])})},lYO=function(L,W,f){this.W=L;
this.kp=W;this.N=f},W9A=function(L,W){var f,I,U,e,b,E,d,v,r,B,A,S,Z,M,m,T,K;
return g.t(function(P){switch(P.W){case 1:return f=d_(W),I=g.xB(W.entityKey),U=I.entityId,e=[],g.XK(P,2),g.Q(P,OjG(L,U),4);case 4:e=P.K;if(!(L.kp.Z("woffle_enable_main_downloads_library")&&((b=e)==null?0:b.length))){P.G1(5);break}return g.Q(P,$mD(L.W,[W.entityKey]),5);case 5:g.TM(P,3);break;case 2:return E=g.y7(P),d="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",v="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",E instanceof g.vm&&E.type==="QUOTA_EXCEEDED"?(d="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
v="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):Uj("Playlist add error"),P.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,d,v));case 3:r=[];if(!L.kp.Z("html5_offline_prevent_redownload_downloaded_video")){P.G1(7);break}return g.Q(P,pHt(L.W,"mainVideoEntity",e),8);case 8:e=P.K;case 7:if((B=e)==null?0:B.length)for(A=g.n(e),S=A.next();!S.done;S=A.next())if(Z=S.value,M=Z.offlineVideoData,m=void 0,(m=M)==null?0:m.videoId)T=void 0,K=Number(((T=W.actionMetadata)==null?void 0:T.priority)||
0)+1,r.push(Po("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",M.videoId,"mainVideoEntity",K,k0,L9c(W,M,U)));return P.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f,r))}})},fqi=function(L,W){var f,I,U,e,b,E,d,v,r,B,A,S,Z,M,m,T,K,P,F,p,H,q,hj,Ey,IR,rF,$r,gF,xr,vA,Ei,qz,jx,eA,Y5,Gv,o6,y,QN,mc,f0,uc,X,WK,KC,i8,CQ,ip,WA,fb,No,V,z,u,J,c,bp,N,O,Y,up,ZD,oR,on,RR,md,Ly,VW,FO,K0,Xv,Q7,tG,KQ;
return g.t(function(b8){switch(b8.W){case 1:return f=d_(W),I=W.entityKey,U=g.xB(I).entityId,e=[],b=!1,U==="!*$_ALL_ENTITIES_!*$"?(b=!0,g.Q(b8,Lt(L.W,"mainPlaylistEntity"),5)):g.Q(b8,Ok(L.W,I,"mainPlaylistEntity"),4);case 4:(E=b8.K)&&e.push(E);b8.G1(3);break;case 5:e=b8.K;case 3:if((d=e)==null||!d.length)return b8.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f));v=g.R(W.actionMetadata,$RG);B=(r=v)==null?void 0:r.nextAutoRefreshIntervalSeconds;S=(A=v)==null?void 0:A.autoSync;Z=[];m=M=
!0;T=!1;if(!b&&S===!1){b8.G1(6);break}g.XK(b8,7);return g.Q(b8,SFD(0,!!S,!0,e),9);case 9:Z=b8.K;g.TM(b8,8);break;case 7:K=g.y7(b8);if(!(K instanceof Error&&K.message==="No data")){K instanceof Error&&K.message==="Empty response body"&&Uj(K.message);b8.G1(8);break}return U==="!*$_ALL_ENTITIES_!*$"?g.Q(b8,khc(L.W,W,L.N,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.Q(b8,iNc(U,L.W,W,L.N),8);case 8:if(!Z.length||!b&&Z[0].playlistId!==U)return b8.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
f));case 6:if(b){P=[];F=g.n(Z);for(p=F.next();!p.done;p=F.next())H=p.value,H.upToDate||S&&!H.shouldAutoSyncMetadata||!H.playlistId||(q={nextAutoRefreshIntervalSeconds:H.checkInSeconds,autoSync:S},P.push(Po("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",H.playlistId,"mainPlaylistEntity",0,k0,{mainPlaylistEntityActionMetadata:q})));return b8.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f,P))}Z.length&&(hj=Z[0],T=!!hj.upToDate,S&&(M=(Ey=hj.shouldAutoSyncMetadata)!=null?Ey:!0,m=(IR=hj.shouldAutoSyncVideos)!=
null?IR:!0,hj.checkInSeconds&&(B=hj.checkInSeconds)));if(T||!M)return b8.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f));rF=[];$r=e[0];if(!$r.downloadState){gF=void 0;b8.G1(15);break}return g.Q(b8,Ok(L.W,$r.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:gF=b8.K;case 15:return xr=gF,Ei=((vA=xr)==null?0:vA.addedTimestampMillis)?String(xr.addedTimestampMillis):void 0,g.XK(b8,17),g.Q(b8,OjG(L,U,Ei,B),19);case 19:rF=b8.K;g.TM(b8,18);break;case 17:qz=g.y7(b8);if(!(qz instanceof
Error&&qz.message==="No data for playlist")){if(qz instanceof Error&&qz.message==="Empty response body for playlist")Uj(qz.message);else return jx="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",eA="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",qz instanceof g.vm&&qz.type==="QUOTA_EXCEEDED"&&(jx="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",eA="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),b8.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,jx,eA));
b8.G1(18);break}return g.Q(b8,iNc(U,L.W,W,L.N),18);case 18:if(!m)return b8.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f));Y5=[];Gv=new Map;if((o6=rF)==null?0:o6.length)for(y=g.n(rF),QN=y.next();!QN.done;QN=y.next())mc=QN.value,f0=mc.offlineVideoData,uc=void 0,((uc=f0)==null?0:uc.videoId)&&Gv.set(f0.videoId,f0);X=new Map;WK=[];if((KC=$r)==null?0:(i8=KC.videos)==null?0:i8.length)for(CQ=g.n($r.videos),ip=CQ.next();!ip.done;ip=CQ.next())if(WA=ip.value,fb=JSON.parse(g.xB(WA).entityId),
No=fb.videoId)Gv.has(No)?(X.set(No,Gv.get(No)),Gv.delete(No)):WK.push(No);z=Number(((V=W.actionMetadata)==null?void 0:V.priority)||0)+1;u=g.n(Gv.entries());for(J=u.next();!J.done;J=u.next())c=J.value,bp=g.n(c),N=bp.next().value,O=bp.next().value,Y=N,up=O,Y5.push(Po("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Y,"mainVideoEntity",z,k0,L9c(W,up,U)));ZD=g.n(X.entries());for(oR=ZD.next();!oR.done;oR=ZD.next())on=oR.value,RR=g.n(on),md=RR.next().value,Ly=RR.next().value,VW=md,FO=Ly,Y5.push(Po("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
VW,"mainVideoEntity",z,k0,L9c(W,FO,U)));K0=g.n(WK);for(Xv=K0.next();!Xv.done;Xv=K0.next())Q7=Xv.value,tG={playlistId:U},KQ={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:tG},Y5.push(Po("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Q7,"mainVideoEntity",0,k0,KQ));return b8.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f,Y5))}})},IqW=function(L,W){var f,I,U,e;
return g.t(function(b){switch(b.W){case 1:return f=d_(W),g.XK(b,2),I=g.xB(W.entityKey).entityId,I==="!*$_ALL_ENTITIES_!*$"?g.Q(b,khc(L.W,W,L.N,(U=W.actionMetadata)==null?void 0:(e=U.offlineLoggingData)==null?void 0:e.offlineDeleteReason),5):g.Q(b,iNc(I,L.W,W,L.N),6);case 6:if(!L.kp.Z("woffle_enable_main_downloads_library")){b.G1(5);break}return g.Q(b,fpG(L.W,W.entityKey),5);case 5:g.TM(b,3);break;case 2:return g.y7(b),b.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return b.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f))}})},OjG=function(L,W,f,I){var U,e,b,E,d,v,r;
return g.t(function(B){switch(B.W){case 1:return g.Q(B,BWW([W]),2);case 2:return U=B.K,g.Q(B,URA(L,U[0],f,I),3);case 3:return e=B.K,b=e.mainPlaylistEntity,E=e.Svd,v=sHO(b,(d=E)==null?void 0:d.avatar),g.XK(B,4),g.Q(B,XJ(v),6);case 6:g.TM(B,5);break;case 4:r=g.y7(B),r instanceof Error&&r.message==="Failed to fetch"&&Uj(r.message);case 5:return B.return(U[0].videos)}})},URA=function(L,W,f,I){var U,e,b,E,d,v,r,B,A,S,Z,M,m,T,K,P,F;
return g.t(function(p){switch(p.W){case 1:U=Date.now().toString();f||(f=U);e=W.videos;b=W.playlistId;E=[];d=[];if(e)for(v=g.n(e),r=v.next();!r.done;r=v.next()){B=r.value;A=B.offlineVideoData;if(!A||!A.videoId)throw Uj("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");S=A.videoId;Z={videoId:S,playlistId:b};M={id:g.kB(JSON.stringify(Z),"mainPlaylistVideoEntity"),video:g.kB(S,"mainVideoEntity")};E.push(M);d.push(M.id)}T={key:g.kB(b,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:f,lastSyncedTimestampMillis:U};K={key:g.kB(b,"mainPlaylistEntity"),playlistId:b,videos:d,title:W.title,thumbnailStyleData:ecW(W),visibility:o9W(W),downloadState:T.key};W.channel&&(P=W.channel.offlineChannelData,m=b$n(g.kB(b,"ytMainChannelEntity"),P),K.channelOwner=m.id);((F=K)==null?0:F.entityMetadata)?(K.entityMetadata.offlineLastModifiedTimestampSeconds=W.lastModifiedTimestamp,I&&(K.entityMetadata.nextAutoRefreshIntervalSeconds=String(I))):K&&(K.entityMetadata={nextAutoRefreshIntervalSeconds:I?
String(I):void 0,offlineLastModifiedTimestampSeconds:W.lastModifiedTimestamp});g.XK(p,2);return g.Q(p,HF(L.W,{mode:"readwrite",Jg:!0},function(H){var q=qt(H,K,"mainPlaylistEntity"),hj=qt(H,T,"mainPlaylistDownloadStateEntity");q=[q,hj];hj=g.n(E);for(var Ey=hj.next();!Ey.done;Ey=hj.next())q.push(qt(H,Ey.value,"mainPlaylistVideoEntity"));m&&q.push(qt(H,m,"ytMainChannelEntity"));return g.w5.all(q)}),4);
case 4:g.TM(p,3);break;case 2:throw g.y7(p),Uj("PES failure for playlist"),Error("PES failure for playlist");case 3:return p.return({mainPlaylistEntity:K,Svd:m,jip:E})}})},b$n=function(L,W){return{id:L,
channelId:W.channelId,title:W.title,avatar:W.thumbnail}},ecW=function(L){var W=[],f=L.videos;
f&&f.length>0&&W.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:f[0].offlineVideoData.thumbnail}}});if((L=L.additionalMetadadatas)&&L.length>0)for(L=g.n(L),f=L.next();!f.done;f=L.next()){var I=f.value.offlineBundleItemPlaylistData,U=void 0;f=(U=I)==null?void 0:U.style;U=void 0;I={collageThumbnail:{coverThumbnail:(U=I)==null?void 0:U.coverThumbnail}};switch(f){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":W.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:I});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":W.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:I});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":W.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:I});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":W.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:I})}}return W},o9W=function(L){switch(L.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},L9c=function(L,W,f){W={offlineVideoData:W,
playlistId:f};if(L=g.R(L.actionMetadata,$RG))W.maximumDownloadQuality=L.maximumDownloadQuality;return{mainVideoEntityActionMetadata:W}},hcv=function(L,W,f){this.W=L;
this.kp=W;this.N=f},v95=function(L,W){var f,I,U,e,b,E,d,v,r,B,A,S,Z;
return g.t(function(M){switch(M.W){case 1:return f=d_(W),I=g.xB(W.entityKey),U=I.entityId,e=g.R(W.actionMetadata,Ho),E=!((b=e)==null?0:b.playlistId),g.XK(M,2),g.Q(M,E9v(L,U,void 0,(d=e)==null?void 0:d.offlineVideoData,E),4);case 4:g.TM(M,3);break;case 2:return v=g.y7(M),r="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",B="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",v instanceof g.vm&&v.type==="QUOTA_EXCEEDED"&&(r="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",B="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
M.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,r,B));case 3:A=1;A=Number(((S=W.actionMetadata)==null?void 0:S.priority)||0)+1;var m=(m=g.R(W.actionMetadata,Ho))?{playbackDataActionMetadata:{maximumDownloadQuality:m.maximumDownloadQuality}}:void 0;Z=Po("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",U,"playbackData",A,dRW,m);return M.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f,[Z]))}})},rbX=function(L,W){var f,I,U,e,b,E,d,v,r,B,A,S,Z,M,m,T,K;
return g.t(function(P){switch(P.W){case 1:return f=d_(W),I=g.xB(W.entityKey),U=I.entityId,g.Q(P,Ok(L.W,W.entityKey,"mainVideoEntity"),2);case 2:e=P.K;if(!e){b=void 0;P.G1(3);break}return g.Q(P,Ok(L.W,e.downloadState,"mainVideoDownloadStateEntity"),4);case 4:b=P.K;case 3:E=b;if(!e||!E)return P.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f));g.XK(P,5);return g.Q(P,E9v(L,U,E.addedTimestampMillis,(v=g.R(W.actionMetadata,Ho))==null?void 0:v.offlineVideoData),7);case 7:r=1;r=Number(((B=
W.actionMetadata)==null?void 0:B.priority)||0)+1;d=Po("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",U,"playbackData",r,dRW);g.TM(P,6);break;case 5:A=g.y7(P);if(!(A instanceof Error&&A.message==="No data")){if(A instanceof Error&&A.message==="Empty response body")Uj(A.message);else return S="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",A instanceof g.vm&&A.type==="QUOTA_EXCEEDED"&&(S="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),P.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,S,Z));P.G1(6);break}return g.Q(P,uO(L.W,U),9);case 9:M=P.K;m=g.R(W.actionMetadata,Ho);if(K=(T=m)==null?void 0:T.playlistId)M.playlistId=K;M.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.Q(P,Vg(U,L.W,W,L.N,M),6);case 6:return P.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f,d?[d]:void 0))}})},BGC=function(L,W){var f,I,U,e,b,E,d,v,r,B;
return g.t(function(A){switch(A.W){case 1:return f=d_(W),g.XK(A,2),I=g.xB(W.entityKey).entityId,I==="!*$_ALL_ENTITIES_!*$"?g.Q(A,khc(L.W,W,L.N,(r=W.actionMetadata)==null?void 0:(B=r.offlineLoggingData)==null?void 0:B.offlineDeleteReason),5):g.Q(A,uO(L.W,I),6);case 6:U=A.K;e=g.R(W.actionMetadata,Ho);if(E=(b=e)==null?void 0:b.playlistId)U.playlistId=E;U.offlineDeleteReason=(d=W.actionMetadata)==null?void 0:(v=d.offlineLoggingData)==null?void 0:v.offlineDeleteReason;return g.Q(A,Vg(I,L.W,W,L.N,U),7);
case 7:if(!L.kp.Z("woffle_enable_main_downloads_library")){A.G1(5);break}return g.Q(A,fpG(L.W,W.entityKey),5);case 5:g.TM(A,3);break;case 2:return g.y7(A),A.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return A.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f))}})},E9v=function(L,W,f,I,U){var e,b,E,d,v,r;
return g.t(function(B){switch(B.W){case 1:if(e=I){B.G1(2);break}return g.Q(B,rID([W]),3);case 3:b=B.K,e=b[0];case 2:return g.Q(B,Abc(L,e,f,U),4);case 4:E=B.K;d=E.mainVideoEntity;v=E.channelEntity;g.XK(B,5);var A=DV(d.thumbnail),S=DV(v.avatar);return g.Q(B,XJ(A.concat(S)),7);case 7:g.TM(B,0);break;case 5:r=g.y7(B),r instanceof Error&&r.message==="Failed to fetch"&&Uj(r.message),g.n0(B)}})},Abc=function(L,W,f,I){var U,e,b,E,d,v,r,B,A,S,Z,M,m;
return g.t(function(T){switch(T.W){case 1:f||(f=Date.now().toString());e=(U=W.channel)==null?void 0:U.offlineChannelData;b={id:g.kB(W.videoId,"ytMainChannelEntity"),channelId:e.channelId,title:e.title,avatar:e.thumbnail};E={key:g.kB(W.videoId,"mainVideoDownloadStateEntity"),playbackData:g.kB(W.videoId,"playbackData"),addedTimestampMillis:f,videoDownloadContextEntity:g.kB(W.videoId,"videoDownloadContextEntity")};d={key:g.kB(W.videoId,"videoPlaybackPositionEntity"),videoId:W.videoId,lastPlaybackPositionSeconds:"0"};
L.kp.Z("html5_offline_playback_position_sync")&&(v={playbackPosition:d.key});r=g.kB(W.videoId,"mainVideoEntity");B={key:r,videoId:W.videoId,title:W.title,thumbnail:W.thumbnail,localizedStrings:{viewCount:W.shortViewCountText},userState:v,lengthSeconds:W.lengthSeconds?Number(W.lengthSeconds):void 0,publishedTimestampMillis:W.publishedTimestamp?(Number(W.publishedTimestamp)*1E3).toString():void 0,formattedDescription:W.description,owner:b.id,downloadState:E.key};if(!L.kp.Z("woffle_enable_main_downloads_library")||
!I){T.G1(2);break}return g.Q(T,WbC(L.W,[r]),3);case 3:if(Z=T.K)A=Z.mainDownloadsLibraryEntity,S=Z.mainDownloadsListEntity;case 2:return m=C$i,M={key:g.kB(W.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.Pd(E,m,M),g.Q(T,HF(L.W,{mode:"readwrite",Jg:!0},function(K){var P=qt(K,b,"ytMainChannelEntity"),F=qt(K,E,"mainVideoDownloadStateEntity"),p=qt(K,B,"mainVideoEntity");P=[P,F,p];L.kp.Z("html5_offline_playback_position_sync")&&(F=qt(K,d,"videoPlaybackPositionEntity"),
P.push(F));A&&(F=qt(K,A,"mainDownloadsLibraryEntity"),P.push(F));S&&(F=qt(K,S,"mainDownloadsListEntity"),P.push(F));M&&(K=qt(K,M,"downloadStatusEntity"),P.push(K));return g.w5.all(P)}),4);
case 4:return T.return({mainVideoEntity:B,channelEntity:b})}})},SLW=function(L,W,f){this.W=L;
this.kp=W;this.N=f},DRA=function(L,W){var f,I,U,e,b,E,d,v,r,B,A,S,Z,M,m,T,K,P,F,p,H,q,hj,Ey,IR,rF,$r;
return g.t(function(gF){switch(gF.W){case 1:return f=d_(W),I=[],g.Q(gF,pK.getInstance(),2);case 2:U=gF.K;if(!U){gF.G1(3);break}return g.Q(gF,U.get("sdois"),4);case 4:return e=gF.K,g.Q(gF,(E=U)==null?void 0:E.get("lmqf"),5);case 5:b=gF.K;case 3:g.XK(gF,6);if(e===void 0)throw Error("prefStorage or opt-in state is undefined");d=[];if(e){gF.G1(8);break}return g.Q(gF,Lbi(L.W),9);case 9:d=gF.K,d.reverse();case 8:if(!d.length){gF.G1(10);break}v=g.n(d);r=v.next();case 11:if(r.done){gF.G1(10);break}B=r.value;
if(!B){gF.G1(12);break}A=g.xB(B).entityId;return g.Q(gF,uO(L.W,A),14);case 14:return S=gF.K,S.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.Q(gF,Vg(A,L.W,{entityKey:B,actionType:W.actionType},L.N,S),12);case 12:r=v.next();gF.G1(11);break;case 10:return g.Q(gF,Dmn(e,(Z=b)!=null?Z:"SD"),16);case 16:return M=gF.K,g.Q(gF,HNA(M),17);case 17:m=ONL(M);if(!L.kp.Z("woffle_enable_main_downloads_library")){gF.G1(18);break}if(e){gF.G1(19);break}return g.Q(gF,fpG(L.W,g.aP),19);case 19:return g.Q(gF,
$mD(L.W,[g.aP]),18);case 18:if((T=m)==null?0:T.length)for(K=g.n(m),P=K.next();!P.done;P=K.next())if(p=F=P.value,H=p.actionType,q=p.entityKey,hj=p.actionMetadata,H&&q&&hj&&!g.R(hj,Z$G)){H==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(hj.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(Ey=g.R(F.actionMetadata,Ho))Ey.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",F.actionMetadata=Object.assign({},F.actionMetadata,{mainVideoEntityActionMetadata:Ey});I.push(F)}g.TM(gF,
7);break;case 6:return IR=g.y7(gF),rF="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",$r="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",IR instanceof g.vm&&IR.type==="QUOTA_EXCEEDED"&&(rF="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",$r="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),gF.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,rF,$r));case 7:return gF.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f,I))}})},wRC=function(){iO.apply(this,
arguments);
this.X="mainVideoEntity"},zcC=function(L,W,f){W=W===void 0?43200:W;
f=f===void 0?!0:f;var I=I===void 0?!1:I;var U,e,b;return g.t(function(E){switch(E.W){case 1:if(!L.J.Ou())return E.return([]);U=[];g.XK(E,2);return g.Q(E,SFD(W,f,I),4);case 4:U=E.K;g.TM(E,3);break;case 2:e=g.y7(E),e instanceof Error&&e.message==="No data"||e instanceof Error&&e.message==="Empty response body"&&Uj(e.message);case 3:return b=kdL(L,U,f,"mainPlaylistEntity"),E.return(b)}})},MiX=function(L,W,f,I){I=I===void 0?!1:I;
var U,e,b,E,d,v,r,B,A,S,Z,M,m,T,K;return g.t(function(P){switch(P.W){case 1:return U=[],g.Q(P,ZZt(),2);case 2:return(e=P.K)||I?g.Q(P,wjC(W,f),3):P.return([]);case 3:b=P.K;if((E=b)==null||!E.length)return P.return([]);d={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};v=g.n(b);r=v.next();case 4:if(r.done){P.G1(6);break}A=B=r.value;S=A.actionType;Z=A.entityKey;M=A.actionMetadata;if(!(S&&Z&&M)||g.R(M,Z$G)){P.G1(5);break}S==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(M.offlineLoggingData=
d);m=g.xB(Z);T=m.entityId;return g.Q(P,x0(L,[T],"mainVideoEntity",S,M),8);case 8:K=P.K,U=U.concat(K);case 5:r=v.next();P.G1(4);break;case 6:return P.return(U)}})},n9i=function(L,W){this.W=L;
this.N=W},Viv=function(L,W){var f,I,U,e,b,E,d,v,r,B,A,S,Z,M,m,T;
return g.t(function(K){switch(K.W){case 1:return f=d_(W),I=g.xB(W.entityKey),U=I.entityId,e=[],g.XK(K,2),g.Q(K,XRc(L,U),4);case 4:e=K.K;if((b=e)==null||!b.length){K.G1(5);break}return g.Q(K,bZi(L.W,W.entityKey),5);case 5:g.TM(K,3);break;case 2:return E=g.y7(K),d="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",v="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",E instanceof g.vm&&E.type==="QUOTA_EXCEEDED"&&(d="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",v="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
K.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,d,v));case 3:return r=[],g.Q(K,pHt(L.W,"musicTrack",e),7);case 7:e=K.K;if(e.length)for(B=g.n(e),A=B.next();!A.done;A=B.next())if(S=A.value,Z=S.offlineVideoData,M=void 0,(M=Z)==null?0:M.videoId)m=void 0,T=Number(((m=W.actionMetadata)==null?void 0:m.priority)||0)+1,r.push(Po("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Z.videoId,"musicTrack",T,lO,g_(W,Z,U)));return K.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f,r))}})},
mRt=function(L,W){var f,I,U,e,b,E,d,v,r,B,A,S,Z,M,m,T,K,P,F,p,H,q,hj,Ey,IR,rF,$r,gF,xr,vA,Ei,qz,jx,eA,Y5,Gv,o6,y,QN,mc,f0,uc,X,WK,KC,i8,CQ,ip,WA,fb,No,V,z,u,J,c,bp,N,O;
return g.t(function(Y){switch(Y.W){case 1:return f=d_(W),I=W.entityKey,U=g.xB(I).entityId,e=[],b=!1,U==="!*$_ALL_ENTITIES_!*$"?(b=!0,g.Q(Y,Lt(L.W,"musicAlbumRelease"),5)):g.Q(Y,Ok(L.W,I,"musicAlbumRelease"),4);case 4:(E=Y.K)&&e.push(E);Y.G1(3);break;case 5:e=Y.K;case 3:if((d=e)==null||!d.length)return Y.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f));if(b){v=[];r=g.n(e);for(B=r.next();!B.done;B=r.next())A=B.value,S=g.xB(A.id).entityId,v.push(Po("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
S,"musicAlbumRelease",0,lO));return Y.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f,v))}Z=[];M=e[0];m=void 0;if(!M.downloadMetadata){Y.G1(6);break}return g.Q(Y,Ok(L.W,M.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:T=Y.K,m=Number((P=(K=T)==null?void 0:K.addedTimestampMillis)!=null?P:"0")/1E3;case 6:return g.XK(Y,8),g.Q(Y,XRc(L,U,(F=m)==null?void 0:F.toString()),10);case 10:Z=Y.K;g.TM(Y,9);break;case 8:p=g.y7(Y);if(!(p instanceof Error&&p.message==="No data")){if(p instanceof
Error&&p.message==="Empty response body")Uj(p.message);else return H="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",q="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",p instanceof g.vm&&p.type==="QUOTA_EXCEEDED"&&(H="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",q="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Y.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,H,q));Y.G1(9);break}return g.Q(Y,TI(U,"musicAlbumRelease",L.W,W,L.N),9);case 9:hj=[];Ey=new Map;
if((IR=Z)==null?0:IR.length)for(rF=g.n(Z),$r=rF.next();!$r.done;$r=rF.next())gF=$r.value,xr=gF.offlineVideoData,vA=void 0,((vA=xr)==null?0:vA.videoId)&&Ey.set(xr.videoId,xr);Ei=new Map;qz=[];if((jx=M)==null?0:(eA=jx.tracks)==null?0:eA.length)for(Y5=g.n(M.tracks),Gv=Y5.next();!Gv.done;Gv=Y5.next())if(o6=Gv.value,y=g.xB(o6).entityId)Ey.has(y)?(Ei.set(y,Ey.get(y)),Ey.delete(y)):qz.push(y);mc=Number(((QN=W.actionMetadata)==null?void 0:QN.priority)||0)+1;f0=g.n(Ey.entries());for(uc=f0.next();!uc.done;uc=
f0.next())X=uc.value,WK=g.n(X),KC=WK.next().value,i8=WK.next().value,CQ=KC,ip=i8,hj.push(Po("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",CQ,"musicTrack",mc,lO,g_(W,ip)));WA=g.n(Ei.entries());for(fb=WA.next();!fb.done;fb=WA.next())No=fb.value,V=g.n(No),z=V.next().value,u=V.next().value,J=z,c=u,hj.push(Po("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",J,"musicTrack",mc,lO,g_(W,c)));bp=g.n(qz);for(N=bp.next();!N.done;N=bp.next())O=N.value,hj.push(Po("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",O,"musicTrack",
0,lO));return Y.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f,hj))}})},udA=function(L,W){var f,I;
return g.t(function(U){switch(U.W){case 1:return f=d_(W),g.XK(U,2),I=g.xB(W.entityKey).entityId,I==="!*$_ALL_ENTITIES_!*$"?g.Q(U,yg(L.W,W,L.N),5):g.Q(U,TI(I,"musicAlbumRelease",L.W,W,L.N),6);case 6:return g.Q(U,hjQ(L.W,W.entityKey),5);case 5:g.TM(U,3);break;case 2:return g.y7(U),U.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return U.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
f))}})},XRc=function(L,W,f){var I,U,e;
return g.t(function(b){switch(b.W){case 1:return g.Q(b,BWW([W]),2);case 2:return I=b.K,g.Q(b,K9t(L,I[0],f),3);case 3:return U=b.K,e=DV(U.thumbnailDetails),g.Q(b,XJ(e),4);case 4:return b.return(I[0].videos)}})},K9t=function(L,W,f){var I,U,e,b,E,d,v,r,B,A,S,Z,M,m;
return g.t(function(T){if(T.W==1){I=W.additionalMetadadatas;U=void 0;if(I&&I.length>0)for(e=g.n(I),b=e.next();!b.done;b=e.next())if(E=b.value,E.offlineMusicPlaylistData){U=E.offlineMusicPlaylistData;break}d=W.playlistId;v=ECc(W);r=v.nk;B=v.SV;A=f?(Number(f)*1E3).toString():Date.now().toString();S=W.lastModifiedTimestamp?(Number(W.lastModifiedTimestamp)*1E3).toString():"0";Z={id:g.kB(d,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:B,lastModifiedTimestampMillis:S,addedTimestampMillis:A,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};M={id:g.kB(d,"musicAlbumRelease"),title:W.title,audioPlaylistId:d,trackCount:W.totalVideoCount,tracks:r,downloadMetadata:Z.id};U&&(M.thumbnailDetails=(m=U.albumHqThumbnail)!=null?m:U.albumArtistThumbnail,M.artistDisplayName=U.albumArtistDisplayName,M.releaseDate=U.albumReleaseDate,M.contentRating={explicitType:U.albumReleaseExplicitType},M.releaseType=U.albumReleaseType);return g.Q(T,HF(L.W,{mode:"readwrite",Jg:!0},function(K){var P=qt(K,M,"musicAlbumRelease");
K=qt(K,Z,"musicAlbumReleaseDownloadMetadataEntity");return g.w5.all([P,K])}),2)}return T.return(M)})},TGO=function(L,W){this.W=L;
this.N=W},g9G=function(L,W){var f,I,U,e,b,E,d,v,r,B,A,S,Z,M,m,T;
return g.t(function(K){switch(K.W){case 1:return f=d_(W),I=g.xB(W.entityKey),U=I.entityId,e=[],g.XK(K,2),g.Q(K,ybi(L,U),4);case 4:e=K.K;if((b=e)==null||!b.length){K.G1(5);break}return g.Q(K,bZi(L.W,W.entityKey),5);case 5:g.TM(K,3);break;case 2:return E=g.y7(K),d="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",v="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",E instanceof g.vm&&E.type==="QUOTA_EXCEEDED"&&(d="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",v="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
K.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,d,v));case 3:return r=[],g.Q(K,pHt(L.W,"musicTrack",e),7);case 7:e=K.K;if(e.length)for(B=g.n(e),A=B.next();!A.done;A=B.next())if(S=A.value,Z=S.offlineVideoData,M=void 0,(M=Z)==null?0:M.videoId)m=void 0,T=Number(((m=W.actionMetadata)==null?void 0:m.priority)||0)+1,r.push(Po("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Z.videoId,"musicTrack",T,Oj,g_(W,Z,U)));return K.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f,r))}})},
Qbi=function(L,W){var f,I,U,e,b,E,d,v,r,B,A,S,Z,M,m,T,K,P,F,p,H,q,hj,Ey,IR,rF,$r,gF,xr,vA,Ei,qz,jx,eA,Y5,Gv,o6,y,QN,mc,f0,uc,X,WK,KC,i8,CQ,ip,WA,fb,No,V,z,u,J,c,bp,N,O,Y,up,ZD,oR,on,RR,md,Ly,VW,FO,K0,Xv;
return g.t(function(Q7){switch(Q7.W){case 1:return f=d_(W),I=W.entityKey,U=g.xB(I).entityId,e=[],b=!1,U==="!*$_ALL_ENTITIES_!*$"?(b=!0,g.Q(Q7,Lt(L.W,"musicPlaylist"),5)):g.Q(Q7,Ok(L.W,I,"musicPlaylist"),4);case 4:(E=Q7.K)&&e.push(E);Q7.G1(3);break;case 5:e=Q7.K;case 3:if((d=e)==null||!d.length)return Q7.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f));v=g.R(W.actionMetadata,dmO);B=(r=v)==null?void 0:r.autoSync;A=[];Z=S=!0;M=!1;m=void 0;if(!b&&B===!1){Q7.G1(6);break}g.XK(Q7,7);return g.Q(Q7,
zjD(0,!!B,!0,e),9);case 9:A=Q7.K;g.TM(Q7,8);break;case 7:T=g.y7(Q7);if(!(T instanceof Error&&T.message==="No data")){T instanceof Error&&T.message==="Empty response body"&&Uj(T.message);Q7.G1(8);break}return U==="!*$_ALL_ENTITIES_!*$"?g.Q(Q7,yg(L.W,W,L.N),8):g.Q(Q7,TI(U,"musicPlaylist",L.W,W,L.N),8);case 8:if(!A.length||!b&&A[0].playlistId!==U)return Q7.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f));case 6:if(b){K=[];P=g.n(A);for(F=P.next();!F.done;F=P.next())p=F.value,p.upToDate||
B&&!p.shouldAutoSyncMetadata||!p.playlistId||(H={autoSync:B},K.push(Po("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",p.playlistId,"musicPlaylist",0,Oj,{musicPlaylistEntityActionMetadata:H})));return Q7.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f,K))}A.length&&(q=A[0],M=!!q.upToDate,B&&(S=(hj=q.shouldAutoSyncMetadata)!=null?hj:!0,Z=(Ey=q.shouldAutoSyncVideos)!=null?Ey:!0,q.checkInSeconds&&(m=q.checkInSeconds)));if(M||!S)return Q7.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
f));IR=[];rF=e[0];$r=void 0;if(!rF.downloadMetadata){Q7.G1(15);break}return g.Q(Q7,Ok(L.W,rF.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:gF=Q7.K,$r=Number((vA=(xr=gF)==null?void 0:xr.addedTimestampMillis)!=null?vA:"0")/1E3;case 15:return g.XK(Q7,17),g.Q(Q7,ybi(L,U,(Ei=$r)==null?void 0:Ei.toString(),m),19);case 19:IR=Q7.K;g.TM(Q7,18);break;case 17:qz=g.y7(Q7);if(!(qz instanceof Error&&qz.message==="No data")){if(qz instanceof Error&&qz.message==="Empty response body")Uj(qz.message);
else return jx="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",eA="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",qz instanceof g.vm&&qz.type==="QUOTA_EXCEEDED"&&(jx="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",eA="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Q7.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,jx,eA));Q7.G1(18);break}return g.Q(Q7,TI(U,"musicPlaylist",L.W,W,L.N),18);case 18:if(!Z)return Q7.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
f));Y5=[];Gv=new Map;if((o6=IR)==null?0:o6.length)for(y=g.n(IR),QN=y.next();!QN.done;QN=y.next())mc=QN.value,f0=mc.offlineVideoData,uc=void 0,((uc=f0)==null?0:uc.videoId)&&Gv.set(f0.videoId,f0);X=new Map;WK=[];if((KC=rF)==null?0:(i8=KC.tracks)==null?0:i8.length)for(CQ=g.n(rF.tracks),ip=CQ.next();!ip.done;ip=CQ.next())if(WA=ip.value,fb=g.xB(WA).entityId)Gv.has(fb)?(X.set(fb,Gv.get(fb)),Gv.delete(fb)):WK.push(fb);V=Number(((No=W.actionMetadata)==null?void 0:No.priority)||0)+1;z=g.n(Gv.entries());for(u=
z.next();!u.done;u=z.next())J=u.value,c=g.n(J),bp=c.next().value,N=c.next().value,O=bp,Y=N,Y5.push(Po("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",O,"musicTrack",V,Oj,g_(W,Y)));up=g.n(X.entries());for(ZD=up.next();!ZD.done;ZD=up.next())oR=ZD.value,on=g.n(oR),RR=on.next().value,md=on.next().value,Ly=RR,VW=md,Y5.push(Po("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Ly,"musicTrack",V,Oj,g_(W,VW)));FO=g.n(WK);for(K0=FO.next();!K0.done;K0=FO.next())Xv=K0.value,Y5.push(Po("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
Xv,"musicTrack",0,Oj));return Q7.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f,Y5))}})},jb5=function(L,W){var f,I;
return g.t(function(U){switch(U.W){case 1:return f=d_(W),g.XK(U,2),I=g.xB(W.entityKey).entityId,I==="!*$_ALL_ENTITIES_!*$"?g.Q(U,yg(L.W,W,L.N),5):g.Q(U,TI(I,"musicPlaylist",L.W,W,L.N),6);case 6:return g.Q(U,hjQ(L.W,W.entityKey),5);case 5:g.TM(U,3);break;case 2:return g.y7(U),U.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return U.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
f))}})},ybi=function(L,W,f,I){var U,e,b;
return g.t(function(E){switch(E.W){case 1:return g.Q(E,BWW([W]),2);case 2:return U=E.K,g.Q(E,tic(L,U[0],f,I),3);case 3:return e=E.K,b=DV(e.thumbnailDetails),g.Q(E,XJ(b),4);case 4:return E.return(U[0].videos)}})},tic=function(L,W,f,I){var U,e,b,E,d,v,r,B,A;
return g.t(function(S){return S.W==1?(U=W.playlistId,e=ECc(W),b=e.nk,E=e.SV,d=f?(Number(f)*1E3).toString():Date.now().toString(),v=W.lastModifiedTimestamp?(Number(W.lastModifiedTimestamp)*1E3).toString():"0",r={id:g.kB(U,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:E,lastModifiedTimestampMillis:v,addedTimestampMillis:d,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},B={id:g.kB(U,"musicPlaylist"),title:W.title,playlistId:U,thumbnailDetails:W.thumbnail,visibility:PrG(W),trackCount:W.totalVideoCount,
tracks:b,downloadMetadata:r.id},I&&(((A=B)==null?0:A.entityMetadata)?B.entityMetadata.nextAutoRefreshIntervalSeconds=String(I):B&&(B.entityMetadata={nextAutoRefreshIntervalSeconds:String(I)})),g.Q(S,HF(L.W,{mode:"readwrite",Jg:!0},function(Z){var M=qt(Z,B,"musicPlaylist");Z=qt(Z,r,"musicPlaylistDownloadMetadataEntity");return g.w5.all([M,Z])}),2)):S.return(B)})},PrG=function(L){switch(L.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},Jbc=function(L,W){this.W=L;
this.N=W},Crv=function(L,W){var f,I,U,e,b,E,d,v,r,B,A,S,Z;
return g.t(function(M){switch(M.W){case 1:return f=d_(W),I=g.xB(W.entityKey),U=I.entityId,e=g.R(W.actionMetadata,YLW),g.XK(M,2),g.Q(M,F9L(L,U,void 0,(b=e)==null?void 0:b.track,(E=e)==null?void 0:E.albumRelease),4);case 4:if((d=e)==null?0:d.playlistId){M.G1(5);break}return g.Q(M,bZi(L.W,W.entityKey),5);case 5:g.TM(M,3);break;case 2:return v=g.y7(M),r="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",B="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",v instanceof g.vm&&v.type==="QUOTA_EXCEEDED"&&
(r="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",B="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),M.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,r,B));case 3:S=Number(((A=W.actionMetadata)==null?void 0:A.priority)||0)+1;var m=(m=g.R(W.actionMetadata,YLW))?{playbackDataActionMetadata:{maximumDownloadQuality:m.maximumDownloadQuality}}:void 0;Z=Po("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",U,"playbackData",S,aq5,m);return M.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
f,[Z]))}})},pRQ=function(L,W){var f,I,U,e,b,E,d,v,r,B,A,S,Z,M,m;
return g.t(function(T){switch(T.W){case 1:return f=d_(W),I=g.xB(W.entityKey),U=I.entityId,g.Q(T,Ok(L.W,W.entityKey,"musicTrack"),2);case 2:e=T.K;if(!e){b=void 0;T.G1(3);break}return g.Q(T,Ok(L.W,e.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:b=T.K;case 3:E=b;if(!e||!E)return T.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f));v=g.R(W.actionMetadata,YLW);g.XK(T,5);return g.Q(T,F9L(L,U,E.addedTimestampMillis,(r=v)==null?void 0:r.track,(B=v)==null?void 0:B.albumRelease),
7);case 7:S=Number(((A=W.actionMetadata)==null?void 0:A.priority)||0)+1;d=Po("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",U,"playbackData",S,aq5);g.TM(T,6);break;case 5:Z=g.y7(T);if(!(Z instanceof Error&&Z.message==="No data")){if(Z instanceof Error&&Z.message==="Empty response body")Uj(Z.message);else return M="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",m="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Z instanceof g.vm&&Z.type==="QUOTA_EXCEEDED"&&(M="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
m="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),T.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,M,m));T.G1(6);break}return g.Q(T,Kt(U,L.W,W,L.N),6);case 6:return T.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",f,d?[d]:void 0))}})},RcG=function(L,W){var f,I;
return g.t(function(U){switch(U.W){case 1:return f=d_(W),g.XK(U,2),I=g.xB(W.entityKey).entityId,I==="!*$_ALL_ENTITIES_!*$"?g.Q(U,yg(L.W,W,L.N),5):g.Q(U,Kt(I,L.W,W,L.N),6);case 6:return g.Q(U,hjQ(L.W,W.entityKey),5);case 5:g.TM(U,3);break;case 2:return g.y7(U),U.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",f,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return U.return(new JD("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
f))}})},F9L=function(L,W,f,I,U){var e,b,E,d,v,r;
return g.t(function(B){switch(B.W){case 1:if(e=I){B.G1(2);break}return g.Q(B,rID([W]),3);case 3:b=B.K,E=b[0],e=oC5(E);case 2:return g.Q(B,NGi(L,e,W,U,f),4);case 4:d=B.K;v=d.musicTrackEntity;r=d.bB;var A=DV(v.thumbnailDetails),S=[];r&&(S=DV(r.thumbnailDetails));return g.Q(B,XJ(A.concat(S)),0)}})},NGi=function(L,W,f,I,U){var e;
return g.t(function(b){return b.W==1?(U||(U=Date.now().toString()),e={id:g.kB(f,"musicTrackDownloadMetadataEntity"),playbackData:g.kB(f,"playbackData"),addedTimestampMillis:U,videoDownloadContextEntity:g.kB(f,"videoDownloadContextEntity")},I&&(W.albumRelease=I.id),g.Q(b,HF(L.W,{mode:"readwrite",Jg:!0},function(E){var d=[],v=qt(E,e,"musicTrackDownloadMetadataEntity");d.push(v);v=qt(E,W,"musicTrack");d.push(v);I&&(E=qt(E,I,"musicAlbumRelease"),d.push(E));return g.w5.all(d)}),2)):b.W!=3?g.Q(b,AD(f,"musicTrackDownloadMetadataEntity",
L.W,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):b.return({musicTrackEntity:W,
bB:I})})},Lv=function(){iO.apply(this,arguments);
this.X="musicTrack"},G$W=function(L,W,f){W=W===void 0?43200:W;
f=f===void 0?!0:f;var I=I===void 0?!1:I;var U,e;return g.t(function(b){switch(b.W){case 1:if(!L.J.Ou())return b.return([]);U=[];g.XK(b,2);return g.Q(b,zjD(W,f,I),4);case 4:U=b.K;g.TM(b,3);break;case 2:g.y7(b);case 3:return e=kdL(L,U,f,"musicPlaylist"),b.return(e)}})},cbA=function(){g.ux.apply(this,arguments);
var L=this;this.events=new g.XF(this);this.kp=this.player.B();this.Kw={Mch:function(){return L.W},
t2:function(){return L.t2()},
nD:function(W){return L.nD(W)}}},sbt=function(L){var W;
L=g.R((W=L.getWatchNextResponse())==null?void 0:W.currentVideoEndpoint,g.VZ);if(L==null?0:L.playlistId)var f=L.playlistId;return f},qLi=function(L,W){var f,I,U,e;
return g.t(function(b){if(b.W==1){f=W.clientPlaybackNonce;I={cpn:f,offlineSourceVisualElement:g.Zf(W.g6||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};W.K&&(I.videoFmt=Number(W.K.itag));W.T&&(I.audioFmt=Number(W.T.itag));if((U=sbt(W))&&W.videoId){var E=W.videoId;E=U!=="PPSV"?Promise.resolve(!1):L.W.DD(E);b=g.Q(b,E,3)}else b=b.G1(2);return b}b.W!=2&&(e=b.K)&&(I.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");L.K=f;g.UV("offlinePlaybackStarted",I);g.n0(b)})};
g.sY.prototype.qJ=g.Uy(45,function(L){return this.app.qJ(L)});
g.w7.prototype.qJ=g.Uy(44,function(L){return g.sMr(this,9,L)});
g.w(at,F1);g.ex.Object.defineProperties(at.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.W.entityMetadata},
set:function(L){this.W.entityMetadata=L}}});
g.w(PMW,at);PMW.prototype.K=function(){return[]};
g.w(JvA,at);JvA.prototype.K=function(){return[]};
g.w(Y0L,at);Y0L.prototype.K=function(){return[]};
g.w(F_L,at);F_L.prototype.K=function(){return[]};
g.w(adD,at);adD.prototype.K=function(){return[]};
g.w(CMc,at);CMc.prototype.K=function(){var L=[];this.W.alternateChannel&&L.push(this.W.alternateChannel);this.W.alternateChannelList&&L.push.apply(L,g.Aj(this.W.alternateChannelList));this.W.oneofChannelEntity&&L.push(this.W.oneofChannelEntity);return[].concat(g.Aj(new Set(L)))};
g.w(pnc,at);pnc.prototype.K=function(){var L=[];this.W.entryCollection&&L.push(this.W.entryCollection);return[].concat(g.Aj(new Set(L)))};
g.w(RWt,F1);RWt.prototype.K=function(){var L=[];this.W.video&&L.push(this.W.video);return[].concat(g.Aj(new Set(L)))};
g.w(N4O,at);N4O.prototype.K=function(){var L=[];this.W.parentPlaylist&&L.push(this.W.parentPlaylist);if(this.W.entries)for(var W=g.n(this.W.entries),f=W.next();!f.done;f=W.next())L.push.apply(L,g.Aj((new RWt(f.value)).K()));return[].concat(g.Aj(new Set(L)))};
g.w(GVX,at);GVX.prototype.K=function(){var L=[];this.W.descriptionEntity&&L.push(this.W.descriptionEntity);this.W.creators&&L.push.apply(L,g.Aj(this.W.creators));this.W.theBiggestFan&&L.push(this.W.theBiggestFan);return[].concat(g.Aj(new Set(L)))};
g.w(cvO,at);cvO.prototype.K=function(){return[]};
g.w(ssn,at);ssn.prototype.K=function(){return[]};
g.w(q0v,at);q0v.prototype.K=function(){return[]};
g.w(iV5,at);iV5.prototype.K=function(){return[]};
g.w(xBO,at);xBO.prototype.K=function(){return[]};
g.w(kVO,at);kVO.prototype.K=function(){return[]};
g.w(HVc,at);HVc.prototype.K=function(){return[]};
g.w(ldv,at);ldv.prototype.K=function(){return[]};
g.w(OVc,at);OVc.prototype.K=function(){return[]};
g.w(LY5,at);LY5.prototype.K=function(){var L=[];this.W.downloadsList&&L.push(this.W.downloadsList);this.W.smartDownloadsList&&L.push(this.W.smartDownloadsList);this.W.recommendedDownloadsList&&L.push(this.W.recommendedDownloadsList);this.W.refresh&&L.push(this.W.refresh);return[].concat(g.Aj(new Set(L)))};
g.w(WYO,F1);WYO.prototype.K=function(){var L=[];this.W.video&&L.push(this.W.video);this.W.playlist&&L.push(this.W.playlist);this.W.videoItem&&L.push(this.W.videoItem);this.W.playlistItem&&L.push(this.W.playlistItem);return[].concat(g.Aj(new Set(L)))};
g.w($gn,at);$gn.prototype.K=function(){var L=[];this.W.refresh&&L.push(this.W.refresh);if(this.W.downloads)for(var W=g.n(this.W.downloads),f=W.next();!f.done;f=W.next())L.push.apply(L,g.Aj((new WYO(f.value)).K()));return[].concat(g.Aj(new Set(L)))};
g.w(f6O,at);f6O.prototype.K=function(){var L=[];this.W.localImageEntities&&L.push.apply(L,g.Aj(this.W.localImageEntities));return[].concat(g.Aj(new Set(L)))};
g.w(I6A,at);I6A.prototype.K=function(){var L=[];this.W.playbackData&&L.push(this.W.playbackData);this.W.localImageEntities&&L.push.apply(L,g.Aj(this.W.localImageEntities));this.W.videoDownloadContextEntity&&L.push(this.W.videoDownloadContextEntity);return[].concat(g.Aj(new Set(L)))};
g.w(Ug5,at);Ug5.prototype.K=function(){return[]};
g.w(eAA,at);eAA.prototype.K=function(){var L=[];this.W.fakeChildren&&L.push.apply(L,g.Aj(this.W.fakeChildren));return[].concat(g.Aj(new Set(L)))};
g.w(oEG,at);oEG.prototype.K=function(){var L=[];this.W.video&&L.push(this.W.video);this.W.playbackData&&L.push(this.W.playbackData);this.W.offlineVideoPolicy&&L.push(this.W.offlineVideoPolicy);return[].concat(g.Aj(new Set(L)))};
g.w(bxc,at);bxc.prototype.K=function(){return[]};
g.w(hAX,at);hAX.prototype.K=function(){var L=[];this.W.channelOwner&&L.push(this.W.channelOwner);this.W.videos&&L.push.apply(L,g.Aj(this.W.videos));this.W.collaboratorChannels&&L.push.apply(L,g.Aj(this.W.collaboratorChannels));this.W.downloadState&&L.push(this.W.downloadState);this.W.refresh&&L.push(this.W.refresh);return[].concat(g.Aj(new Set(L)))};
g.w(EEA,at);EEA.prototype.K=function(){var L=[];this.W.video&&L.push(this.W.video);this.W.channelContributor&&L.push(this.W.channelContributor);return[].concat(g.Aj(new Set(L)))};
g.w(dgi,F1);dgi.prototype.K=function(){var L=[];this.W.localImageEntities&&L.push.apply(L,g.Aj(this.W.localImageEntities));this.W.videoDownloadContextEntity&&L.push(this.W.videoDownloadContextEntity);return[].concat(g.Aj(new Set(L)))};
g.w(vEO,F1);vEO.prototype.K=function(){var L=[];this.W.recommendedVideoMetadata&&L.push.apply(L,g.Aj((new dgi(this.W.recommendedVideoMetadata)).K()));return[].concat(g.Aj(new Set(L)))};
g.w(rSO,F1);rSO.prototype.K=function(){var L=[];this.W.playbackPosition&&L.push(this.W.playbackPosition);return[].concat(g.Aj(new Set(L)))};
g.w(BUt,at);BUt.prototype.K=function(){var L=[];this.W.owner&&L.push(this.W.owner);this.W.downloadState&&L.push(this.W.downloadState);this.W.userState&&L.push.apply(L,g.Aj((new rSO(this.W.userState)).K()));this.W.additionalMetadata&&L.push.apply(L,g.Aj((new vEO(this.W.additionalMetadata)).K()));return[].concat(g.Aj(new Set(L)))};
g.w(ASc,at);ASc.prototype.K=function(){var L=[];this.W.userChannelDetails&&L.push(this.W.userChannelDetails);return[].concat(g.Aj(new Set(L)))};
g.w(SKn,at);SKn.prototype.K=function(){var L=[];this.W.channelOwner&&L.push(this.W.channelOwner);this.W.playbackPosition&&L.push(this.W.playbackPosition);this.W.localImageEntities&&L.push.apply(L,g.Aj(this.W.localImageEntities));this.W.downloadStatus&&L.push(this.W.downloadStatus);return[].concat(g.Aj(new Set(L)))};
g.w(ZxW,at);ZxW.prototype.K=function(){return[]};
g.w(Dgn,at);Dgn.prototype.K=function(){return[]};
g.w(wBc,at);wBc.prototype.K=function(){return[]};
g.w(zA5,at);zA5.prototype.K=function(){return[]};
g.w(MTc,at);MTc.prototype.K=function(){return[]};
g.w(nEi,at);nEi.prototype.K=function(){return[]};
g.w(XBi,at);XBi.prototype.K=function(){return[]};
g.w(VTn,at);VTn.prototype.K=function(){return[]};
g.w(mgO,at);mgO.prototype.K=function(){return[]};
g.w(umQ,at);umQ.prototype.K=function(){return[]};
g.w(KYc,at);KYc.prototype.K=function(){return[]};
g.w(TUL,at);TUL.prototype.K=function(){return[]};
g.w(ySO,at);ySO.prototype.K=function(){var L=[];this.W.trackDownloadMetadatas&&L.push.apply(L,g.Aj(this.W.trackDownloadMetadatas));return[].concat(g.Aj(new Set(L)))};
g.w(gEi,at);
gEi.prototype.K=function(){var L=[];this.W.downloadedTracks&&L.push.apply(L,g.Aj(this.W.downloadedTracks));this.W.smartDownloadedTracks&&L.push.apply(L,g.Aj(this.W.smartDownloadedTracks));this.W.downloadedEpisodes&&L.push.apply(L,g.Aj(this.W.downloadedEpisodes));this.W.downloadedAlbumReleases&&L.push.apply(L,g.Aj(this.W.downloadedAlbumReleases));this.W.smartDownloadedAlbumReleases&&L.push.apply(L,g.Aj(this.W.smartDownloadedAlbumReleases));this.W.downloadedPlaylists&&L.push.apply(L,g.Aj(this.W.downloadedPlaylists));this.W.smartDownloadedPlaylists&&
L.push.apply(L,g.Aj(this.W.smartDownloadedPlaylists));this.W.metadataOnlyTracks&&L.push.apply(L,g.Aj(this.W.metadataOnlyTracks));return[].concat(g.Aj(new Set(L)))};
g.w(QYC,at);QYC.prototype.K=function(){var L=[];this.W.trackDownloadMetadatas&&L.push.apply(L,g.Aj(this.W.trackDownloadMetadatas));return[].concat(g.Aj(new Set(L)))};
g.w(jYD,at);jYD.prototype.K=function(){var L=[];this.W.playbackData&&L.push(this.W.playbackData);this.W.localImageEntities&&L.push.apply(L,g.Aj(this.W.localImageEntities));this.W.videoDownloadContextEntity&&L.push(this.W.videoDownloadContextEntity);return[].concat(g.Aj(new Set(L)))};
g.w(tTi,at);tTi.prototype.K=function(){var L=[];this.W.musicLibraryStatusEntity&&L.push(this.W.musicLibraryStatusEntity);this.W.primaryArtists&&L.push.apply(L,g.Aj(this.W.primaryArtists));this.W.details&&L.push(this.W.details);this.W.userDetails&&L.push(this.W.userDetails);this.W.tracks&&L.push.apply(L,g.Aj(this.W.tracks));this.W.share&&L.push(this.W.share);this.W.downloadMetadata&&L.push(this.W.downloadMetadata);this.W.refresh&&L.push(this.W.refresh);return[].concat(g.Aj(new Set(L)))};
g.w(PsC,at);PsC.prototype.K=function(){var L=[];this.W.albumRelease&&L.push(this.W.albumRelease);this.W.tracks&&L.push.apply(L,g.Aj(this.W.tracks));return[].concat(g.Aj(new Set(L)))};
g.w(JSt,at);JSt.prototype.K=function(){var L=[];this.W.albumRelease&&L.push(this.W.albumRelease);return[].concat(g.Aj(new Set(L)))};
g.w(YKW,at);YKW.prototype.K=function(){var L=[];this.W.details&&L.push(this.W.details);this.W.userDetails&&L.push(this.W.userDetails);return[].concat(g.Aj(new Set(L)))};
g.w(FYn,at);FYn.prototype.K=function(){var L=[];this.W.parentArtist&&L.push(this.W.parentArtist);return[].concat(g.Aj(new Set(L)))};
g.w(a6i,at);a6i.prototype.K=function(){var L=[];this.W.parentArtist&&L.push(this.W.parentArtist);return[].concat(g.Aj(new Set(L)))};
g.w(Csn,at);Csn.prototype.K=function(){return[]};
g.w(pBc,at);pBc.prototype.K=function(){return[]};
g.w(RAc,F1);RAc.prototype.K=function(){var L=[];this.W.creatorEntity&&L.push(this.W.creatorEntity);return[].concat(g.Aj(new Set(L)))};
g.w(NUL,at);
NUL.prototype.K=function(){var L=[];this.W.tracks&&L.push.apply(L,g.Aj(this.W.tracks));this.W.refresh&&L.push(this.W.refresh);this.W.musicLibraryStatusEntity&&L.push(this.W.musicLibraryStatusEntity);this.W.details&&L.push(this.W.details);this.W.downloadMetadata&&L.push(this.W.downloadMetadata);this.W.sideloadMetadata&&L.push(this.W.sideloadMetadata);this.W.userDetails&&L.push(this.W.userDetails);this.W.entryCollection&&L.push(this.W.entryCollection);this.W.share&&L.push(this.W.share);this.W.podcastShowAdditionalMetadata&&
L.push.apply(L,g.Aj((new RAc(this.W.podcastShowAdditionalMetadata)).K()));return[].concat(g.Aj(new Set(L)))};
g.w(G1c,at);G1c.prototype.K=function(){return[]};
g.w(cS5,at);
cS5.prototype.K=function(){var L=[];this.W.musicLibraryStatusEntity&&L.push(this.W.musicLibraryStatusEntity);this.W.artists&&L.push.apply(L,g.Aj(this.W.artists));this.W.audioModeVersion&&L.push(this.W.audioModeVersion);this.W.videoModeVersion&&L.push(this.W.videoModeVersion);this.W.userDetails&&L.push(this.W.userDetails);this.W.details&&L.push(this.W.details);this.W.albumRelease&&L.push(this.W.albumRelease);this.W.share&&L.push(this.W.share);this.W.libraryEdit&&L.push(this.W.libraryEdit);this.W.downloadMetadata&&
L.push(this.W.downloadMetadata);this.W.playbackPosition&&L.push(this.W.playbackPosition);this.W.lyrics&&L.push(this.W.lyrics);return[].concat(g.Aj(new Set(L)))};
g.w(sYL,at);sYL.prototype.K=function(){var L=[];this.W.parentTrack&&L.push(this.W.parentTrack);return[].concat(g.Aj(new Set(L)))};
g.w(qKi,at);qKi.prototype.K=function(){var L=[];this.W.parentTrack&&L.push(this.W.parentTrack);return[].concat(g.Aj(new Set(L)))};
g.w(ixt,at);ixt.prototype.K=function(){return[]};
g.w(xgA,at);xgA.prototype.K=function(){return[]};
g.w(k1G,at);k1G.prototype.K=function(){return[]};
g.w(Hxt,at);Hxt.prototype.K=function(){return[]};
g.w(l6n,at);l6n.prototype.K=function(){var L=[];this.W.transfer&&L.push(this.W.transfer);this.W.adsPlaybackData&&L.push.apply(L,g.Aj(this.W.adsPlaybackData));this.W.drmLicense&&L.push(this.W.drmLicense);this.W.offlineVideoPolicy&&L.push(this.W.offlineVideoPolicy);this.W.videoDownloadContextEntity&&L.push(this.W.videoDownloadContextEntity);return[].concat(g.Aj(new Set(L)))};
g.w(Oxv,at);Oxv.prototype.K=function(){return[]};
g.w(LNn,at);LNn.prototype.K=function(){var L=[];this.W.offlineVideoStreams&&L.push.apply(L,g.Aj(this.W.offlineVideoStreams));this.W.captionTrack&&L.push.apply(L,g.Aj(this.W.captionTrack));return[].concat(g.Aj(new Set(L)))};
g.w(WNL,at);WNL.prototype.K=function(){return[]};
g.w($lW,at);$lW.prototype.K=function(){return[]};
g.w(fvG,at);fvG.prototype.K=function(){return[]};
g.w(IvO,at);IvO.prototype.K=function(){return[]};
g.w(Uln,at);Uln.prototype.K=function(){return[]};
g.w(eiQ,at);eiQ.prototype.K=function(){return[]};
g.w(ozC,at);ozC.prototype.K=function(){return[]};
g.w(bet,at);bet.prototype.K=function(){return[]};
g.w(hit,at);hit.prototype.K=function(){return[]};
g.w(EzG,at);EzG.prototype.K=function(){return[]};
g.w(dlA,at);dlA.prototype.K=function(){return[]};
g.w(vzc,at);vzc.prototype.K=function(){return[]};
g.w(rCc,at);rCc.prototype.K=function(){return[]};
g.w(BXQ,at);BXQ.prototype.K=function(){return[]};
g.w(ACL,at);ACL.prototype.K=function(){return[]};
g.w(SQC,at);SQC.prototype.K=function(){return[]};
g.w(Zei,at);Zei.prototype.K=function(){return[]};
g.w(DlL,at);DlL.prototype.K=function(){return[]};
g.w(wID,at);wID.prototype.K=function(){return[]};
g.w(zin,at);zin.prototype.K=function(){return[]};
g.w(MMt,at);MMt.prototype.K=function(){return[]};
g.w(nzv,at);nzv.prototype.K=function(){return[]};
var M2c=["browse","music/browse","unplugged/browse"],uIO=["offline/playlist_sync_check"],vCc=["offline"],nCi=["offline/offline_video_playback_position_sync"],V2c=["offline/get_playback_data_entity"],CK;pK.getInstance=function(){return g.t(function(L){return L.return(new Promise(function(W){g.kf().then(function(f){f?(pK.instance||(pK.instance=new pK(f)),W(pK.instance)):W(void 0)})}))})};
pK.prototype.get=function(L){var W=this,f,I,U;return g.t(function(e){if(e.W==1)return g.Q(e,uQO(W.token),2);if(e.W!=3)return f=e.K,g.Q(e,f.get("prefs",L),3);I=e.K;if(!I)return e.return();U=(0,g.V4)();return I.expirationTimestampMs<=U?e.return():e.return(I.value)})};
pK.prototype.set=function(L,W,f){f=f===void 0?31536E3:f;var I=this,U,e,b;return g.t(function(E){if(E.W==1)return U=(0,g.V4)(),e={key:L,value:W,expirationTimestampMs:U+f*1E3},g.Q(E,uQO(I.token),2);b=E.K;return g.Q(E,g.Q4(b,"prefs",e),0)})};
pK.prototype.remove=function(L){var W=this,f;return g.t(function(I){if(I.W==1)return g.Q(I,uQO(W.token),2);f=I.K;return g.Q(I,f.delete("prefs",L),0)})};
g.w(Rt,g.NT);g.w(Nt,QQG);Nt.prototype.N=function(L,W){W=tMO(W);L=(new TextEncoder).encode(JSON.stringify(L));return this.W.encrypt(L,W)};
Nt.prototype.K=function(L,W){if(!(L instanceof Uint8Array))throw KNQ(1);var f=new TextDecoder;W=tMO(W);L=this.W.decrypt(L,W);return JSON.parse(f.decode(L))};
var PoO={accountLinkStatusEntity:q0v,booleanEntity:F_L,buttonEntity:ACL,captionTrack:ixt,channelHandle:PMW,chipEntity:ozC,commerceAcquisitionClientPayloadEntity:Zei,commerceCartListEntity:DlL,contextNoteFeedEntityPayload:JvA,contextNoteUserRatingEntityPayload:Y0L,continuationTokenEntity:bxc,downloadQualityPickerEntity:HVc,downloadsPageRefreshTokenEntity:OVc,downloadsPageViewConfigurationEntity:ZxW,downloadStatusEntity:ldv,dismissState:bet,sfvAudioItemCurrentlyPlayingEntity:IvO,emojiFountainDataEntity:rCc,
emojiCustomizationSetEntity:vzc,fakeChannel:CMc,fakePlaylist:pnc,fakePlaylistEntryCollection:N4O,fakeVideo:GVX,fakeVideoDescription:cvO,featuredProductsEntity:umQ,flowStateEntity:ssn,iconBadgeEntity:wID,interstitialInteractionStateEntity:xBO,likeButtonAnimationEntity:Dgn,liveChatPollStateEntity:kVO,dataFreshnessEntity:dlA,liveViewerLeaderboardChatEntryPointStateEntity:$lW,liveViewerLeaderboardPointsEntity:fvG,liveReactionsDataEntity:BXQ,logoEntity:iV5,macroMarkerEntity:wBc,mainDownloadsLibraryEntity:LY5,
mainDownloadsListEntity:$gn,mainPlaylistDownloadStateEntity:f6O,mainPlaylistEntity:hAX,mainPlaylistVideoEntity:EEA,mainVideoDownloadStateEntity:I6A,mainVideoEntity:BUt,markersEngagementPanelSyncEntity:zA5,markersVisibilityOverrideEntity:MTc,musicAlbumReleaseDetail:PsC,musicAlbumReleaseDownloadMetadataEntity:ySO,musicAlbumRelease:tTi,musicAlbumReleaseUserDetail:JSt,musicArtistDetail:FYn,musicArtist:YKW,musicArtistUserDetail:a6i,musicDownloadsLibraryEntity:gEi,musicLibraryEdit:Csn,musicLibraryStatusEntity:pBc,
musicPlaylist:NUL,musicPlaylistDownloadMetadataEntity:QYC,musicShare:G1c,musicTrackDetail:sYL,musicTrackDownloadMetadataEntity:jYD,musicTrack:cS5,musicTrackUserDetail:qKi,offlineOrchestrationActionWrapperEntity:xgA,offlineVideoPolicy:k1G,offlineVideoStreams:Hxt,offlineabilityEntity:Ug5,orchestrationWebSamplingEntity:eAA,pageHeaderEntity:hit,pdpStateEntity:zin,pinnedProductEntity:KYc,playbackData:l6n,playerStateEntity:nEi,quantityIncrementerEntity:MMt,refresh:Oxv,saveToPlaylistListEntity:Uln,selectedChipIndexEntityPayload:XBi,
settingEntity:eiQ,stringEntity:adD,suggestedFeedbackChipStateEntity:VTn,transfer:LNn,trendingOfferEntity:TUL,videoDownloadContextEntity:WNL,videoOverviewAsyncDataEntity:nzv,videoPlaybackPositionEntity:SQC,votingEntity:EzG,ytMainChannelEntity:ASc,youchatPendingResponseEntity:mgO,ytMainDownloadedVideoEntity:oEG,ytMainVideoEntity:SKn};g.w(xl,QQG);xl.prototype.N=function(L){return L};
xl.prototype.K=function(L){if(L instanceof Uint8Array)throw KNQ(0);return L};
g.w(kl,g.a);kl.prototype.observe=function(L){var W=this;this.observers.push(L);return function(){var f=W.observers.indexOf(L);f>=0&&W.observers.splice(f,1)}};
kl.prototype.K=function(L){xlC(this,L.data)};
kl.prototype.w6=function(){this.channel.close()};
var LZv,lBt=new g.Xo("elementsCommand");var m0=new g.Xo("entityBatchUpdate");var C$i=new g.Xo("downloadStatusEntity");var $RG=new g.Xo("mainPlaylistEntityActionMetadata");var Ho=new g.Xo("mainVideoEntityActionMetadata");var dmO=new g.Xo("musicPlaylistEntityActionMetadata");var YLW=new g.Xo("musicTrackEntityActionMetadata");var Z$G=new g.Xo("localImageEntityActionMetadata");var Y0=new g.Xo("playbackDataActionMetadata");var OZW=new g.Xo("transferEntityActionMetadata");var Fbv=new g.Xo("videoPlaybackPositionEntityActionMetadata");var A0W;new g.vI;new g.vI;zkL.prototype.request=function(L,W,f){W=W===void 0?{}:W;return this.locks.request(L,W,function(I){return f(I)})};var Io=g.lp.caches,ft,mfc;$0.prototype.open=function(L){return Io.open(XHi(L))};
$0.prototype.has=function(L){return Io.has(XHi(L))};
$0.prototype.delete=function(L){return Io.delete(XHi(L))};
$0.prototype.match=function(L,W){var f=this,I,U,e,b,E,d;return g.t(function(v){switch(v.W){case 1:return g.Q(v,f.keys(),2);case 2:I=v.K,U=g.n(I),e=U.next();case 3:if(e.done){v.G1(5);break}b=e.value;return g.Q(v,f.open(b),6);case 6:return E=v.K,g.Q(v,E.match(L,W),7);case 7:if(d=v.K)return v.return(d);e=U.next();v.G1(3);break;case 5:return v.return()}})};
g.w(nFc,$0);nFc.prototype.keys=function(){var L,W,f,I,U,e,b,E,d;return g.t(function(v){if(v.W==1)return L=[],W=g.G4("CacheStorage keys"),g.Q(v,Io.keys(),2);f=v.K;I=g.n(f);for(U=I.next();!U.done;U=I.next()){e=U.value;var r=e.indexOf(":");b=r===-1?{fU:e}:{fU:e.substring(0,r),datasyncId:e.substring(r+1)};E=b.fU;d=b.datasyncId;d===W&&L.push(E)}return v.return(L)})};g.w(eX,g.a);eX.prototype.N=function(L){this.api.xp("onOfflineOperationFailure",L.data)};
eX.prototype.T=function(L){this.api.publish("offlinetransferpause",L.data)};
eX.prototype.w6=function(){var L;(L=this.W)==null||L.close();var W;(W=this.K)==null||W.close()};TZW.prototype.A4=function(){this.W&&bO(this)};
TZW.prototype.c6=function(){this.K&&this.K.resolve();this.N=this.W=!1;this.X()};var A7c=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var xfc="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var eji="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.w(TW5,tD);TW5.prototype.K=function(L){return vo(L)?QAL(this,L):r_(L)?PnD(this,L):Promise.reject(Error("Unsupported action type: "+L.actionType))};g.w(JIv,tD);JIv.prototype.K=function(L){return r_(L)?YFL(this,L):aBc(L)?apc(this,L):Bo(L)?CnX(this,L):Promise.reject(Error("Unsupported action type: "+L.actionType))};g.D=pjA.prototype;g.D.bQV=function(L){var W=this,f,I,U,e;return g.t(function(b){if(!g.x(L.state,128))return b.G1(0);f=L.state.DJ;var E=(I=f)==null?void 0:I.errorCode,d=(U=f)==null?void 0:U.Pi;e=E==="net.connect"&&d===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(E==null?0:E.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.Q(b,W.Ep(W.player.getVideoData().videoId,e),0)})};
g.D.Ep=function(L,W){var f=this;return g.t(function(I){if(I.W==1){if(f.K)return I.return();f.K=!0;return W==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(Ct(f,L,!1,!0),I.G1(0)):g.Q(I,ao(f,L),3)}g.Us(L,4);return g.Q(I,f.W.Ep(W),0)})};
g.D.pU=function(L){L.status===2?(L.status!==this.N&&(Y4n(this.W),g.Us(L.videoId,2)),L.bG&&RGL(this.W,L.videoId,L.bG)):L.status===4?(ao(this,L.videoId),this.Ep(L.videoId,L.Tt?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):L.status===1&&pCv(this.W);this.N=L.status;this.api.xp("localmediachange",{videoId:L.videoId,status:L.status})};
g.D.Go=function(){var L=this,W;return g.t(function(f){if(f.W==1){if(L.K)return f.return();L.K=!0;W=L.player.getVideoData().videoId;return g.Q(f,ao(L,W),2)}return g.Q(f,L.W.Go(),0)})};
g.D.Li=function(L){switch(L){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.D.Z=function(L){return this.api.B().Z(L)};g.w(iZc,tD);iZc.prototype.K=function(L){return vo(L)?kii(this,L):r_(L)?HZO(this,L):aBc(L)?lp5(this,L):Promise.reject(Error("Unsupported action type: "+L.actionType))};IYG.prototype.W=function(L,W){var f=L.action.actionMetadata.priority-W.action.actionMetadata.priority;f===0&&(L.W<W.W?f=-1:L.W>W.W&&(f=1));return f};g.w(pt,g.a);pt.prototype.w6=function(){this.X&&this.X();g.a.prototype.w6.call(this)};
pt.prototype.createAction=function(L,W){var f=g.xB(L.entityKey).entityType,I=g.Z0(16);return new w_(f,I,L,W.actionId,W.rootActionId)};
pt.prototype.qV=function(L){var W=this,f,I,U,e,b,E,d,v,r;return g.t(function(B){if(B.W==1){if(W.Je())return B.return();I=(f=L.offlineOrchestrationActionWrapperEntity)!=null?f:new Set;U=[];e=g.n(I);for(b=e.next();!b.done;b=e.next())E=b.value,d=g.xB(E),v=d.entityId,oIc(W.W,v)||U.push(E);return g.Q(B,DYt(W,U),2)}r=B.K;return g.Q(B,ZjO(W,r),0)})};
pt.prototype.retry=function(){var L=this;return g.t(function(W){return g.Q(W,wCG(L),0)})};MUX.prototype.L5=function(L,W){W=W===void 0?!0:W;var f=this,I,U,e,b,E,d,v,r;return g.t(function(B){switch(B.W){case 1:if(!f.W)return B.return();I=[];U=g.eW(f.W.K,W);e=[];for(b={gR:0};b.gR<U.length;b={gR:b.gR},b.gR++)E=U[b.gR],d=f.W.Ii(E,"json3"),v=g.T$(d,{withCredentials:!0,format:"RAW"},3,500).then(function(A){return function(S){S={metadata:g.Gn(U[A.gR]),trackData:S.xhr.responseText};e.push(S)}}(b)).NB(function(A){Uj("Caption fetch error",A)}),I.push(v);
return g.Q(B,tsC(I),2);case 2:return g.XK(B,3),g.Q(B,bNL(L,e),5);case 5:g.TM(B,0);break;case 3:r=g.y7(B),Uj("Caption DB transaction error",r),g.n0(B)}})};g.w(Ro,g.a);Ro.prototype.w6=function(){this.K&&this.K();g.a.prototype.w6.call(this)};
Ro.prototype.N=function(L){var W=this,f,I,U,e,b,E,d,v;return g.t(function(r){I=(f=L.transfer)!=null?f:new Set;U=[];e=g.n(I);for(b=e.next();!b.done;b=e.next())E=b.value,d=g.xB(E),v=d.entityId,U.push(v);return U.length===0?r.return():g.Q(r,VUc(W,U),0)})};g.w(y7G,g.a);g.D=y7G.prototype;g.D.w6=function(){this.Rh&&this.Rh();this.ys.dispose();this.T.dispose();this.g6&&g.Hn(this.J.SX,this.g6);this.FP&&g.Hn(this.J.SX,this.FP);g.a.prototype.w6.call(this)};
g.D.Yvl=function(L){var W=this,f,I,U;return g.t(function(e){switch(e.W){case 1:f=g.kB(L,"transfer");if(W.W&&f===W.W.key){Ct(W.V,W.G,!0);W.T.stop();e.G1(0);break}return g.Q(e,HF(W.K,{mode:"readwrite",Jg:!0},function(b){return Go(b,f,"transfer").then(function(E){if(E&&E.transferState!=="TRANSFER_STATE_COMPLETE"&&E.transferState!=="TRANSFER_STATE_FAILED")return E.transferState="TRANSFER_STATE_PAUSED_BY_USER",qt(b,E,"transfer").then(function(){return E})})}),3);
case 3:I=e.K;if(!I){e.G1(0);break}if(!L||!W.N){e.G1(5);break}return g.Q(e,AD(L,W.N,W.K,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.Q(e,co(W,L),7);case 7:U=e.K,YnC({videoId:L,Xj:I,offlineModeType:U}),g.n0(e)}})};
g.D.PXH=function(){var L=this;if(this.W&&this.G){Ct(this.V,this.G,!1);var W=this.W,f=(W==null?0:W.key)?g.xB(W.key).entityId:"";f&&this.N&&(new Promise(function(I,U){AD(f,L.N,L.K,"DOWNLOAD_STATE_PAUSED").catch(function(e){U(e)})})).catch(function(I){Uj("Download state setting error",I)})}this.T.stop()};
g.D.YM=function(){this.W?j0c(this,this.W):GI(this)};
g.D.tW=function(L){var W=this;return g.t(function(f){switch(f.W){case 1:if(!W.W){f.G1(2);break}if(W.W.transferState==="TRANSFER_STATE_COMPLETE"||W.W.transferState==="TRANSFER_STATE_FAILED"||!L.transfer||!L.transfer.has(W.W.key)){f.G1(3);break}return g.Q(f,Ok(W.K,W.W.key,"transfer"),4);case 4:W.W=f.K;if(W.W){f.G1(3);break}return g.Q(f,tUO(W),3);case 3:if(W.W)return f.return();case 2:return g.Q(f,GI(W),0)}})};
g.D.Ep=function(L,W){var f=this,I,U,e,b,E;return g.t(function(d){switch(d.W){case 1:if(!f.W){sj(f,"onTransferFailure: "+L);d.G1(2);break}I=f.W;e=((U=I)==null?0:U.key)?g.xB(I.key).entityId:"";a:switch(L){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var v=!1;break a;default:v=!0}return v&&NmQ(f)?g.Q(d,qj(f,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.Q(d,
GdA(f,L),5);case 5:if(!e||!f.N){d.G1(2);break}return g.Q(d,AD(e,f.N,f.K,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.Q(d,co(f,e),9);case 9:b=d.K;Ej({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:e,Xj:I,offlineModeType:b});if(!e||!f.N){d.G1(2);break}return g.Q(d,AD(e,f.N,f.K,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:Nj(f),E=GI(f,!0),W&&W(E),g.n0(d)}})};
g.D.Go=function(L){var W=this,f,I,U,e,b,E,d,v,r,B,A,S;return g.t(function(Z){switch(Z.W){case 1:if(!W.W){sj(W,"onMaybeTransferStreamsExpired");Z.G1(2);break}return NmQ(W)?g.Q(Z,qj(W,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.Q(Z,GdA(W,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!W.N){Z.G1(2);break}f=W.W;U=((I=f)==null?0:I.key)?g.xB(f.key).entityId:"";if(!U){Z.G1(2);break}return g.Q(Z,AD(U,W.N,W.K,"DOWNLOAD_STATE_FAILED"),2);case 9:return W.W||sj(W,"onMaybeTransferStreamsExpiredRetryAttempting"),
e=W.W,E=((b=e)==null?0:b.key)?g.xB(e.key).entityId:"",g.Q(Z,co(W,E),10);case 10:return d=Z.K,Ej({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:E,Xj:e,offlineModeType:d}),v=NZG(),g.Pd(v,Y0,{isEnqueuedForExpiredStreamUrlRefetch:!0}),r=g.kB(E,"playbackData"),B={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:r,actionMetadata:v},A=Mj(new w_("playbackData",E,B)),g.Q(Z,lv(W.K,A,"offlineOrchestrationActionWrapperEntity"),2);case 2:Nj(W),S=GI(W,!0),
L&&L(S),g.n0(Z)}})};
var i$c={},c7t=(i$c.TRANSFER_STATE_TRANSFERRING=1,i$c.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,i$c);g.D=iO.prototype;g.D.XL=function(){return this.G.promise};
g.D.Y1=function(){if(this.K&&this.V)return this.G.promise;ijn(this).then(this.G.resolve).catch(this.G.reject);return this.G.promise};
g.D.tZ=function(L){var W={};return W.playbackData=new TW5(L,this.kp,this.W),W.transfer=new iZc(L,this.kp),W.videoPlaybackPositionEntity=new JIv(L,this.kp),W};
g.D.FU=function(){var L=this;return g.t(function(W){return L.K?g.Q(W,gI5(L.K),0):W.G1(0)})};
g.D.Mp=function(){var L=this,W,f;return g.t(function(I){if(I.W==1)return L.K||L.V?g.Q(I,L.XL(),2):I.return();L.U!==void 0&&(g.Si(L.U),L.U=void 0);L.T!==void 0&&(g.Si(L.T),L.T=void 0);(W=L.K)==null||W.dispose();L.K=void 0;(f=L.V)==null||f.dispose();L.V=void 0;L.api.xp("onOrchestrationLostLeader");L.G=new g.vI;g.n0(I)})};
g.D.isOrchestrationLeader=function(){return this.N.W};
g.D.DD=function(){return g.t(function(L){return L.return(!1)})};
g.D.rF=function(L){var W=this.W;W.api.publish("offlinetransferpause",L);var f;(f=W.K)==null||f.postMessage(L)};
g.D.YM=function(L){var W,f;return g.t(function(I){if(I.W==1)return g.Q(I,Wo(),2);W=I.K;if(!W)return I.return();f=g.kB(L,"transfer");return g.Q(I,HF(W,{mode:"readwrite",Jg:!0},function(U){var e=Go(U,f,"transfer"),b=Go(U,g.kB(L,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.w5.all([e,b]).then(function(E){E=g.n(E);var d=E.next().value;var v=E.next().value;return d&&d.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(d.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",qt(U,d,"transfer").then(function(){Ej({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:L,Xj:d,offlineModeType:v==null?void 0:v.offlineModeType});return g.w5.resolve(null)})):g.w5.resolve(null)})}),0)})};
g.D.u6=function(L){L=L===void 0?43200:L;var W=this,f,I,U,e,b,E,d,v;return g.t(function(r){if(r.W==1)return W.J.Ou()?g.Q(r,Wo(),2):r.return(xYv());if(r.W!=3){f=r.K;if(!f)return r.return([]);I=Date.now()/1E3;return g.Q(r,Lt(f,"offlineVideoPolicy"),3)}U=r.K;e=[];b=g.n(U);for(E=b.next();!E.done;E=b.next())d=E.value,Number(d.lastUpdatedTimestampSeconds)+L<=I&&(v=g.xB(d.key).entityId,e.push(v));return e.length?r.return(x0(W,e,W.X,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):r.return([])})};
g.D.deleteAll=function(){return x0(this,["!*$_ALL_ENTITIES_!*$"],this.X,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.D.refreshAllStaleEntities=function(L){var W=this;return g.t(function(f){return f.W==1?g.Q(f,W.u6(L),2):f.return(f.K)})};
g.D.setUpPositionSyncInterval=function(L){var W=this;this.T!==void 0&&(g.Si(this.T),this.T=void 0);var f=L!=null?L:864E5;this.T=g.BR(function(){W.Y9(f)},f)};
g.D.Y9=function(L){var W=this,f,I,U,e,b,E;return g.t(function(d){switch(d.W){case 1:return g.XK(d,2),g.Q(d,pK.getInstance(),4);case 4:f=d.K;if(!f)throw Error("prefStorage is undefined");return g.Q(d,f.get("psi"),5);case 5:I=d.K;e=((U=I)==null?0:U.Mv)?Number(I.Mv)/1E3:0;b=Date.now();if(!(e+L<=b)){d.G1(6);break}return g.Q(d,x0(W,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.TM(d,0);break;case 2:E=g.y7(d),Uj("Offline manager error",E),
g.n0(d)}})};
g.D.cJ=function(){var L=this,W,f,I,U,e,b,E;return g.t(function(d){if(d.W==1)return g.Q(d,Wo(),2);if(d.W!=3)return(W=d.K)?g.Q(d,Lt(W,"transfer"),3):d.return([]);f=d.K;I=[];U=g.n(f);for(e=U.next();!e.done;e=U.next())b=e.value,b.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&b.key&&(E=g.xB(b.key).entityId,I.push(E));return d.return(HjG(L,I))})};
g.D.cA=function(){return g.t(function(L){return L.return([])})};
g.D.H4=function(){return g.t(function(L){g.n0(L)})};
g.D.L1=function(){return g.t(function(L){g.n0(L)})};g.w(lYO,tD);lYO.prototype.K=function(L){return vo(L)?W9A(this,L):r_(L)?fqi(this,L):Bo(L)?IqW(this,L):Promise.reject(Error("Unsupported action type: "+L.actionType))};
var k0=[10];g.w(hcv,tD);hcv.prototype.K=function(L){return vo(L)?v95(this,L):r_(L)?rbX(this,L):Bo(L)?BGC(this,L):Promise.reject(Error("Unsupported action type: "+L.actionType))};
var dRW=[10];g.w(SLW,tD);SLW.prototype.K=function(L){return r_(L)?DRA(this,L):Promise.reject(Error("Unsupported action type: "+L.actionType))};g.w(wRC,iO);g.D=wRC.prototype;g.D.tZ=function(L){var W=iO.prototype.tZ.call(this,L);W.mainVideoEntity=new hcv(L,this.kp,this.W);W.mainPlaylistEntity=new lYO(L,this.kp,this.W);W.mainDownloadsListEntity=new SLW(L,this.kp,this.W);return W};
g.D.refreshAllStaleEntities=function(L,W){var f=this,I,U,e,b,E,d,v,r,B,A,S;return g.t(function(Z){switch(Z.W){case 1:I=[];if(!f.kp.Z("web_player_offline_playlist_auto_refresh")){Z.G1(2);break}return g.Q(Z,zcC(f,L,W),3);case 3:I=Z.K;case 2:return g.Q(Z,pK.getInstance(),4);case 4:return U=Z.K,g.Q(Z,(e=U)==null?void 0:e.get("sdois"),5);case 5:return b=Z.K,g.Q(Z,(E=U)==null?void 0:E.get("lmqf"),6);case 6:d=Z.K;if(!b){Z.G1(7);break}r=I;B=r.concat;return g.Q(Z,MiX(f,b,(v=d)!=null?v:"SD",L===0),8);case 8:I=
B.call(r,Z.K);case 7:return A=I,S=A.concat,g.Q(Z,iO.prototype.refreshAllStaleEntities.call(f,L,W),9);case 9:return I=S.call(A,Z.K),Z.return(I)}})};
g.D.DD=function(L){var W,f,I,U,e,b,E,d;return g.t(function(v){if(v.W==1)return g.Q(v,Wo(),2);if(v.W!=3)return(W=v.K)?g.Q(v,Ok(W,g.aP,"mainDownloadsListEntity"),3):v.return(!1);f=v.K;if((I=f)==null?0:(U=I.downloads)==null?0:U.length)for(e=g.kB(L,"mainVideoEntity"),b=g.n(f.downloads),E=b.next();!E.done;E=b.next())if(d=E.value,d.videoItem===e)return v.return(!0);return v.return(!1)})};
g.D.cA=function(){var L=this,W,f,I,U,e,b,E,d;return g.t(function(v){if(v.W==1)return g.Q(v,Wo(),2);if(v.W!=3)return(W=v.K)?g.Q(v,Lt(W,"downloadStatusEntity"),3):v.return([]);f=v.K;I=[];U=g.n(f);for(e=U.next();!e.done;e=U.next())b=e.value,b.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&b.key&&(E=g.xB(b.key).entityId,I.push(E));return I.length?(d={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},v.return(x0(L,I,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
d))):v.return([])})};
g.D.L1=function(){var L;return g.t(function(W){return W.W==1?g.Q(W,Wo(),2):(L=W.K)?g.Q(W,HF(L,{mode:"readwrite",Jg:!0},function(f){return cF(f,"mainVideoEntity").then(function(I){var U=[];I=g.n(I);for(var e=I.next();!e.done;e=I.next()){e=e.value;var b=void 0;(b=e.userState)!=null&&b.playbackPosition||(b=g.xB(e.key).entityId,b={key:g.kB(b,"videoPlaybackPositionEntity"),videoId:b,lastPlaybackPositionSeconds:"0"},U.push(qt(f,b,"videoPlaybackPositionEntity")),e.userState={playbackPosition:b.key},U.push(qt(f,
e,"mainVideoEntity")))}return g.w5.all(U)})}),0):W.return()})};
g.D.H4=function(){var L,W,f,I,U,e,b,E,d,v,r,B,A,S,Z,M,m,T,K,P,F,p,H,q,hj,Ey,IR,rF,$r,gF,xr,vA,Ei,qz,jx,eA,Y5,Gv;return g.t(function(o6){if(o6.W==1)return g.Q(o6,Wo(),2);if(o6.W!=3){L=o6.K;if(!L)return o6.return();W=g.kB("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.Q(o6,HF(L,{mode:"readonly",Jg:!0},function(y){return g.w5.all([Go(y,W,"mainDownloadsListEntity"),Go(y,g.aP,"mainDownloadsListEntity"),cF(y,"mainVideoEntity"),cF(y,"mainPlaylistEntity")])}),3)}f=o6.K;
I=g.n(f);U=I.next().value;e=I.next().value;b=I.next().value;E=I.next().value;d=U;v=e;r=b;B=E;A=new Set;if((S=d)==null?0:(Z=S.downloads)==null?0:Z.length)for(M=g.n(d.downloads),m=M.next();!m.done;m=M.next())T=m.value,K=void 0,(P=(K=T.videoItem)!=null?K:T.playlistItem)&&A.add(P);if((F=v)==null?0:(p=F.downloads)==null?0:p.length)for(H=g.n(v.downloads),q=H.next();!q.done;q=H.next())hj=q.value,hj.videoItem&&A.add(hj.videoItem);Ey=new Set;IR=[];rF=g.n(B);for($r=rF.next();!$r.done;$r=rF.next()){gF=$r.value;
if(gF.videos)for(xr=g.n(gF.videos),vA=xr.next();!vA.done;vA=xr.next())Ei=vA.value,(qz=JSON.parse(g.xB(Ei).entityId).videoId)&&Ey.add(qz);gF.key&&!A.has(gF.key)&&IR.push(gF.key)}jx=g.n(r);for(eA=jx.next();!eA.done;eA=jx.next())Y5=eA.value,Y5.key&&!A.has(Y5.key)&&(Gv=g.xB(Y5.key).entityId,Ey.has(Gv)||IR.push(Y5.key));return IR.length?g.Q(o6,$mD(L,IR),0):o6.G1(0)})};g.w(n9i,tD);n9i.prototype.K=function(L){return vo(L)?Viv(this,L):r_(L)?mRt(this,L):Bo(L)?udA(this,L):Promise.reject(Error("Unsupported action type: "+L.actionType))};
var lO=[10];g.w(TGO,tD);TGO.prototype.K=function(L){return vo(L)?g9G(this,L):r_(L)?Qbi(this,L):Bo(L)?jb5(this,L):Promise.reject(Error("Unsupported action type: "+L.actionType))};
var Oj=[10];g.w(Jbc,tD);Jbc.prototype.K=function(L){return vo(L)?Crv(this,L):r_(L)?pRQ(this,L):Bo(L)?RcG(this,L):Promise.reject(Error("Unsupported action type: "+L.actionType))};
var aq5=[10];g.w(Lv,iO);Lv.prototype.tZ=function(L){var W=iO.prototype.tZ.call(this,L);W.musicTrack=new Jbc(L,this.W);W.musicPlaylist=new TGO(L,this.W);W.musicAlbumRelease=new n9i(L,this.W);return W};
Lv.prototype.refreshAllStaleEntities=function(L,W){var f=this,I,U,e;return g.t(function(b){if(b.W==1)return g.Q(b,G$W(f,L,W),2);if(b.W!=3)return U=I=b.K,e=U.concat,g.Q(b,iO.prototype.refreshAllStaleEntities.call(f,L,W),3);I=e.call(U,b.K);return b.return(I)})};g.w(cbA,g.ux);g.D=cbA.prototype;g.D.create=function(){var L=this;g.C(this,this.events);if(g.X8(this.kp))this.W=new wRC(this.kp,this.player);else if(g.PQ(this.kp)||g.mJ(this.kp))this.W=new Lv(this.kp,this.player);this.events.D(this.player,"onPlaybackStartExternal",function(){L.t2()});
this.events.D(this.player,"videodatachange",function(){L.t2()});
this.kp.Z("html5_offline_playback_position_sync")&&this.events.D(this.player,"presentingplayerstatechange",this.nD)};
g.D.eX=function(){return!1};
g.D.XD=function(L,W,f,I){var U=this;return g.t(function(e){return U.W?e.return(x0(U.W,L,W,f,I)):e.return(Promise.reject())})};
g.D.deleteAll=function(){return this.W.deleteAll()};
g.D.u6=function(L){return this.W.u6(L)};
g.D.refreshAllStaleEntities=function(L){return this.W.refreshAllStaleEntities(L)};
g.D.setUpPositionSyncInterval=function(L){this.W.setUpPositionSyncInterval(L)};
g.D.rF=function(L){this.W.rF(L)};
g.D.YM=function(L){return this.W.YM(L)};
g.D.t2=function(){var L=this,W;return g.t(function(f){W=L.player.getVideoData();return g.wh(W)?sbt(W)&&L.K!==W.clientPlaybackNonce?g.Q(f,qLi(L,W),0):f.G1(0):f.return()})};
g.D.nD=function(L){var W=this,f,I,U,e,b,E,d;return g.t(function(v){if(v.W==1)return f=W.player.getVideoData(),I=f.ZT,g.vQ(L,2)||g.vQ(L,512)?g.Q(v,Wo(),2):v.return();if(v.W!=3){U=v.K;if(!U)return Uj("PES is undefined"),v.return();e=f.videoId;return g.Q(v,Ok(U,g.kB(e,"mainVideoEntity"),"mainVideoEntity"),3)}b=v.K;if(!b)return v.return();E=Math.floor(I).toString();d={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:E}};return g.Q(v,W.XD([e],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
d),0)})};
g.D.isOrchestrationLeader=function(){return this.W.isOrchestrationLeader()};
g.D.updateDownloadState=function(L,W){var f,I,U,e;return g.t(function(b){if(b.W==1)return g.Q(b,Wo(),2);f=b.K;if(!f)return Uj("PES is undefined"),b.return();I=g.xB(L);U=I.entityType;e=I.entityId;return g.Q(b,AD(e,U,f,W,!0),0)})};g.mD("offline",cbA);})(_yt_player);
